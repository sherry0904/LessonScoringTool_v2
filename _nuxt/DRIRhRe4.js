import{f as q,g as G,y as J,i as h,Q as K,r as w,A as P,u as X,c as u,o as m,a as e,j as Y,t as i,b,L as v,F as f,n as _,x as k,d as S,p as Z,l as ee,v as te,N as se}from"#entry";const oe={key:0,class:"p-4 sm:p-6 space-y-6"},ne={class:"flex items-center gap-2 mb-2"},ae={class:"text-2xl font-bold"},le={key:0,class:"alert bg-base-100 border border-base-200 shadow-sm flex items-start gap-3"},ie={class:"text-sm leading-relaxed text-base-content/70 whitespace-pre-line"},re={class:"stats stats-vertical sm:stats-horizontal bg-base-100 shadow-md"},ce={class:"stat-title"},de={class:"card bg-base-100 shadow-sm"},ue={class:"card-body flex-row flex-wrap items-center gap-4"},me={class:"dropdown"},pe=["disabled"],be={tabindex:"0",class:"dropdown-content z-[1] menu p-2 shadow bg-base-200 rounded-box w-40"},ve=["onClick"],ge={class:"flex items-center gap-2"},he={class:"grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},xe=["onClick"],we={class:"absolute top-3 right-3 z-20"},fe={class:"card-body p-4 space-y-3"},_e={class:"flex flex-col gap-0.5 mb-1"},ke={class:"font-semibold text-base truncate"},Se={class:"text-sm text-base-content/70"},ye={class:"grid grid-cols-2 gap-2 mt-2"},Ce=["onClick"],$e={class:"text-sm"},Te={class:"modal-box w-11/12 max-w-2xl"},Ae={class:"text-lg font-bold mb-4"},Le={key:1,class:"text-center p-8"},Ne=q({__name:"[hwid]",setup(Ie){const p=G(),g=J(),L=K(),{exportToExcel:E}=se(),I=h(()=>L.params.id),y=h(()=>L.params.hwid),n=h(()=>{if(!(!p.classes||!Array.isArray(p.classes)))return p.classes.find(o=>o.id===I.value)}),l=h(()=>{if(!(!g.homeworkList||!Array.isArray(g.homeworkList)))return g.homeworkList.find(o=>o.id===y.value)}),C=h(()=>{if(!(!n.value||!Array.isArray(n.value.homeworkSettings)))return n.value.homeworkSettings.find(o=>o.homeworkId===y.value)}),r=w([]),$=w(),M=w(""),x=w(""),T=["pending","submitted","needs_correction","completed"],c={pending:{text:"未繳交",icon:"Clock"},submitted:{text:"已繳交",icon:"CheckCircle"},needs_correction:{text:"待訂正",icon:"AlertTriangle"},completed:{text:"已完成",icon:"Award"}},H={pending:"text-error",submitted:"text-success",needs_correction:"text-warning",completed:"text-info"},V={pending:"badge-error text-white",submitted:"badge-success text-white",needs_correction:"badge-warning text-black",completed:"badge-info text-white"},d=o=>C.value?.studentStatus?.[o]||"pending",j=o=>C.value?.studentStatus?Object.values(C.value.studentStatus).filter(s=>s===o).length:0,N=(o,s)=>{p.updateStudentHomeworkStatus(I.value,y.value,o,s)},B=o=>{const s=r.value.indexOf(o);s>-1?r.value.splice(s,1):r.value.push(o)},F=()=>{n.value&&(r.value=n.value.students.map(o=>o.id))},z=()=>{r.value=[]},O=o=>{r.value.length!==0&&(r.value.forEach(s=>{N(s,o)}),z())},R=()=>{if(!n.value||!l.value)return;const o=new Date,s=o.toISOString().split("T")[0],t=o.toLocaleString("zh-TW"),a={sheetName:"學生狀態",header:[["班級:",n.value.name],["作業:",l.value.name],["匯出日期:",t],[]],data:n.value.students.map(A=>({座號:A.id,姓名:A.name,狀態:c[d(A.id)].text})),columnWidths:[{wch:10},{wch:30},{wch:20}],merges:[{s:{r:0,c:1},e:{r:0,c:2}},{s:{r:1,c:1},e:{r:1,c:2}},{s:{r:2,c:1},e:{r:2,c:2}}]},D=`${s}-${l.value.name}-${n.value.name}-狀態報告`;E([a],D)},W=()=>{if(!l.value||!n.value)return;const o=n.value.students.filter(t=>{const a=d(t.id);return a==="pending"||a==="needs_correction"}),s=[`作業：${l.value.name}`,`匯出時間：${new Date().toLocaleString("zh-TW")}`,"---","未完成學生名單：",...o.map(t=>`${t.id} ${t.name} - ${c[d(t.id)].text}`),`
總計：${o.length} 位學生`].join(`
`);M.value="未完成作業名單",x.value=s,$.value?.showModal()},U=async()=>{try{await navigator.clipboard.writeText(x.value),alert("已複製到剪貼簿！")}catch(o){console.error("複製失敗:",o)}},Q=()=>{$.value?.close()};return P(()=>{g.homeworkList.length===0&&g.fetchAllHomework(),p.classes.length===0&&p.loadFromStorage()}),X(()=>({title:`${l.value?.name||"作業詳情"} - ${n.value?.name||"班級"}`})),(o,s)=>n.value&&l.value?(m(),u("div",oe,[e("div",ne,[e("h2",ae,i(l.value.name),1)]),l.value.notes?(m(),u("div",le,[b(v,{name:"Info",class:"w-5 h-5 text-primary mt-1"}),e("div",null,[s[1]||(s[1]=e("p",{class:"text-sm font-semibold text-base-content/80 mb-1"},"作業備註",-1)),e("p",ie,i(l.value.notes),1)])])):Y("",!0),e("div",re,[(m(),u(f,null,_(T,t=>e("div",{class:"stat",key:t},[e("div",ce,i(c[t].text),1),e("div",{class:k(["stat-value",[H[t]]])},i(j(t)),3)])),64))]),e("div",de,[e("div",ue,[e("div",{class:"flex items-center gap-2"},[s[2]||(s[2]=e("span",{class:"text-sm font-semibold"},"選取:",-1)),e("button",{onClick:F,class:"btn btn-sm btn-outline"},"全選"),e("button",{onClick:z,class:"btn btn-sm btn-outline"}," 取消全選 ")]),e("div",me,[e("button",{tabindex:"0",role:"button",class:"btn btn-sm btn-primary",disabled:r.value.length===0},[b(v,{name:"ClipboardEdit",class:"w-4 h-4"}),s[3]||(s[3]=S(" 批次操作 ",-1))],8,pe),e("ul",be,[(m(),u(f,null,_(T,t=>e("li",{key:t},[e("a",{onClick:a=>O(t)}," 標記為 "+i(c[t].text),9,ve)])),64))])]),e("div",ge,[s[6]||(s[6]=e("span",{class:"text-sm font-semibold"},"匯出:",-1)),e("button",{onClick:W,class:"btn btn-sm btn-outline"},[b(v,{name:"ClipboardList",class:"w-4 h-4"}),s[4]||(s[4]=S(" 未完成名單 ",-1))]),e("button",{onClick:R,class:"btn btn-sm btn-outline"},[b(v,{name:"FileSpreadsheet",class:"w-4 h-4"}),s[5]||(s[5]=S(" 匯出狀態報告 ",-1))])])])]),e("div",he,[(m(!0),u(f,null,_(n.value.students,t=>(m(),u("div",{key:t.id,class:k(["card bg-base-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer relative overflow-hidden",{"ring-2 ring-primary":r.value.includes(t.id)}]),onClick:a=>B(t.id)},[e("div",we,[e("span",{class:k(["badge badge-lg gap-2 px-4 py-3 font-semibold shadow",V[d(t.id)]])},[b(v,{name:c[d(t.id)].icon,class:"w-4 h-4"},null,8,["name"]),S(" "+i(c[d(t.id)].text),1)],2)]),e("div",fe,[e("div",_e,[e("h3",ke,i(t.name),1),e("p",Se,"座號 "+i(t.id),1)]),e("div",ye,[(m(),u(f,null,_(T,a=>e("button",{key:a,onClick:Z(D=>N(t.id,a),["stop"]),class:k(["btn btn-sm w-full rounded-lg font-normal flex items-center justify-center gap-1 transition-all duration-150 whitespace-nowrap",{"btn-primary shadow":d(t.id)===a,"btn-outline":d(t.id)!==a}])},[b(v,{name:c[a].icon,class:"w-4 h-4"},null,8,["name"]),e("span",$e,i(c[a].text),1)],10,Ce)),64))])])],10,xe))),128))]),e("dialog",{ref_key:"reportModal",ref:$,class:"modal"},[e("div",Te,[e("h3",Ae,i(M.value),1),ee(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=t=>x.value=t),class:"textarea textarea-bordered h-64 w-full",readonly:""},null,512),[[te,x.value]]),e("div",{class:"modal-action"},[e("button",{onClick:U,class:"btn btn-success"},"複製"),e("button",{onClick:Q,class:"btn btn-ghost"},"關閉")])])],512)])):(m(),u("div",Le,[...s[7]||(s[7]=[e("p",null,"正在載入資料...",-1),e("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}});export{Ne as default};
