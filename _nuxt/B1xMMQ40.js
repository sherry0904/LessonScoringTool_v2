import{f as U,g as B,D as K,r as f,i as F,c as i,o as r,a as e,F as S,n as C,x as b,t as a,j as I,b as m,d as $,L as X,k,M as V,p as u,N as Y,_ as Z,G as ee}from"#entry";const se={key:0,class:"space-y-6"},te={class:"card bg-base-100 shadow-sm"},oe={class:"card-body"},ne={class:"flex flex-wrap gap-4 items-center"},le={class:"form-control flex-1"},ae={class:"flex items-center gap-4 justify-between w-full"},ie={class:"flex items-center gap-2"},re={class:"flex flex-wrap gap-2"},ce=["onClick","title"],de={class:"flex items-center gap-2 ml-auto"},ue=["onClick"],me={class:"card-body p-0"},be={class:"flex flex-row items-stretch divide-x divide-base-100"},ve={class:"flex flex-col justify-between gap-4 p-4 flex-1"},ge={class:"flex items-center justify-between"},pe={class:"font-semibold text-lg"},xe={class:"text-sm text-base-content/70"},fe={class:"flex justify-between items-center"},he={class:"flex items-center gap-2"},_e={class:"flex items-center gap-2 select-none"},ke=["checked","onChange"],we={class:"flex flex-col justify-center items-center bg-gradient-to-br from-base-200 via-base-100 to-base-300 rounded-r-2xl p-4 min-w-[80px] gap-2"},ye={class:"flex flex-col items-center"},Se={class:"flex gap-2 mt-2"},Ce=["onClick"],$e=["onClick"],Te={class:"absolute top-3 right-3 z-10"},Pe={class:"dropdown dropdown-end"},je={tabindex:"0",class:"dropdown-content menu bg-base-100 rounded-box z-[1] w-48 p-2 shadow"},Me=["onClick"],De=["onClick"],Ne=["onClick"],ze=["onClick"],Ee={class:"modal-box w-11/12 max-w-2xl"},Le={class:"text-lg font-bold mb-4"},Ie={key:0,class:"space-y-3 max-h-96 overflow-y-auto"},Ve={class:"flex items-center gap-2"},Ue={class:"text-sm"},Be={class:"text-right"},Fe={class:"text-sm text-base-content/70"},Oe={key:1,class:"text-center py-8 text-base-content/70"},We={key:1,class:"text-center p-8"},qe=U({__name:"ScoringTab",props:{classInfo:{}},setup(T){const w=T,v=B(),p=K(),{exportToExcel:P}=Y(),x=V("addStudent"),j=V("editStudent"),y=f(),M=f(1),c=f([]),g=f(null),h=f({}),O=[3,2,1,-1,-2,-3],n=F(()=>w.classInfo),W=o=>{const s=c.value.indexOf(o);s>-1?c.value.splice(s,1):c.value.push(o)},q=()=>{n.value&&(c.value=n.value.students.map(o=>o.id))},D=()=>{c.value=[]},N=(o,s)=>{z(o,s,"快速評分"),h.value[o]=s>0?"animate-score-bounce-green":"animate-score-bounce-red",setTimeout(()=>{h.value[o]=null},500)},A=o=>{c.value.length>0?(c.value.forEach(s=>z(s,o,"批量快速評分")),D()):M.value=o},z=(o,s,l)=>{n.value&&v.addScoreToStudent(n.value.id,o,s,l)},H=o=>{n.value&&confirm(`確定要刪除學生「${o.name}」嗎？此操作無法復原。`)&&(v.removeStudentFromClass(n.value.id,o.id),p.showSuccess("學生已刪除"))},R=o=>{g.value=o,y.value?.showModal()},E=()=>{y.value?.close(),g.value=null},L=o=>{if(!n.value)return;const s=n.value.students.find(l=>l.id===o);s&&v.updateStudent(n.value.id,o,{isPresent:!s.isPresent})},G=o=>new Date(o).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Q=()=>{if(!n.value)return;const o=new Date,s=o.toISOString().split("T")[0],l=n.value.students.map(_=>({座號:_.id,姓名:_.name,總分:_.totalScore,出席:_.isPresent?"是":"否"})),t={sheetName:`${n.value.name} - 成績單`,header:[["班級:",n.value.name],["匯出日期:",o.toLocaleString("zh-TW")],[]],data:l,columnWidths:[{wch:10},{wch:20},{wch:10},{wch:10}]},d=`${s}-${n.value.name}-成績單`;P([t],d)},J=()=>{if(!n.value||!confirm(`將會把「${n.value.name}」全體學生的總分歸零並清除評分紀錄，確定要執行嗎？`))return;v.resetClassTotals(n.value.id)&&(p.showSuccess("已重置全班總分"),h.value={})};return(o,s)=>{const l=X;return n.value?(r(),i("div",se,[e("div",te,[e("div",oe,[e("div",ne,[e("div",le,[e("div",ae,[e("div",ie,[s[3]||(s[3]=e("span",{class:"label-text whitespace-nowrap"},"快速加分",-1)),e("div",re,[(r(),i(S,null,C(O,t=>e("button",{key:t,onClick:d=>A(t),class:b(["px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 border focus:outline-none focus:ring-2 focus:ring-primary/40",t===M.value?t>0?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow":"bg-gradient-to-r from-rose-500 to-red-500 text-white shadow":t>0?"bg-green-50 dark:bg-green-900/20 text-green-600 border-green-200 dark:border-green-700 hover:bg-green-100 dark:hover:bg-green-900/40":"bg-rose-50 dark:bg-rose-900/20 text-rose-600 border-rose-200 dark:border-rose-700 hover:bg-rose-100 dark:hover:bg-rose-900/40"]),title:c.value.length?"立即對選取學生套用":"設定批量評分預設分數"},a(t>0?"+":"")+a(t),11,ce)),64))])]),e("div",de,[e("button",{class:"btn btn-sm btn-outline",onClick:q,type:"button"}," 全選 "),e("button",{class:"btn btn-sm btn-outline",onClick:D,type:"button"}," 取消全選 "),s[7]||(s[7]=e("div",{class:"divider divider-horizontal mx-1"},null,-1)),e("button",{class:"btn btn-sm btn-outline",onClick:Q,type:"button"},[m(l,{name:"Download",class:"w-4 h-4 mr-1"}),s[4]||(s[4]=$(" 匯出成績 ",-1))]),e("button",{class:"btn btn-sm btn-outline btn-warning",onClick:J,type:"button"},[m(l,{name:"RotateCcw",class:"w-4 h-4 mr-1"}),s[5]||(s[5]=$(" 全班總分歸零 ",-1))]),k(x)?(r(),i("button",{key:0,class:"btn btn-sm btn-primary",onClick:s[0]||(s[0]=t=>k(x)?.()),type:"button"},[m(l,{name:"UserPlus",class:"w-4 h-4 mr-1"}),s[6]||(s[6]=$(" 新增學生 ",-1))])):I("",!0)])])])])])]),e("div",{class:b(["grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 transition-all",c.value.length?"pb-32":""])},[(r(!0),i(S,null,C(n.value.students,t=>(r(),i("div",{key:t.id,class:b(["card bg-base-100 border-2 border-base-300 shadow-md rounded-xl hover:shadow-xl transition-all duration-200 cursor-pointer",{"ring-2 ring-primary":c.value.includes(t.id)}]),onClick:d=>W(t.id)},[e("div",me,[e("div",be,[e("div",ve,[e("div",ge,[e("div",null,[e("h3",pe,a(t.name),1),e("p",xe,"座號 "+a(t.id),1)]),e("span",{class:b(["badge badge-soft",t.isPresent?"badge-success":"badge-ghost text-base-content/60"])},a(t.isPresent?"出席":"缺席"),3)]),e("div",fe,[e("div",he,[e("label",_e,[e("input",{type:"checkbox",checked:t.isPresent,onClick:s[1]||(s[1]=u(()=>{},["stop"])),onChange:u(d=>L(t.id),["stop"]),class:"toggle toggle-success toggle-sm"},null,40,ke),e("span",{class:b(["text-sm font-medium",t.isPresent?"text-green-600":"text-gray-400"])},a(t.isPresent?"出席":"缺席"),3)])])])]),e("div",we,[e("div",ye,[s[8]||(s[8]=e("span",{class:"text-xs text-base-content/60 mb-1"},"總分",-1)),e("span",{class:b(["font-extrabold text-xl md:text-2xl lg:text-3xl text-primary px-2 py-2",h.value[t.id]])},a(t.totalScore),3)]),e("div",Se,[e("button",{onClick:u(d=>N(t.id,1),["stop"]),class:"btn btn-md font-bold text-base px-4 py-1 rounded-full bg-gradient-to-r from-green-400 to-emerald-500 text-white border-none shadow hover:scale-105 hover:from-green-500 hover:to-emerald-600",title:"+1分"}," +1 ",8,Ce),e("button",{onClick:u(d=>N(t.id,-1),["stop"]),class:"btn btn-md font-bold text-base px-4 py-1 rounded-full bg-gradient-to-r from-rose-400 to-red-500 text-white border-none shadow hover:scale-105 hover:from-rose-500 hover:to-red-600",title:"-1分"}," -1 ",8,$e)])])])]),e("div",Te,[e("div",Pe,[e("div",{tabindex:"0",role:"button",class:"btn btn-ghost btn-xs btn-circle",onClick:s[2]||(s[2]=u(()=>{},["stop"]))},[m(l,{name:"MoreVertical",class:"w-4 h-4"})]),e("ul",je,[e("li",null,[k(j)?(r(),i("a",{key:0,onClick:u(d=>k(j)?.(t.id),["stop"]),class:"flex items-center gap-2"},[m(l,{name:"Edit",class:"w-3 h-3"}),s[9]||(s[9]=e("span",null,"編輯學生",-1))],8,Me)):I("",!0)]),e("li",null,[e("a",{onClick:u(d=>R(t),["stop"]),class:"flex items-center gap-2"},[m(l,{name:"ScrollText",class:"w-3 h-3"}),s[10]||(s[10]=e("span",null,"評分記錄",-1))],8,De)]),e("li",null,[e("a",{onClick:u(d=>L(t.id),["stop"]),class:"flex items-center gap-2"},[m(l,{name:t.isPresent?"UserMinus":"UserCheck",class:"w-3 h-3"},null,8,["name"]),e("span",null,a(t.isPresent?"標記缺席":"標記出席"),1)],8,Ne)]),s[12]||(s[12]=e("div",{class:"divider my-1"},null,-1)),e("li",null,[e("a",{onClick:u(d=>H(t),["stop"]),class:"text-error flex items-center gap-2"},[m(l,{name:"Trash2",class:"w-3 h-3"}),s[11]||(s[11]=e("span",null,"刪除學生",-1))],8,ze)])])])])],10,ue))),128))],2),e("dialog",{ref_key:"historyModal",ref:y,class:"modal"},[e("div",Ee,[e("h3",Le,a(g.value?.name)+" 的評分記錄",1),g.value&&g.value.scores.length>0?(r(),i("div",Ie,[(r(!0),i(S,null,C(g.value.scores.slice().reverse(),t=>(r(),i("div",{key:t.id,class:"flex justify-between items-center p-3 bg-base-200 rounded-lg"},[e("div",null,[e("div",Ve,[e("span",{class:b(["badge",t.value>0?"badge-success":"badge-error"])},a(t.value>0?"+":"")+a(t.value),3),e("span",Ue,a(t.reason||"快速評分"),1)])]),e("div",Be,[e("div",Fe,a(G(t.timestamp)),1)])]))),128))])):(r(),i("div",Oe,"尚無評分記錄")),e("div",{class:"modal-action"},[e("button",{onClick:E,class:"btn btn-ghost"},"關閉")])]),e("form",{method:"dialog",class:"modal-backdrop"},[e("button",{onClick:E},"close")])],512)])):(r(),i("div",We,[...s[13]||(s[13]=[e("p",null,"正在載入班級資料...",-1),e("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}}}),Ae=Object.assign(Z(qe,[["__scopeId","data-v-3f367543"]]),{__name:"ScoringTab"}),He={key:0,class:"p-4 sm:p-6"},Re={key:1,class:"text-center p-8"},Qe=U({__name:"index",setup(T){const w=B(),{currentClass:v}=ee(w),p=F(()=>v.value??null);return(P,x)=>p.value?(r(),i("div",He,[m(Ae,{"class-info":p.value},null,8,["class-info"])])):(r(),i("div",Re,[...x[0]||(x[0]=[e("p",null,"正在載入班級資料...",-1),e("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}});export{Qe as default};
