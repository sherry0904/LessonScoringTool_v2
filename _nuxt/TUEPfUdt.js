import{f as lt,g as nt,B as dt,i as u,r as m,c as i,l as n,o as c,a as t,t as a,k as $,s as j,m as R,x as w,F as g,n as _,b as U,d as P,L as rt,j as x,J as W,v as it}from"#entry";const ct={key:0,class:"space-y-6"},ut={class:"stats stats-horizontal shadow"},vt={class:"stat"},mt={class:"stat-value text-primary"},bt={class:"stat-desc"},gt={class:"stat"},_t={class:"stat-value text-success"},pt={class:"stat-desc"},ht={class:"stat"},xt={class:"stat-value text-error"},ft={class:"stat-desc"},yt={class:"stat"},St={class:"stat-value"},kt={class:"card bg-base-100 shadow-sm"},wt={class:"card-body"},Ct={class:"flex flex-wrap gap-4 items-center justify-between"},It={class:"flex flex-wrap gap-4 items-center"},Mt={class:"form-control"},$t={class:"form-control"},Rt={class:"btn-group"},Vt={class:"form-control"},Dt=["value"],Ft={class:"flex gap-2"},Tt={class:"card bg-base-100 shadow-sm"},zt={class:"card-body p-0"},Nt={class:"overflow-x-auto"},Bt={class:"table table-zebra"},Lt={class:"flex items-center gap-2"},jt={class:"font-bold"},Ut={key:0,class:"badge badge-warning badge-sm"},Pt={class:"font-semibold"},Wt={key:0,class:"badge badge-error badge-xs"},At={class:"font-bold text-lg"},Et={class:"modal-box w-11/12 max-w-4xl"},Gt={key:0,class:"text-lg font-bold mb-4"},Jt={key:1,class:"space-y-6"},Ot={class:"stats stats-horizontal shadow"},qt={class:"stat"},Ht={class:"stat-value text-primary"},Kt={class:"stat"},Qt={class:"stat-value"},Xt={class:"stat"},Yt={class:"stat-value"},Zt={class:"card bg-base-100"},ts={class:"card-body"},ss={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},es={class:"stat-title text-xs"},os={class:"stat-desc text-xs"},as={class:"card bg-base-100"},ls={class:"card-body"},ns={class:"max-h-64 overflow-y-auto space-y-2"},ds={class:"flex items-center gap-2"},rs={class:"font-medium"},is={key:0,class:"text-sm text-base-content/70 mt-1"},cs={class:"text-sm text-base-content/70"},us={class:"modal-box w-11/12 max-w-2xl"},vs={class:"text-lg font-bold mb-4"},ms={class:"form-control mb-4"},bs={class:"modal-box w-11/12 max-w-4xl"},gs={class:"space-y-6"},_s={class:"card bg-base-100"},ps={class:"card-body"},hs={class:"grid grid-cols-5 gap-2 text-center"},xs={class:"stat-title text-xs"},fs={class:"stat-value text-sm"},ys={class:"card bg-base-100"},Ss={class:"card-body"},ks={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},ws={class:"stat-title text-xs"},Cs={class:"stat-desc text-xs"},Is={key:1,class:"text-center p-8"},Rs=lt({__name:"grades",setup(Ms){const A=nt(),E=dt(),G=u(()=>E.params.id),d=u(()=>A.classes.find(o=>o.id===G.value)),V=m(),C=m(),I=m(),f=m("totalScore"),b=m("desc"),M=m(""),v=m(null),D=m(""),p=m(""),y=[{id:"participation",name:"參與度",color:"#3b82f6"},{id:"homework",name:"作業",color:"#10b981"},{id:"behavior",name:"行為表現",color:"#f59e0b"},{id:"creativity",name:"創意思考",color:"#8b5cf6"},{id:"group",name:"小組活動",color:"#ef4444"}],F=u(()=>{if(!d.value)return[];let o=[...d.value.students];return o.sort((s,l)=>{let e,r;switch(f.value){case"totalScore":e=s.totalScore,r=l.totalScore;break;case"averageScore":e=s.averageScore,r=l.averageScore;break;case"name":e=s.name,r=l.name;break;case"id":e=parseInt(s.id)||0,r=parseInt(l.id)||0;break;default:return 0}return typeof e=="string"&&typeof r=="string"?b.value==="desc"?r.localeCompare(e):e.localeCompare(r):b.value==="desc"?r-e:e-r}),o}),T=u(()=>{if(!d.value)return 0;const o=d.value.students.reduce((s,l)=>s+l.totalScore,0);return d.value.students.length>0?o/d.value.students.length:0}),J=u(()=>d.value?d.value.students.reduce((o,s)=>o+s.scores.length,0):0),S=u(()=>d.value?d.value.students.reduce((o,s)=>s.totalScore>(o?.totalScore||-1/0)?s:o,null):null),k=u(()=>d.value?d.value.students.reduce((o,s)=>s.totalScore<(o?.totalScore||1/0)?s:o,null):null),z=u(()=>S.value?.totalScore||0),N=u(()=>k.value?.totalScore||0),B=u(()=>{if(!d.value)return 0;const o=d.value.students.filter(s=>s.totalScore>=60).length;return d.value.students.length>0?Math.round(o/d.value.students.length*100):0}),O=u(()=>{const o=[{label:"90-100",min:90,max:100},{label:"80-89",min:80,max:89},{label:"70-79",min:70,max:79},{label:"60-69",min:60,max:69},{label:"0-59",min:0,max:59}];return d.value?o.map(s=>({...s,count:d.value.students.filter(l=>l.totalScore>=s.min&&l.totalScore<=s.max).length})):o.map(s=>({...s,count:0}))}),q=u(()=>d.value?y.map(o=>{const s=d.value.students.flatMap(r=>r.scores.filter(h=>h.categoryId===o.id).map(h=>h.value)),l=s.reduce((r,h)=>r+h,0),e=s.length>0?l/s.length:0;return{categoryId:o.id,categoryName:o.name,total:l,average:e,count:s.length}}):[]),H=(o,s)=>o.scores.filter(e=>e.categoryId===s).map(e=>e.value).reduce((e,r)=>e+r,0),K=(o,s)=>o.scores.filter(l=>l.categoryId===s).length,Q=o=>y.find(s=>s.id===o)?.color||"#666",X=(o,s)=>{const l=[];return s<3&&l.push("bg-warning/10"),o.isPresent||l.push("opacity-60"),l.join(" ")},Y=o=>d.value?[...d.value.students].sort((l,e)=>e.totalScore-l.totalScore).findIndex(l=>l.id===o)+1:0,L=()=>{V.value?.close(),v.value=null},Z=()=>{if(!d.value||!S.value||!k.value)return;const o=[`${d.value.name} 成績報告`,`匯出時間：${new Date().toLocaleString("zh-TW")}`,"","班級統計：",`平均分：${T.value.toFixed(1)}`,`最高分：${z.value} (${S.value.name})`,`最低分：${N.value} (${k.value.name})`,`及格率：${B.value}%`,"","學生成績：","排名	座號	姓名	總分	平均分",...F.value.map((s,l)=>`${l+1}	${s.id}	${s.name}	${s.totalScore}	${s.averageScore.toFixed(1)}`)].join(`
`);D.value="班級成績報告",p.value=o,C.value?.showModal()},tt=()=>{I.value?.showModal()},st=()=>{C.value?.close()},et=()=>{I.value?.close()},ot=async()=>{try{await navigator.clipboard.writeText(p.value),alert("已複製到剪貼簿！")}catch(o){console.error("複製失敗:",o),alert("複製失敗，請手動選取文字複製。")}},at=o=>new Date(o).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return(o,s)=>{const l=rt;return n(d)?(c(),i("div",ct,[t("div",ut,[t("div",vt,[s[5]||(s[5]=t("div",{class:"stat-title"},"班級平均",-1)),t("div",mt,a(n(T).toFixed(1)),1),t("div",bt,"總評分記錄："+a(n(J)),1)]),t("div",gt,[s[6]||(s[6]=t("div",{class:"stat-title"},"最高分",-1)),t("div",_t,a(n(z)),1),t("div",pt,a(n(S)?.name),1)]),t("div",ht,[s[7]||(s[7]=t("div",{class:"stat-title"},"最低分",-1)),t("div",xt,a(n(N)),1),t("div",ft,a(n(k)?.name),1)]),t("div",yt,[s[8]||(s[8]=t("div",{class:"stat-title"},"及格率",-1)),t("div",St,a(n(B))+"%",1),s[9]||(s[9]=t("div",{class:"stat-desc"},"以60分為及格標準",-1))])]),t("div",kt,[t("div",wt,[t("div",Ct,[t("div",It,[t("div",Mt,[s[11]||(s[11]=t("label",{class:"label"},[t("span",{class:"label-text"},"排序方式")],-1)),$(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>R(f)?f.value=e:null),class:"select select-bordered"},[...s[10]||(s[10]=[t("option",{value:"totalScore"},"總分",-1),t("option",{value:"averageScore"},"平均分",-1),t("option",{value:"name"},"姓名",-1),t("option",{value:"id"},"座號",-1)])],512),[[j,n(f)]])]),t("div",$t,[s[12]||(s[12]=t("label",{class:"label"},[t("span",{class:"label-text"},"排序順序")],-1)),t("div",Rt,[t("button",{class:w(["btn btn-sm",n(b)==="desc"?"btn-active":""]),onClick:s[1]||(s[1]=e=>b.value="desc")}," 高到低 ",2),t("button",{class:w(["btn btn-sm",n(b)==="asc"?"btn-active":""]),onClick:s[2]||(s[2]=e=>b.value="asc")}," 低到高 ",2)])]),t("div",Vt,[s[14]||(s[14]=t("label",{class:"label"},[t("span",{class:"label-text"},"評分類別")],-1)),$(t("select",{"onUpdate:modelValue":s[3]||(s[3]=e=>R(M)?M.value=e:null),class:"select select-bordered"},[s[13]||(s[13]=t("option",{value:""},"全部類別",-1)),(c(),i(g,null,_(y,e=>t("option",{key:e.id,value:e.id},a(e.name),9,Dt)),64))],512),[[j,n(M)]])])]),t("div",Ft,[t("button",{onClick:Z,class:"btn btn-primary gap-2"},[U(l,{name:"Download",class:"w-4 h-4"}),s[15]||(s[15]=P(" 匯出成績單 ",-1))]),t("button",{onClick:tt,class:"btn btn-info gap-2"},[U(l,{name:"BarChart3",class:"w-4 h-4"}),s[16]||(s[16]=P(" 統計圖表 ",-1))])])])])]),t("div",Tt,[t("div",zt,[t("div",Nt,[t("table",Bt,[s[17]||(s[17]=t("thead",null,[t("tr",null,[t("th",null,"排名"),t("th",null,"座號"),t("th",null,"姓名"),t("th",null,"總分")])],-1)),t("tbody",null,[(c(!0),i(g,null,_(n(F),(e,r)=>(c(),i("tr",{key:e.id,class:w(X(e,r))},[t("td",null,[t("div",Lt,[t("span",jt,a(r+1),1),r<3?(c(),i("div",Ut,a(["🥇","🥈","🥉"][r]),1)):x("",!0)])]),t("td",null,a(e.id),1),t("td",null,[t("div",Pt,a(e.name),1),e.isPresent?x("",!0):(c(),i("div",Wt," 缺席 "))]),t("td",null,[t("span",At,a(e.totalScore),1)])],2))),128))])])])])]),t("dialog",{ref_key:"detailModal",ref:V,class:"modal"},[t("div",Et,[n(v)?(c(),i("h3",Gt,a(n(v).name)+" 的詳細成績 ",1)):x("",!0),n(v)?(c(),i("div",Jt,[t("div",Ot,[t("div",qt,[s[18]||(s[18]=t("div",{class:"stat-title"},"總分",-1)),t("div",Ht,a(n(v).totalScore),1)]),t("div",Kt,[s[19]||(s[19]=t("div",{class:"stat-title"},"平均分",-1)),t("div",Qt,a(n(v).averageScore.toFixed(1)),1)]),t("div",Xt,[s[20]||(s[20]=t("div",{class:"stat-title"},"班級排名",-1)),t("div",Yt,a(Y(n(v).id)),1)])]),t("div",Zt,[t("div",ts,[s[21]||(s[21]=t("h4",{class:"card-title text-base"},"各類別得分統計",-1)),t("div",ss,[(c(),i(g,null,_(y,e=>t("div",{key:e.id,class:"stat bg-base-200 rounded-lg"},[t("div",es,a(e.name),1),t("div",{class:"stat-value text-sm",style:W({color:e.color})},a(H(n(v),e.id)),5),t("div",os,a(K(n(v),e.id))+" 次記錄 ",1)])),64))])])]),t("div",as,[t("div",ls,[s[22]||(s[22]=t("h4",{class:"card-title text-base"},"評分記錄",-1)),t("div",ns,[(c(!0),i(g,null,_(n(v).scores.slice().reverse(),e=>(c(),i("div",{key:e.id,class:"flex justify-between items-center p-3 bg-base-200 rounded"},[t("div",null,[t("div",ds,[t("span",{class:w(["badge",e.value>0?"badge-success":"badge-error"])},a(e.value>0?"+":"")+a(e.value),3),t("span",rs,a(e.categoryName),1)]),e.reason?(c(),i("p",is,a(e.reason),1)):x("",!0)]),t("div",cs,a(at(e.timestamp)),1)]))),128))])])])])):x("",!0),t("div",{class:"modal-action"},[t("button",{onClick:L,class:"btn btn-ghost"},"關閉")])]),t("form",{method:"dialog",class:"modal-backdrop"},[t("button",{onClick:L},"close")])],512),t("dialog",{ref_key:"reportModal",ref:C,class:"modal"},[t("div",us,[t("h3",vs,a(n(D)),1),t("div",ms,[$(t("textarea",{"onUpdate:modelValue":s[4]||(s[4]=e=>R(p)?p.value=e:null),class:"textarea textarea-bordered h-64",readonly:""},null,512),[[it,n(p)]])]),t("div",{class:"modal-action"},[t("button",{onClick:ot,class:"btn btn-success"}," 複製到剪貼簿 "),t("button",{onClick:st,class:"btn btn-ghost"},"關閉")])])],512),t("dialog",{ref_key:"chartModal",ref:I,class:"modal"},[t("div",bs,[s[25]||(s[25]=t("h3",{class:"text-lg font-bold mb-4"},"成績統計圖表",-1)),t("div",gs,[t("div",_s,[t("div",ps,[s[23]||(s[23]=t("h4",{class:"card-title text-base"},"分數分布",-1)),t("div",hs,[(c(!0),i(g,null,_(n(O),(e,r)=>(c(),i("div",{key:r,class:"stat bg-base-200 rounded"},[t("div",xs,a(e.label),1),t("div",fs,a(e.count),1)]))),128))])])]),t("div",ys,[t("div",Ss,[s[24]||(s[24]=t("h4",{class:"card-title text-base"},"各類別平均分",-1)),t("div",ks,[(c(!0),i(g,null,_(n(q),e=>(c(),i("div",{key:e.categoryId,class:"stat bg-base-200 rounded"},[t("div",ws,a(e.categoryName),1),t("div",{class:"stat-value text-sm",style:W({color:Q(e.categoryId)})},a(e.average.toFixed(1)),5),t("div",Cs,a(e.count)+" 次記錄",1)]))),128))])])])]),t("div",{class:"modal-action"},[t("button",{onClick:et,class:"btn btn-ghost"},"關閉")])])],512)])):(c(),i("div",Is,[...s[26]||(s[26]=[t("p",null,"正在載入班級資料...",-1),t("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}}});export{Rs as default};
