import{f as X,g as Y,j as i,V as Z,r as v,c as r,o as c,a as t,t as o,m as N,A as tt,x as y,b as st,d as et,L as at,F as g,n as _,k as p,W as T,l as ot,v as lt}from"#entry";import{a as nt}from"./s03H60Zk.js";const dt={key:0,class:"space-y-6"},rt={class:"stats stats-horizontal shadow"},ct={class:"stat"},it={class:"stat-value text-primary"},ut={class:"stat-desc"},vt={class:"stat"},mt={class:"stat-value text-success"},bt={class:"stat-desc"},gt={class:"stat"},_t={class:"stat-value text-error"},pt={class:"stat-desc"},ht={class:"card bg-base-100 shadow-sm"},xt={class:"card-body"},ft={class:"flex flex-wrap gap-4 items-center justify-between"},yt={class:"flex flex-wrap gap-4 items-center"},St={class:"flex items-center gap-4"},kt={class:"btn-group"},wt={class:"flex gap-2"},Ct={class:"card bg-base-100 shadow-sm"},It={class:"card-body p-0"},$t={class:"overflow-x-auto"},Mt={class:"table table-zebra"},Vt={class:"flex items-center gap-2"},Ft={class:"font-bold"},Rt={key:0,class:"badge badge-warning badge-sm"},Dt={class:"font-semibold"},Nt={key:0,class:"badge badge-error badge-xs"},Tt={class:"font-bold text-lg"},zt={class:"modal-box w-11/12 max-w-4xl"},jt={key:0,class:"text-lg font-bold mb-4"},Lt={key:1,class:"space-y-6"},Bt={class:"stats stats-horizontal shadow"},At={class:"stat"},Pt={class:"stat-value text-primary"},Ut={class:"stat"},Wt={class:"stat-value"},Et={class:"stat"},Gt={class:"stat-value"},Ot={class:"card bg-base-100"},qt={class:"card-body"},Ht={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Jt={class:"stat-title text-xs"},Kt={class:"stat-desc text-xs"},Qt={class:"card bg-base-100"},Xt={class:"card-body"},Yt={class:"max-h-64 overflow-y-auto space-y-2"},Zt={class:"flex items-center gap-2"},ts={class:"font-medium"},ss={key:0,class:"text-sm text-base-content/70 mt-1"},es={class:"text-sm text-base-content/70"},as={class:"modal-box w-11/12 max-w-2xl"},os={class:"text-lg font-bold mb-4"},ls={class:"form-control mb-4"},ns={class:"modal-box w-11/12 max-w-4xl"},ds={class:"space-y-6"},rs={class:"card bg-base-100"},cs={class:"card-body"},is={class:"grid grid-cols-5 gap-2 text-center"},us={class:"stat-title text-xs"},vs={class:"stat-value text-sm"},ms={class:"card bg-base-100"},bs={class:"card-body"},gs={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},_s={class:"stat-title text-xs"},ps={class:"stat-desc text-xs"},hs={key:1,class:"text-center p-8"},Ss=X({__name:"grades",setup(xs){const z=Y(),j=Z(),L=i(()=>j.params.id),n=i(()=>z.classes.find(a=>a.id===L.value)),C=v(),S=v(),I=v(),k=v("totalScore"),m=v("desc");v("");const u=v(null),$=v(""),h=v(""),w=[{id:"participation",name:"åƒèˆ‡åº¦",color:"#3b82f6"},{id:"homework",name:"ä½œæ¥­",color:"#10b981"},{id:"behavior",name:"è¡Œç‚ºè¡¨ç¾",color:"#f59e0b"},{id:"creativity",name:"å‰µæ„æ€è€ƒ",color:"#8b5cf6"},{id:"group",name:"å°çµ„æ´»å‹•",color:"#ef4444"}],M=i(()=>{if(!n.value)return[];let a=[...n.value.students];return a.sort((s,l)=>{let e,d;switch(k.value){case"totalScore":e=s.totalScore,d=l.totalScore;break;case"averageScore":e=s.averageScore,d=l.averageScore;break;case"name":e=s.name,d=l.name;break;case"id":e=parseInt(s.id)||0,d=parseInt(l.id)||0;break;default:return 0}return typeof e=="string"&&typeof d=="string"?m.value==="desc"?d.localeCompare(e):e.localeCompare(d):m.value==="desc"?d-e:e-d}),a}),V=i(()=>{if(!n.value)return 0;const a=n.value.students.reduce((s,l)=>s+l.totalScore,0);return n.value.students.length>0?a/n.value.students.length:0}),B=i(()=>n.value?n.value.students.reduce((a,s)=>a+s.scores.length,0):0),x=i(()=>n.value?n.value.students.reduce((a,s)=>s.totalScore>(a?.totalScore||-1/0)?s:a,null):null),f=i(()=>n.value?n.value.students.reduce((a,s)=>s.totalScore<(a?.totalScore||1/0)?s:a,null):null),F=i(()=>x.value?.totalScore||0),R=i(()=>f.value?.totalScore||0),A=i(()=>{if(!n.value)return 0;const a=n.value.students.filter(s=>s.totalScore>=60).length;return n.value.students.length>0?Math.round(a/n.value.students.length*100):0}),P=i(()=>{const a=[{label:"90-100",min:90,max:100},{label:"80-89",min:80,max:89},{label:"70-79",min:70,max:79},{label:"60-69",min:60,max:69},{label:"0-59",min:0,max:59}];return n.value?a.map(s=>({...s,count:n.value.students.filter(l=>l.totalScore>=s.min&&l.totalScore<=s.max).length})):a.map(s=>({...s,count:0}))}),U=i(()=>n.value?w.map(a=>{const s=n.value.students.flatMap(d=>d.scores.filter(b=>b.categoryId===a.id).map(b=>b.value)),l=s.reduce((d,b)=>d+b,0),e=s.length>0?l/s.length:0;return{categoryId:a.id,categoryName:a.name,total:l,average:e,count:s.length}}):[]),W=(a,s)=>a.scores.filter(e=>e.categoryId===s).map(e=>e.value).reduce((e,d)=>e+d,0),E=(a,s)=>a.scores.filter(l=>l.categoryId===s).length,G=a=>w.find(s=>s.id===a)?.color||"#666",O=(a,s)=>{const l=[];return s<3&&l.push("bg-warning/10"),a.isPresent||l.push("opacity-60"),l.join(" ")},q=a=>n.value?[...n.value.students].sort((l,e)=>e.totalScore-l.totalScore).findIndex(l=>l.id===a)+1:0,D=()=>{C.value?.close(),u.value=null},H=()=>{if(!n.value||!x.value||!f.value)return;const a=[`${n.value.name} æˆç¸¾å ±å‘Š`,`åŒ¯å‡ºæ™‚é–“ï¼š${new Date().toLocaleString("zh-TW")}`,"","ç­ç´šçµ±è¨ˆï¼š",`å¹³å‡åˆ†ï¼š${V.value.toFixed(1)}`,`æœ€é«˜åˆ†ï¼š${F.value} (${x.value.name})`,`æœ€ä½åˆ†ï¼š${R.value} (${f.value.name})`,`åŠæ ¼ç‡ï¼š${A.value}%`,"","å­¸ç”Ÿæˆç¸¾ï¼š","æ’å	åº§è™Ÿ	å§“å	ç¸½åˆ†	å¹³å‡åˆ†",...M.value.map((s,l)=>`${l+1}	${s.id}	${s.name}	${s.totalScore}	${s.averageScore.toFixed(1)}`)].join(`
`);$.value="ç­ç´šæˆç¸¾å ±å‘Š",h.value=a,S.value?.showModal()},J=()=>{S.value?.close()},K=()=>{I.value?.close()},Q=async()=>{try{await navigator.clipboard.writeText(h.value),alert("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼")}catch(a){console.error("è¤‡è£½å¤±æ•—:",a),alert("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–æ–‡å­—è¤‡è£½ã€‚")}};return(a,s)=>{const l=at;return n.value?(c(),r("div",dt,[t("div",rt,[t("div",ct,[s[4]||(s[4]=t("div",{class:"stat-title"},"ç­ç´šå¹³å‡",-1)),t("div",it,o(V.value.toFixed(1)),1),t("div",ut,"ç¸½è©•åˆ†è¨˜éŒ„ï¼š"+o(B.value),1)]),t("div",vt,[s[5]||(s[5]=t("div",{class:"stat-title"},"æœ€é«˜åˆ†",-1)),t("div",mt,o(F.value),1),t("div",bt,o(x.value?.name),1)]),t("div",gt,[s[6]||(s[6]=t("div",{class:"stat-title"},"æœ€ä½åˆ†",-1)),t("div",_t,o(R.value),1),t("div",pt,o(f.value?.name),1)])]),t("div",ht,[t("div",xt,[t("div",ft,[t("div",yt,[t("div",St,[s[8]||(s[8]=t("label",{class:"label mb-0"},[t("span",{class:"label-text"},"æ’åºæ–¹å¼")],-1)),N(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>k.value=e),class:"select select-bordered w-32"},[...s[7]||(s[7]=[t("option",{value:"totalScore"},"ç¸½åˆ†",-1),t("option",{value:"averageScore"},"å¹³å‡åˆ†",-1),t("option",{value:"name"},"å§“å",-1),t("option",{value:"id"},"åº§è™Ÿ",-1)])],512),[[tt,k.value]]),s[9]||(s[9]=t("label",{class:"label mb-0 ml-4"},[t("span",{class:"label-text"},"æ’åºé †åº")],-1)),t("div",kt,[t("button",{class:y(["btn btn-sm","mr-2",m.value==="desc"?"btn-active":""]),onClick:s[1]||(s[1]=e=>m.value="desc")}," é«˜åˆ°ä½ ",2),t("button",{class:y(["btn btn-sm",m.value==="asc"?"btn-active":""]),onClick:s[2]||(s[2]=e=>m.value="asc")}," ä½åˆ°é«˜ ",2)])])]),t("div",wt,[t("button",{onClick:H,class:"btn btn-primary gap-2"},[st(l,{name:"Download",class:"w-4 h-4"}),s[10]||(s[10]=et(" åŒ¯å‡ºæˆç¸¾å–® ",-1))])])])])]),t("div",Ct,[t("div",It,[t("div",$t,[t("table",Mt,[s[11]||(s[11]=t("thead",null,[t("tr",null,[t("th",null,"æ’å"),t("th",null,"åº§è™Ÿ"),t("th",null,"å§“å"),t("th",null,"ç¸½åˆ†")])],-1)),t("tbody",null,[(c(!0),r(g,null,_(M.value,(e,d)=>(c(),r("tr",{key:e.id,class:y(O(e,d))},[t("td",null,[t("div",Vt,[t("span",Ft,o(d+1),1),d<3?(c(),r("div",Rt,o(["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"][d]),1)):p("",!0)])]),t("td",null,o(e.id),1),t("td",null,[t("div",Dt,o(e.name),1),e.isPresent?p("",!0):(c(),r("div",Nt," ç¼ºå¸­ "))]),t("td",null,[t("span",Tt,o(e.totalScore),1)])],2))),128))])])])])]),t("dialog",{ref_key:"detailModal",ref:C,class:"modal"},[t("div",zt,[u.value?(c(),r("h3",jt,o(u.value.name)+" çš„è©³ç´°æˆç¸¾ ",1)):p("",!0),u.value?(c(),r("div",Lt,[t("div",Bt,[t("div",At,[s[12]||(s[12]=t("div",{class:"stat-title"},"ç¸½åˆ†",-1)),t("div",Pt,o(u.value.totalScore),1)]),t("div",Ut,[s[13]||(s[13]=t("div",{class:"stat-title"},"å¹³å‡åˆ†",-1)),t("div",Wt,o(u.value.averageScore.toFixed(1)),1)]),t("div",Et,[s[14]||(s[14]=t("div",{class:"stat-title"},"ç­ç´šæ’å",-1)),t("div",Gt,o(q(u.value.id)),1)])]),t("div",Ot,[t("div",qt,[s[15]||(s[15]=t("h4",{class:"card-title text-base"},"å„é¡åˆ¥å¾—åˆ†çµ±è¨ˆ",-1)),t("div",Ht,[(c(),r(g,null,_(w,e=>t("div",{key:e.id,class:"stat bg-base-200 rounded-lg"},[t("div",Jt,o(e.name),1),t("div",{class:"stat-value text-sm",style:T({color:e.color})},o(W(u.value,e.id)),5),t("div",Kt,o(E(u.value,e.id))+" æ¬¡è¨˜éŒ„ ",1)])),64))])])]),t("div",Qt,[t("div",Xt,[s[16]||(s[16]=t("h4",{class:"card-title text-base"},"è©•åˆ†è¨˜éŒ„",-1)),t("div",Yt,[(c(!0),r(g,null,_(u.value.scores.slice().reverse(),e=>(c(),r("div",{key:e.id,class:"flex justify-between items-center p-3 bg-base-200 rounded"},[t("div",null,[t("div",Zt,[t("span",{class:y(["badge",e.value>0?"badge-success":"badge-error"])},o(e.value>0?"+":"")+o(e.value),3),t("span",ts,o(e.categoryName),1)]),e.reason?(c(),r("p",ss,o(e.reason),1)):p("",!0)]),t("div",es,o(ot(nt)(e.timestamp)),1)]))),128))])])])])):p("",!0),t("div",{class:"modal-action"},[t("button",{onClick:D,class:"btn btn-ghost"},"é—œé–‰")])]),t("form",{method:"dialog",class:"modal-backdrop"},[t("button",{onClick:D},"close")])],512),t("dialog",{ref_key:"reportModal",ref:S,class:"modal"},[t("div",as,[t("h3",os,o($.value),1),t("div",ls,[N(t("textarea",{"onUpdate:modelValue":s[3]||(s[3]=e=>h.value=e),class:"textarea textarea-bordered h-64",readonly:""},null,512),[[lt,h.value]])]),t("div",{class:"modal-action"},[t("button",{onClick:Q,class:"btn btn-success"}," è¤‡è£½åˆ°å‰ªè²¼ç°¿ "),t("button",{onClick:J,class:"btn btn-ghost"},"é—œé–‰")])])],512),t("dialog",{ref_key:"chartModal",ref:I,class:"modal"},[t("div",ns,[s[19]||(s[19]=t("h3",{class:"text-lg font-bold mb-4"},"æˆç¸¾çµ±è¨ˆåœ–è¡¨",-1)),t("div",ds,[t("div",rs,[t("div",cs,[s[17]||(s[17]=t("h4",{class:"card-title text-base"},"åˆ†æ•¸åˆ†å¸ƒ",-1)),t("div",is,[(c(!0),r(g,null,_(P.value,(e,d)=>(c(),r("div",{key:d,class:"stat bg-base-200 rounded"},[t("div",us,o(e.label),1),t("div",vs,o(e.count),1)]))),128))])])]),t("div",ms,[t("div",bs,[s[18]||(s[18]=t("h4",{class:"card-title text-base"},"å„é¡åˆ¥å¹³å‡åˆ†",-1)),t("div",gs,[(c(!0),r(g,null,_(U.value,e=>(c(),r("div",{key:e.categoryId,class:"stat bg-base-200 rounded"},[t("div",_s,o(e.categoryName),1),t("div",{class:"stat-value text-sm",style:T({color:G(e.categoryId)})},o(e.average.toFixed(1)),5),t("div",ps,o(e.count)+" æ¬¡è¨˜éŒ„",1)]))),128))])])])]),t("div",{class:"modal-action"},[t("button",{onClick:K,class:"btn btn-ghost"},"é—œé–‰")])])],512)])):(c(),r("div",hs,[...s[20]||(s[20]=[t("p",null,"æ­£åœ¨è¼‰å…¥ç­ç´šè³‡æ–™...",-1),t("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}}});export{Ss as default};
