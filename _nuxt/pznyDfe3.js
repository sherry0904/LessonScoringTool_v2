import{f as W,g as z,r as h,i as k,u as E,c as l,o as a,a as s,j as v,l as o,b as c,d as u,L as F,k as I,s as P,m as N,F as g,n as x,t as i,x as q,v as X}from"#entry";const J={class:"p-6 max-w-7xl mx-auto space-y-8"},K={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},O={class:"flex gap-2"},Q=["disabled"],Y=["disabled"],Z={class:"grid gap-6 md:grid-cols-3"},ss={class:"md:col-span-1 space-y-4"},es={class:"card bg-base-100 border border-base-300 shadow-sm"},ts={class:"card-body space-y-4"},ls=["value"],as={key:0,class:"space-y-2"},ns={class:"flex gap-2 flex-wrap"},os=["onClick"],ds={key:1,class:"grid grid-cols-2 gap-4"},is={class:"h-9 flex items-center text-sm font-medium"},rs={key:2,class:"pt-2 border-t border-base-300"},cs={key:0,class:"card bg-base-100 border border-success shadow-sm"},us={class:"card-body space-y-2"},ms={class:"card-title text-base flex items-center gap-2 text-success"},bs={class:"text-sm"},ps={key:0,class:"text-sm"},vs={key:1,class:"text-sm"},gs={class:"md:col-span-2 space-y-6"},xs={key:0,class:"space-y-4"},fs={class:"font-semibold flex items-center gap-2"},_s={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},ys={class:"flex items-center justify-between"},hs={class:"font-medium"},ws=["onClick"],ks={class:"text-sm space-y-1"},Cs={key:1,class:"space-y-4"},Ds={class:"font-semibold flex items-center gap-2"},As={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},Ss={class:"flex items-center justify-between"},$s={class:"font-medium"},Ms={class:"text-sm space-y-1"},Ts={key:2,class:"p-12 text-center bg-base-100 rounded-2xl border border-dashed border-base-300"},Is=["disabled"],Ns={key:3,class:"space-y-4"},Vs={class:"font-semibold flex items-center gap-2"},js={class:"space-y-2"},Gs={class:"collapse-title text-sm font-medium flex items-center gap-3"},Ls={class:"text-xs opacity-60"},Us={key:0,class:"text-xs"},Bs={class:"collapse-content"},Hs={class:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3 mt-2"},Rs={class:"text-xs font-semibold mb-1"},Ws={class:"text-xs space-y-0.5"},zs={class:"mt-3 flex gap-2"},Es=["onClick"],qs=W({__name:"groups",setup(Fs){const w=z(),_=h(""),S=h("random"),y=h(4),p=h([]),r=h(null),C=h([]),V=[{value:"random",label:"隨機"},{value:"balanced",label:"均衡(佔位)"},{value:"fixed",label:"固定(佔位)"}],b=k(()=>w.classes.find(d=>d.id===_.value)||null),j=k(()=>b.value?Math.round(b.value.students.length/y.value):0),$=k(()=>!!b.value&&p.value.length>0&&!r.value),D=()=>{if(!b.value)return;const d=[...b.value.students];for(let n=d.length-1;n>0;n--){const t=Math.floor(Math.random()*(n+1));[d[n],d[t]]=[d[t],d[n]]}const e=Array.from({length:y.value},(n,t)=>({id:`draft_${t}`,members:[]}));d.forEach((n,t)=>{e[t%y.value].members.push(n)}),p.value=e},G=()=>D(),L=d=>{p.value.splice(d,1)},U=()=>{!$.value||!b.value||(r.value={id:`session_${Date.now()}`,classId:b.value.id,className:b.value.name,groups:p.value.map(d=>({id:d.id.replace("draft","group"),members:d.members})),startedAt:new Date},p.value=[],w.startClassGrouping(b.value.id))},M=()=>{r.value&&(r.value.endedAt=new Date,C.value.unshift(r.value),w.endClassGrouping(r.value.classId),r.value=null)},B=d=>{p.value=d.groups.map(e=>({id:`draft_reuse_${e.id}`,members:e.members})),_.value=d.classId},A=d=>new Date(d).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}),H=(d,e)=>{const n=(new Date(e).getTime()-new Date(d).getTime())/1e3,t=Math.floor(n/60),m=Math.floor(n%60);return`${t}分${m}秒`},R=k(()=>{if(!r.value)return"";const d=(Date.now()-new Date(r.value.startedAt).getTime())/1e3,e=Math.floor(d/60),n=Math.floor(d%60);return`${e}分${n}秒`});return E({title:"分組管理 - 班級分組計分工具"}),(d,e)=>{const n=F;return a(),l("div",J,[s("div",K,[e[5]||(e[5]=s("div",null,[s("h1",{class:"text-3xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent"}," 分組管理 "),s("p",{class:"text-base-content/70 mt-2"},"建立、進行與追蹤課堂分組")],-1)),s("div",O,[s("button",{class:"btn btn-outline gap-2",onClick:D,disabled:!o(_)},[c(n,{name:"Wand2",class:"w-4 h-4"}),e[2]||(e[2]=u(" 生成草稿 ",-1))],8,Q),s("button",{class:"btn btn-primary gap-2",onClick:U,disabled:!o($)},[c(n,{name:"Play",class:"w-4 h-4"}),e[3]||(e[3]=u(" 開始分組 ",-1))],8,Y),o(r)?(a(),l("button",{key:0,class:"btn btn-warning gap-2",onClick:M},[c(n,{name:"Square",class:"w-4 h-4"}),e[4]||(e[4]=u(" 結束 ",-1))])):v("",!0)])]),s("div",Z,[s("div",ss,[s("div",es,[s("div",ts,[e[12]||(e[12]=s("h2",{class:"card-title text-base"},"選擇班級",-1)),I(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>N(_)?_.value=t:null),class:"select select-bordered w-full"},[e[6]||(e[6]=s("option",{disabled:"",value:""},"請選擇班級",-1)),(a(!0),l(g,null,x(o(w).classes,t=>(a(),l("option",{key:t.id,value:t.id},i(t.name)+" ("+i(t.students.length)+") ",9,ls))),128))],512),[[P,o(_)]]),o(b)?(a(),l("div",as,[e[7]||(e[7]=s("label",{class:"text-sm font-medium opacity-70"},"分組方式",-1)),s("div",ns,[(a(),l(g,null,x(V,t=>s("button",{key:t.value,onClick:m=>S.value=t.value,class:q(["btn btn-xs",o(S)===t.value?"btn-primary":"btn-outline"])},i(t.label),11,os)),64))])])):v("",!0),o(b)?(a(),l("div",ds,[s("div",null,[e[8]||(e[8]=s("label",{class:"label-text text-xs opacity-70"},"組數",-1)),I(s("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=t=>N(y)?y.value=t:null),min:"2",class:"input input-bordered input-sm w-full"},null,512),[[X,o(y),void 0,{number:!0}]])]),s("div",null,[e[9]||(e[9]=s("label",{class:"label-text text-xs opacity-70"},"每組人數(參考)",-1)),s("div",is," ~ "+i(o(j))+" 人 ",1)])])):v("",!0),o(p).length?(a(),l("div",rs,[e[11]||(e[11]=s("p",{class:"text-xs opacity-70 mb-2"},"草稿：拖曳調整或重新生成",-1)),s("button",{class:"btn btn-xs btn-outline w-full",onClick:G},[c(n,{name:"RefreshCw",class:"w-3 h-3"}),e[10]||(e[10]=u(" 重新生成 ",-1))])])):v("",!0)])]),o(r)?(a(),l("div",cs,[s("div",us,[s("h2",ms,[c(n,{name:"Timer",class:"w-5 h-5"}),e[13]||(e[13]=u(" 進行中 ",-1))]),s("div",bs," 開始時間："+i(A(o(r).startedAt)),1),o(r).endedAt?(a(),l("div",ps," 結束："+i(A(o(r).endedAt)),1)):(a(),l("div",vs,"已進行："+i(o(R)),1)),s("div",{class:"flex gap-2"},[s("button",{class:"btn btn-xs btn-outline",onClick:M}," 結束並保存 ")])])])):v("",!0)]),s("div",gs,[o(p).length&&!o(r)?(a(),l("div",xs,[s("h2",fs,[c(n,{name:"Hammer",class:"w-5 h-5"}),e[14]||(e[14]=u(" 草稿分組 ",-1))]),s("div",_s,[(a(!0),l(g,null,x(o(p),(t,m)=>(a(),l("div",{key:t.id,class:"bg-base-100 border border-base-300 rounded-xl p-4 space-y-2"},[s("div",ys,[s("span",hs,"第 "+i(m+1)+" 組 ("+i(t.members.length)+")",1),s("button",{class:"btn btn-ghost btn-xs",onClick:f=>L(m)},[c(n,{name:"X",class:"w-3 h-3"})],8,ws)]),s("ul",ks,[(a(!0),l(g,null,x(t.members,f=>(a(),l("li",{key:f.id,class:"flex items-center gap-1"},[c(n,{name:"User",class:"w-3 h-3 opacity-60"}),u(" "+i(f.name),1)]))),128))])]))),128))])])):v("",!0),o(r)?(a(),l("div",Cs,[s("h2",Ds,[c(n,{name:"Users",class:"w-5 h-5"}),e[15]||(e[15]=u(" 進行中分組 ",-1))]),s("div",As,[(a(!0),l(g,null,x(o(r).groups,(t,m)=>(a(),l("div",{key:t.id,class:"bg-base-100 border border-base-300 rounded-xl p-4 space-y-2"},[s("div",Ss,[s("span",$s,"第 "+i(m+1)+" 組 ("+i(t.members.length)+")",1)]),s("ul",Ms,[(a(!0),l(g,null,x(t.members,f=>(a(),l("li",{key:f.id,class:"flex items-center gap-1"},[c(n,{name:"User",class:"w-3 h-3 opacity-60"}),u(" "+i(f.name),1)]))),128))])]))),128))])])):v("",!0),!o(p).length&&!o(r)?(a(),l("div",Ts,[c(n,{name:"Boxes",class:"w-14 h-14 mx-auto mb-6 text-base-content/40"}),e[17]||(e[17]=s("h3",{class:"text-xl font-bold mb-2"},"準備開始分組",-1)),e[18]||(e[18]=s("p",{class:"text-base-content/60 mb-6"}," 選擇班級與參數，點擊「生成草稿」即可快速預覽分組結果 ",-1)),s("button",{class:"btn btn-primary gap-2",disabled:!o(_),onClick:D},[c(n,{name:"Wand2",class:"w-4 h-4"}),e[16]||(e[16]=u(" 生成草稿 ",-1))],8,Is)])):v("",!0),o(C).length?(a(),l("div",Ns,[s("h2",Vs,[c(n,{name:"History",class:"w-5 h-5"}),e[19]||(e[19]=u(" 歷史紀錄 ",-1))]),s("div",js,[(a(!0),l(g,null,x(o(C),t=>(a(),l("div",{key:t.id,class:"collapse collapse-arrow border border-base-300 bg-base-100"},[e[21]||(e[21]=s("input",{type:"checkbox"},null,-1)),s("div",Gs,[c(n,{name:"Calendar",class:"w-4 h-4 opacity-60"}),u(" "+i(A(t.startedAt))+" ",1),s("span",Ls,i(t.className),1),t.endedAt?(a(),l("span",Us,"耗時 "+i(H(t.startedAt,t.endedAt)),1)):v("",!0)]),s("div",Bs,[s("div",Hs,[(a(!0),l(g,null,x(t.groups,(m,f)=>(a(),l("div",{key:m.id,class:"bg-base-200 rounded-lg p-3"},[s("div",Rs," 第 "+i(f+1)+" 組 ("+i(m.members.length)+") ",1),s("ul",Ws,[(a(!0),l(g,null,x(m.members,T=>(a(),l("li",{key:T.id},i(T.name),1))),128))])]))),128))]),s("div",zs,[s("button",{class:"btn btn-xs btn-outline",onClick:m=>B(t)},[c(n,{name:"RotateCcw",class:"w-3 h-3"}),e[20]||(e[20]=u(" 重用 ",-1))],8,Es)])])]))),128))])])):v("",!0)])])])}}});export{qs as default};
