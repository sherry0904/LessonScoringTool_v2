import{f as W,g as J,i as u,M as K,r as k,h as Q,z as T,c as i,o as d,b as C,j as X,E as Y,l as o,F as w,a as t,d as Z,L as D,k as E,v as V,m as tt,n as $,t as c,x as et,p as st,G as ot}from"#entry";const lt={key:0,class:"space-y-6"},nt={class:"card bg-base-100 shadow-sm"},at={class:"card-body"},it={class:"flex justify-between items-center"},dt={class:"mt-4"},rt={key:0,class:"mt-4"},ut={class:"overflow-x-auto"},ct={class:"table w-full"},mt={class:"font-semibold"},bt=["onClick"],vt=["onClick"],pt={class:"flex justify-end items-center mt-4 gap-2"},ft=["disabled"],gt=["disabled"],ht={key:1,class:"text-center py-8 text-base-content/70"},_t={class:"modal-box"},kt={class:"text-lg font-bold mb-4"},wt={class:"form-control"},yt={class:"modal-action"},xt={type:"submit",class:"btn btn-primary"},Ct={key:1,class:"text-center p-8"},M=10,St=W({__name:"homework",setup(Mt){const y=J(),H=K(),j=ot(),S=u(()=>H.params.id),n=u(()=>y.classes.find(s=>s.id===S.value)),f=k(),b=k(null),r=Q({title:""}),m=k(""),a=k(1),B=["pending","submitted","needs_correction","completed"],g=u(()=>n.value?m.value.trim()?n.value.homeworks.filter(s=>s.title.includes(m.value.trim())):n.value.homeworks:[]),h=u(()=>Math.max(1,Math.ceil(g.value.length/M))),F=u(()=>{const s=(a.value-1)*M;return g.value.slice(s,s+M)}),N=s=>({pending:"badge-error",submitted:"badge-success",needs_correction:"badge-warning",completed:"badge-info"})[s]||"badge-neutral",z=(s,e)=>s?Object.values(s.studentStatus).filter(v=>v===e).length:0,L=s=>s?(typeof s=="string"?new Date(s):s).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}):"",P=s=>{j.push({path:`/class/${S.value}/homework/${s}`})},x=u(()=>b.value!==null),I=u(()=>x.value?"編輯作業":"新增作業"),R=u(()=>x.value?"更新":"新增"),A=()=>{b.value=null,r.title="",f.value?.showModal()},O=s=>{const e=n.value?.homeworks.find(v=>v.id===s);e&&(b.value=s,r.title=e.title,f.value?.showModal())},_=()=>{f.value?.close()},U=()=>{!r.title.trim()||!n.value||(y.addHomework(n.value.id,r.title),_())},q=()=>{!b.value||!r.title.trim()||!n.value||(y.updateHomeworkTitle(n.value.id,b.value,r.title),_())},G=()=>{x.value?q():U()};return T(m,()=>{a.value=1}),T(g,()=>{a.value>h.value&&(a.value=h.value)}),(s,e)=>{const v=Y;return d(),i(w,null,[C(v),o(H).name==="class-id-homework"?(d(),i(w,{key:0},[o(n)?(d(),i("div",lt,[t("div",nt,[t("div",at,[t("div",it,[e[5]||(e[5]=t("h3",{class:"card-title"},"作業列表",-1)),t("button",{onClick:A,class:"btn btn-primary gap-2"},[C(D,{name:"Plus",class:"w-4 h-4"}),e[4]||(e[4]=Z(" 新增作業 ",-1))])]),t("div",dt,[E(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>tt(m)?m.value=l:null),type:"text",class:"input input-bordered w-full",placeholder:"搜尋作業名稱..."},null,512),[[V,o(m)]])]),o(g).length>0?(d(),i("div",rt,[t("div",ut,[t("table",ct,[e[6]||(e[6]=t("thead",null,[t("tr",null,[t("th",null,"名稱"),t("th",null,"建立日期"),t("th",null,"狀態統計"),t("th",null,"操作")])],-1)),t("tbody",null,[(d(!0),i(w,null,$(o(F),l=>(d(),i("tr",{key:l.id},[t("td",mt,c(l.title),1),t("td",null,c(L(l.createdAt)),1),t("td",null,[(d(),i(w,null,$(B,p=>t("span",{key:p,class:et(["badge mr-1 min-w-[3em] justify-center text-white font-bold",N(p)])},c(z(l,p)),3)),64))]),t("td",null,[t("button",{onClick:p=>P(l.id),class:"btn btn-sm btn-outline"}," 詳情 ",8,bt),t("button",{onClick:p=>O(l.id),class:"btn btn-sm btn-ghost"},[C(D,{name:"Edit",class:"w-4 h-4"})],8,vt)])]))),128))])])]),t("div",pt,[t("button",{class:"btn btn-sm",disabled:o(a)===1,onClick:e[1]||(e[1]=l=>a.value--)}," 上一頁 ",8,ft),t("span",null,"第 "+c(o(a))+" 頁 / 共 "+c(o(h))+" 頁",1),t("button",{class:"btn btn-sm",disabled:o(a)===o(h),onClick:e[2]||(e[2]=l=>a.value++)}," 下一頁 ",8,gt)])])):(d(),i("div",ht," 還沒有作業，點擊上方按鈕新增第一個作業 "))])]),t("dialog",{ref_key:"homeworkModal",ref:f,class:"modal"},[t("div",_t,[t("h3",kt,c(o(I)),1),t("form",{onSubmit:st(G,["prevent"]),class:"space-y-4"},[t("div",wt,[e[7]||(e[7]=t("label",{class:"label mr-2"},[t("span",{class:"label-text"},"作業名稱")],-1)),E(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>o(r).title=l),type:"text",placeholder:"例如：數學習作 P.30-32",class:"input input-bordered",required:""},null,512),[[V,o(r).title]])]),t("div",yt,[t("button",{type:"button",onClick:_,class:"btn btn-ghost"}," 取消 "),t("button",xt,c(o(R)),1)])],32)]),t("form",{method:"dialog",class:"modal-backdrop"},[t("button",{onClick:_},"close")])],512)])):(d(),i("div",Ct,[...e[8]||(e[8]=[t("p",null,"正在載入班級資料...",-1),t("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))],64)):X("",!0)],64)}}});export{St as default};
