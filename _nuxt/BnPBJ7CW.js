import{f as tt,g as st,E as et,i as u,r as m,c,k as d,o as i,a as t,t as o,l as z,s as at,m as N,x as k,b as ot,d as lt,L as nt,F as p,n as h,j as x,O as L,v as dt}from"#entry";const rt={key:0,class:"space-y-6"},ct={class:"stats stats-horizontal shadow"},it={class:"stat"},ut={class:"stat-value text-primary"},vt={class:"stat-desc"},mt={class:"stat"},bt={class:"stat-value text-success"},gt={class:"stat-desc"},_t={class:"stat"},pt={class:"stat-value text-error"},ht={class:"stat-desc"},xt={class:"card bg-base-100 shadow-sm"},ft={class:"card-body"},yt={class:"flex flex-wrap gap-4 items-center justify-between"},St={class:"flex flex-wrap gap-4 items-center"},kt={class:"flex items-center gap-4"},wt={class:"btn-group"},Ct={class:"flex gap-2"},It={class:"card bg-base-100 shadow-sm"},$t={class:"card-body p-0"},Mt={class:"overflow-x-auto"},Rt={class:"table table-zebra"},Dt={class:"flex items-center gap-2"},Ft={class:"font-bold"},Tt={key:0,class:"badge badge-warning badge-sm"},Vt={class:"font-semibold"},zt={key:0,class:"badge badge-error badge-xs"},Nt={class:"font-bold text-lg"},Lt={class:"modal-box w-11/12 max-w-4xl"},jt={key:0,class:"text-lg font-bold mb-4"},Bt={key:1,class:"space-y-6"},Et={class:"stats stats-horizontal shadow"},Ot={class:"stat"},Pt={class:"stat-value text-primary"},Ut={class:"stat"},Wt={class:"stat-value"},At={class:"stat"},Gt={class:"stat-value"},qt={class:"card bg-base-100"},Ht={class:"card-body"},Jt={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Kt={class:"stat-title text-xs"},Qt={class:"stat-desc text-xs"},Xt={class:"card bg-base-100"},Yt={class:"card-body"},Zt={class:"max-h-64 overflow-y-auto space-y-2"},ts={class:"flex items-center gap-2"},ss={class:"font-medium"},es={key:0,class:"text-sm text-base-content/70 mt-1"},as={class:"text-sm text-base-content/70"},os={class:"modal-box w-11/12 max-w-2xl"},ls={class:"text-lg font-bold mb-4"},ns={class:"form-control mb-4"},ds={class:"modal-box w-11/12 max-w-4xl"},rs={class:"space-y-6"},cs={class:"card bg-base-100"},is={class:"card-body"},us={class:"grid grid-cols-5 gap-2 text-center"},vs={class:"stat-title text-xs"},ms={class:"stat-value text-sm"},bs={class:"card bg-base-100"},gs={class:"card-body"},_s={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},ps={class:"stat-title text-xs"},hs={class:"stat-desc text-xs"},xs={key:1,class:"text-center p-8"},Ss=tt({__name:"grades",setup(fs){const j=st(),B=et(),E=u(()=>B.params.id),n=u(()=>j.classes.find(a=>a.id===E.value)),I=m(),w=m(),$=m(),f=m("totalScore"),b=m("desc");m("");const v=m(null),M=m(""),g=m(""),C=[{id:"participation",name:"參與度",color:"#3b82f6"},{id:"homework",name:"作業",color:"#10b981"},{id:"behavior",name:"行為表現",color:"#f59e0b"},{id:"creativity",name:"創意思考",color:"#8b5cf6"},{id:"group",name:"小組活動",color:"#ef4444"}],R=u(()=>{if(!n.value)return[];let a=[...n.value.students];return a.sort((s,l)=>{let e,r;switch(f.value){case"totalScore":e=s.totalScore,r=l.totalScore;break;case"averageScore":e=s.averageScore,r=l.averageScore;break;case"name":e=s.name,r=l.name;break;case"id":e=parseInt(s.id)||0,r=parseInt(l.id)||0;break;default:return 0}return typeof e=="string"&&typeof r=="string"?b.value==="desc"?r.localeCompare(e):e.localeCompare(r):b.value==="desc"?r-e:e-r}),a}),D=u(()=>{if(!n.value)return 0;const a=n.value.students.reduce((s,l)=>s+l.totalScore,0);return n.value.students.length>0?a/n.value.students.length:0}),O=u(()=>n.value?n.value.students.reduce((a,s)=>a+s.scores.length,0):0),y=u(()=>n.value?n.value.students.reduce((a,s)=>s.totalScore>(a?.totalScore||-1/0)?s:a,null):null),S=u(()=>n.value?n.value.students.reduce((a,s)=>s.totalScore<(a?.totalScore||1/0)?s:a,null):null),F=u(()=>y.value?.totalScore||0),T=u(()=>S.value?.totalScore||0),P=u(()=>{if(!n.value)return 0;const a=n.value.students.filter(s=>s.totalScore>=60).length;return n.value.students.length>0?Math.round(a/n.value.students.length*100):0}),U=u(()=>{const a=[{label:"90-100",min:90,max:100},{label:"80-89",min:80,max:89},{label:"70-79",min:70,max:79},{label:"60-69",min:60,max:69},{label:"0-59",min:0,max:59}];return n.value?a.map(s=>({...s,count:n.value.students.filter(l=>l.totalScore>=s.min&&l.totalScore<=s.max).length})):a.map(s=>({...s,count:0}))}),W=u(()=>n.value?C.map(a=>{const s=n.value.students.flatMap(r=>r.scores.filter(_=>_.categoryId===a.id).map(_=>_.value)),l=s.reduce((r,_)=>r+_,0),e=s.length>0?l/s.length:0;return{categoryId:a.id,categoryName:a.name,total:l,average:e,count:s.length}}):[]),A=(a,s)=>a.scores.filter(e=>e.categoryId===s).map(e=>e.value).reduce((e,r)=>e+r,0),G=(a,s)=>a.scores.filter(l=>l.categoryId===s).length,q=a=>C.find(s=>s.id===a)?.color||"#666",H=(a,s)=>{const l=[];return s<3&&l.push("bg-warning/10"),a.isPresent||l.push("opacity-60"),l.join(" ")},J=a=>n.value?[...n.value.students].sort((l,e)=>e.totalScore-l.totalScore).findIndex(l=>l.id===a)+1:0,V=()=>{I.value?.close(),v.value=null},K=()=>{if(!n.value||!y.value||!S.value)return;const a=[`${n.value.name} 成績報告`,`匯出時間：${new Date().toLocaleString("zh-TW")}`,"","班級統計：",`平均分：${D.value.toFixed(1)}`,`最高分：${F.value} (${y.value.name})`,`最低分：${T.value} (${S.value.name})`,`及格率：${P.value}%`,"","學生成績：","排名	座號	姓名	總分	平均分",...R.value.map((s,l)=>`${l+1}	${s.id}	${s.name}	${s.totalScore}	${s.averageScore.toFixed(1)}`)].join(`
`);M.value="班級成績報告",g.value=a,w.value?.showModal()},Q=()=>{w.value?.close()},X=()=>{$.value?.close()},Y=async()=>{try{await navigator.clipboard.writeText(g.value),alert("已複製到剪貼簿！")}catch(a){console.error("複製失敗:",a),alert("複製失敗，請手動選取文字複製。")}},Z=a=>new Date(a).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return(a,s)=>{const l=nt;return d(n)?(i(),c("div",rt,[t("div",ct,[t("div",it,[s[4]||(s[4]=t("div",{class:"stat-title"},"班級平均",-1)),t("div",ut,o(d(D).toFixed(1)),1),t("div",vt,"總評分記錄："+o(d(O)),1)]),t("div",mt,[s[5]||(s[5]=t("div",{class:"stat-title"},"最高分",-1)),t("div",bt,o(d(F)),1),t("div",gt,o(d(y)?.name),1)]),t("div",_t,[s[6]||(s[6]=t("div",{class:"stat-title"},"最低分",-1)),t("div",pt,o(d(T)),1),t("div",ht,o(d(S)?.name),1)])]),t("div",xt,[t("div",ft,[t("div",yt,[t("div",St,[t("div",kt,[s[8]||(s[8]=t("label",{class:"label mb-0"},[t("span",{class:"label-text"},"排序方式")],-1)),z(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>N(f)?f.value=e:null),class:"select select-bordered w-32"},[...s[7]||(s[7]=[t("option",{value:"totalScore"},"總分",-1),t("option",{value:"averageScore"},"平均分",-1),t("option",{value:"name"},"姓名",-1),t("option",{value:"id"},"座號",-1)])],512),[[at,d(f)]]),s[9]||(s[9]=t("label",{class:"label mb-0 ml-4"},[t("span",{class:"label-text"},"排序順序")],-1)),t("div",wt,[t("button",{class:k(["btn btn-sm","mr-2",d(b)==="desc"?"btn-active":""]),onClick:s[1]||(s[1]=e=>b.value="desc")}," 高到低 ",2),t("button",{class:k(["btn btn-sm",d(b)==="asc"?"btn-active":""]),onClick:s[2]||(s[2]=e=>b.value="asc")}," 低到高 ",2)])])]),t("div",Ct,[t("button",{onClick:K,class:"btn btn-primary gap-2"},[ot(l,{name:"Download",class:"w-4 h-4"}),s[10]||(s[10]=lt(" 匯出成績單 ",-1))])])])])]),t("div",It,[t("div",$t,[t("div",Mt,[t("table",Rt,[s[11]||(s[11]=t("thead",null,[t("tr",null,[t("th",null,"排名"),t("th",null,"座號"),t("th",null,"姓名"),t("th",null,"總分")])],-1)),t("tbody",null,[(i(!0),c(p,null,h(d(R),(e,r)=>(i(),c("tr",{key:e.id,class:k(H(e,r))},[t("td",null,[t("div",Dt,[t("span",Ft,o(r+1),1),r<3?(i(),c("div",Tt,o(["🥇","🥈","🥉"][r]),1)):x("",!0)])]),t("td",null,o(e.id),1),t("td",null,[t("div",Vt,o(e.name),1),e.isPresent?x("",!0):(i(),c("div",zt," 缺席 "))]),t("td",null,[t("span",Nt,o(e.totalScore),1)])],2))),128))])])])])]),t("dialog",{ref_key:"detailModal",ref:I,class:"modal"},[t("div",Lt,[d(v)?(i(),c("h3",jt,o(d(v).name)+" 的詳細成績 ",1)):x("",!0),d(v)?(i(),c("div",Bt,[t("div",Et,[t("div",Ot,[s[12]||(s[12]=t("div",{class:"stat-title"},"總分",-1)),t("div",Pt,o(d(v).totalScore),1)]),t("div",Ut,[s[13]||(s[13]=t("div",{class:"stat-title"},"平均分",-1)),t("div",Wt,o(d(v).averageScore.toFixed(1)),1)]),t("div",At,[s[14]||(s[14]=t("div",{class:"stat-title"},"班級排名",-1)),t("div",Gt,o(J(d(v).id)),1)])]),t("div",qt,[t("div",Ht,[s[15]||(s[15]=t("h4",{class:"card-title text-base"},"各類別得分統計",-1)),t("div",Jt,[(i(),c(p,null,h(C,e=>t("div",{key:e.id,class:"stat bg-base-200 rounded-lg"},[t("div",Kt,o(e.name),1),t("div",{class:"stat-value text-sm",style:L({color:e.color})},o(A(d(v),e.id)),5),t("div",Qt,o(G(d(v),e.id))+" 次記錄 ",1)])),64))])])]),t("div",Xt,[t("div",Yt,[s[16]||(s[16]=t("h4",{class:"card-title text-base"},"評分記錄",-1)),t("div",Zt,[(i(!0),c(p,null,h(d(v).scores.slice().reverse(),e=>(i(),c("div",{key:e.id,class:"flex justify-between items-center p-3 bg-base-200 rounded"},[t("div",null,[t("div",ts,[t("span",{class:k(["badge",e.value>0?"badge-success":"badge-error"])},o(e.value>0?"+":"")+o(e.value),3),t("span",ss,o(e.categoryName),1)]),e.reason?(i(),c("p",es,o(e.reason),1)):x("",!0)]),t("div",as,o(Z(e.timestamp)),1)]))),128))])])])])):x("",!0),t("div",{class:"modal-action"},[t("button",{onClick:V,class:"btn btn-ghost"},"關閉")])]),t("form",{method:"dialog",class:"modal-backdrop"},[t("button",{onClick:V},"close")])],512),t("dialog",{ref_key:"reportModal",ref:w,class:"modal"},[t("div",os,[t("h3",ls,o(d(M)),1),t("div",ns,[z(t("textarea",{"onUpdate:modelValue":s[3]||(s[3]=e=>N(g)?g.value=e:null),class:"textarea textarea-bordered h-64",readonly:""},null,512),[[dt,d(g)]])]),t("div",{class:"modal-action"},[t("button",{onClick:Y,class:"btn btn-success"}," 複製到剪貼簿 "),t("button",{onClick:Q,class:"btn btn-ghost"},"關閉")])])],512),t("dialog",{ref_key:"chartModal",ref:$,class:"modal"},[t("div",ds,[s[19]||(s[19]=t("h3",{class:"text-lg font-bold mb-4"},"成績統計圖表",-1)),t("div",rs,[t("div",cs,[t("div",is,[s[17]||(s[17]=t("h4",{class:"card-title text-base"},"分數分布",-1)),t("div",us,[(i(!0),c(p,null,h(d(U),(e,r)=>(i(),c("div",{key:r,class:"stat bg-base-200 rounded"},[t("div",vs,o(e.label),1),t("div",ms,o(e.count),1)]))),128))])])]),t("div",bs,[t("div",gs,[s[18]||(s[18]=t("h4",{class:"card-title text-base"},"各類別平均分",-1)),t("div",_s,[(i(!0),c(p,null,h(d(W),e=>(i(),c("div",{key:e.categoryId,class:"stat bg-base-200 rounded"},[t("div",ps,o(e.categoryName),1),t("div",{class:"stat-value text-sm",style:L({color:q(e.categoryId)})},o(e.average.toFixed(1)),5),t("div",hs,o(e.count)+" 次記錄",1)]))),128))])])])]),t("div",{class:"modal-action"},[t("button",{onClick:X,class:"btn btn-ghost"},"關閉")])])],512)])):(i(),c("div",xs,[...s[20]||(s[20]=[t("p",null,"正在載入班級資料...",-1),t("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}}});export{Ss as default};
