import{f as Z,c,o as u,a as s,b as v,L as y,x as _,t as m,k as S,W as re,_ as Se,d as h,X as qs,F as W,p as se,n as ue,Y as Hs,w as Ee,Z as Ws,z as Qs,$ as Ks,D as Pe,a0 as Ys,T as Zs,r as C,a1 as Ze,y as ee,C as Xs,g as Xe,h as Js,s as et,M as Ye,j as E,H as st,a2 as tt,l as k,B as nt,U as ot,a3 as lt,a4 as at,K as it,u as rt}from"#entry";const B={minGroups:2,maxGroups:10,defaultGroupCount:4,defaultColors:["#3b82f6","#ef4444","#10b981","#f59e0b","#8b5cf6","#ec4899","#06b6d4","#84cc16"]};B.minGroups,B.maxGroups,`${B.minGroups}${B.maxGroups}`;const ut={class:"relative"},dt={key:0,class:"flex flex-col gap-2"},ct={class:"flex items-center justify-between"},pt={class:"flex items-center gap-1.5 font-medium"},vt={class:"flex items-center gap-2"},mt={class:"invincible-progress flex-1"},bt={class:"invincible-progress-track"},gt={key:0,class:"badge badge-sm border-none bg-amber-200 text-amber-700"},ft={class:"flex items-center gap-1 text-xs text-amber-600"},ht={key:1,class:"flex items-center gap-2 sm:gap-2.5"},yt={class:"flex items-center gap-1 shrink-0"},wt={class:"flex-1 min-w-[40px]"},St={class:"h-2 w-full bg-gray-200 rounded-full overflow-hidden"},$t={key:0,class:"badge badge-xs border-none bg-amber-200 text-amber-700 shrink-0"},Ct=Z({__name:"GroupRewardStatus",props:{group:{},formattedTimer:{},totalStars:{},starProgress:{},invincibleProgress:{},queueCount:{},starGainClass:{},countdownCritical:{type:Boolean}},setup(T){return(e,o)=>(u(),c("div",ut,[s("div",{class:_(["rounded-lg transition-colors overflow-hidden",[e.group.isInvincible?"border border-amber-200 bg-amber-50/70 text-amber-700 invincible-activate px-3 py-2":"text-base-content/70 px-1.5 py-1 sm:px-2 sm:py-1.5"]])},[e.group.isInvincible?(u(),c("div",dt,[s("div",ct,[s("div",pt,[v(y,{name:"Zap",class:"w-4 h-4 text-amber-500 invincible-pulse"}),o[0]||(o[0]=s("span",null,"ÁÑ°Êïµ",-1))]),s("span",{class:_(["font-semibold text-amber-600",e.countdownCritical?"countdown-critical":""])},m(e.formattedTimer),3)]),s("div",vt,[s("div",mt,[s("div",bt,[s("div",{class:"invincible-progress-fill",style:re({width:`${e.invincibleProgress*100}%`})},null,4)])]),e.queueCount>0?(u(),c("span",gt," +"+m(e.queueCount)+" Ê¨° ",1)):S("",!0)]),s("div",ft,[v(y,{name:"Star",class:"w-3.5 h-3.5 text-yellow-400"}),s("span",null,m(e.totalStars)+" È°ÜÊòü",1)])])):(u(),c("div",ht,[s("div",yt,[v(y,{name:"Star",class:"w-4 h-4 text-yellow-400 shrink-0"}),s("span",{class:_(["text-base font-bold tabular-nums text-amber-600",e.starGainClass])},m(e.totalStars),3)]),s("div",wt,[s("div",St,[s("div",{class:_(["h-full bg-gradient-to-r from-yellow-400 to-amber-500 transition-all duration-300",{"progress-flash":e.starProgress>=1}]),style:re({width:`${e.starProgress*100}%`})},null,6)])]),e.queueCount>0?(u(),c("span",$t,"+"+m(e.queueCount),1)):S("",!0)]))],2)]))}}),Gt=Object.assign(Se(Ct,[["__scopeId","data-v-3ac73ce0"]]),{__name:"GroupingGroupRewardStatus"}),kt={class:"flex items-center gap-2 mt-2"},It=["disabled"],xt=["disabled"],_t=Z({__name:"GroupActionButtons",props:{positiveLabel:{},negativeLabel:{},disabled:{type:Boolean}},emits:["add-positive","add-negative"],setup(T){return(e,o)=>(u(),c("div",kt,[s("button",{class:"btn btn-md flex-1 font-bold text-base px-4 py-1 rounded-full text-white border-none shadow transition-transform hover:scale-105 bg-gradient-to-r from-green-400 to-emerald-500 hover:from-green-500 hover:to-emerald-600 disabled:opacity-50 disabled:hover:scale-100",disabled:e.disabled,onClick:o[0]||(o[0]=i=>e.$emit("add-positive"))},m(e.positiveLabel),9,It),s("button",{class:"btn btn-md flex-1 font-bold text-base px-4 py-1 rounded-full text-white border-none shadow transition-transform hover:scale-105 bg-gradient-to-r from-rose-400 to-red-500 hover:from-rose-500 hover:to-red-600 disabled:opacity-50 disabled:hover:scale-100",disabled:e.disabled,onClick:o[1]||(o[1]=i=>e.$emit("add-negative"))},m(e.negativeLabel),9,xt)]))}}),Mt=Object.assign(_t,{__name:"GroupingGroupActionButtons"}),At={class:"card bg-base-100 shadow-sm"},Dt={class:"card-body p-4"},Tt={key:0,class:"flex flex-col gap-3"},Pt={key:0,class:"flex flex-wrap items-center gap-2"},Et={class:"badge badge-info gap-2"},Bt={class:"form-control mr-2"},jt=["value","min","max"],Ut={class:"ml-auto flex gap-2"},Nt=["disabled"],Rt={key:1,class:"flex flex-col lg:flex-row items-start lg:items-center gap-2 lg:gap-3"},Lt={class:"flex items-center gap-2 text-sm text-base-content/70 flex-wrap"},Ot={class:"badge badge-outline gap-1 shrink-0",title:"Â¶ÇÈúÄË™øÊï¥Ë´ãÈªûÊìä„ÄåÁ∑®ËºØÁµÑÂà•„Äç"},Ft=["value"],Vt={class:"ml-0 lg:ml-auto flex items-center gap-2 w-full lg:w-auto flex-wrap lg:flex-nowrap justify-end"},zt=["disabled","title"],qt=["disabled"],Ht={key:1,class:"flex flex-wrap gap-x-4 gap-y-2 items-center justify-between"},Wt={class:"flex items-center gap-3 flex-wrap"},Qt={class:"flex items-center gap-2 text-info font-semibold"},Kt=["value"],Yt={class:"flex items-center gap-2"},Zt=["disabled","title"],Xt=["disabled"],Jt=Z({__name:"GroupingControlPanel",props:{groupingActive:{type:Boolean},isGroupEditMode:{type:Boolean},groupCountInput:{},groupCountMin:{},groupCountMax:{},localGroupsLength:{},activityName:{},hasStudentsInGroups:{type:Boolean},rewardEnabled:{type:Boolean},groupsCollapsed:{type:Boolean}},emits:["update:groupCountInput","commitGroupCount","buildGroupsForCount","randomAssignGroups","resetAllGroups","openRewardInfoModal","saveGroupEdits","cancelGroupEdits","update:activityName","expandAllGroups","collapseAllGroups","toggleGroupsCollapsed","startGroupEditing","startGrouping","exportActivityReport","showGroupScoreboard","endGrouping"],setup(T){return(e,o)=>(u(),c("div",At,[s("div",Dt,[e.groupingActive?(u(),c("div",Ht,[s("div",Wt,[s("span",Qt,[v(y,{name:"CircleDot",class:"w-5 h-5 animate-pulse"}),o[30]||(o[30]=s("span",null,"ÂàÜÁµÑÈÄ≤Ë°å‰∏≠",-1))]),s("input",{value:e.activityName,type:"text",placeholder:"Ë´ãËº∏ÂÖ•Ê¥ªÂãïÂêçÁ®±...",class:"input input-sm input-bordered w-52",onInput:o[13]||(o[13]=i=>e.$emit("update:activityName",i.target.value))},null,40,Kt)]),s("div",Yt,[e.rewardEnabled?(u(),c("button",{key:0,onClick:o[14]||(o[14]=i=>e.$emit("openRewardInfoModal")),class:"btn btn-sm btn-info gap-1",type:"button"},[v(y,{name:"Sparkles",class:"w-4 h-4"}),o[31]||(o[31]=h("ÁçéÂãµË™™Êòé ",-1))])):S("",!0),s("button",{onClick:o[15]||(o[15]=i=>e.$emit("toggleGroupsCollapsed")),class:"btn btn-sm btn-outline gap-1",disabled:e.localGroupsLength===0,title:e.groupsCollapsed?"Â±ïÈñãÊâÄÊúâÁµÑÂì°":"Êî∂ÂêàÊâÄÊúâÁµÑÂì°"},[v(y,{name:e.groupsCollapsed?"ChevronDown":"ChevronUp",class:"w-4 h-4"},null,8,["name"]),h(" "+m(e.groupsCollapsed?"Â±ïÈñãÁµÑÂì°":"Êî∂ÂêàÁµÑÂì°"),1)],8,Zt),s("button",{onClick:o[16]||(o[16]=i=>e.$emit("exportActivityReport")),class:"btn btn-sm btn-info gap-1",disabled:!e.activityName.trim(),title:"ÂåØÂá∫Ê¥ªÂãïÂ†±Âëä"},[v(y,{name:"Download",class:"w-4 h-4"}),o[32]||(o[32]=h(" ÂåØÂá∫ ",-1))],8,Xt),s("button",{onClick:o[17]||(o[17]=i=>e.$emit("showGroupScoreboard")),class:"btn btn-sm btn-warning gap-1",title:"È°ØÁ§∫Á©çÂàÜÂÑÄË°®Êùø"},[v(y,{name:"Trophy",class:"w-4 h-4"}),o[33]||(o[33]=h(" ÂÑÄË°®Êùø ",-1))]),s("button",{onClick:o[18]||(o[18]=i=>e.$emit("endGrouping")),class:"btn btn-sm btn-error gap-1"},[v(y,{name:"Square",class:"w-4 h-4"}),o[34]||(o[34]=h(" ÁµêÊùüÂàÜÁµÑ ",-1))])])])):(u(),c("div",Tt,[e.isGroupEditMode?(u(),c("div",Pt,[s("span",Et,[v(y,{name:"Pencil",class:"w-3 h-3"}),o[19]||(o[19]=h("Á∑®ËºØÊ®°Âºè‰∏≠ ",-1))]),s("div",Bt,[o[20]||(o[20]=s("label",{class:"label py-1 mr-1"},[s("span",{class:"label-text"},"ÁµÑÊï∏")],-1)),s("input",{value:e.groupCountInput,type:"number",min:e.groupCountMin,max:e.groupCountMax,class:"input input-bordered w-20",onInput:o[0]||(o[0]=i=>e.$emit("update:groupCountInput",i.target.value)),onBlur:o[1]||(o[1]=i=>e.$emit("commitGroupCount")),onKeyup:o[2]||(o[2]=qs(i=>e.$emit("commitGroupCount"),["enter"]))},null,40,jt)]),s("button",{onClick:o[3]||(o[3]=i=>e.$emit("buildGroupsForCount")),class:"btn btn-outline"},[v(y,{name:"PlusCircle",class:"w-4 h-4 mr-2"}),o[21]||(o[21]=h("Âª∫Á´ãÁµÑÂà• ",-1))]),s("button",{onClick:o[4]||(o[4]=i=>e.$emit("randomAssignGroups")),class:"btn btn-primary"},[v(y,{name:"Shuffle",class:"w-4 h-4 mr-2"}),o[22]||(o[22]=h("‰∏ÄÈçµÈö®Ê©üÂàÜÁµÑ ",-1))]),s("button",{onClick:o[5]||(o[5]=i=>e.$emit("resetAllGroups")),class:"btn btn-ghost"},[v(y,{name:"Undo2",class:"w-4 h-4 mr-2"}),o[23]||(o[23]=h("‰∏ÄÈçµÈÇÑÂéü ",-1))]),s("div",Ut,[s("button",{onClick:o[6]||(o[6]=i=>e.$emit("saveGroupEdits")),class:"btn btn-success",disabled:e.localGroupsLength===0},[v(y,{name:"Save",class:"w-4 h-4 mr-2"}),o[24]||(o[24]=h("ÂÑ≤Â≠òÁµÑÂà•Á∑®ËºØ ",-1))],8,Nt),s("button",{onClick:o[7]||(o[7]=i=>e.$emit("cancelGroupEdits")),class:"btn btn-ghost"}," ÂèñÊ∂à ")])])):(u(),c("div",Rt,[s("div",Lt,[s("span",Ot,[v(y,{name:"Lock",class:"w-4 h-4"}),o[25]||(o[25]=h("ÈéñÂÆö ",-1))]),o[26]||(o[26]=s("span",{class:"shrink-0"},"Ê¥ªÂãïÂêçÁ®± (ÈÅ∏Â°´)",-1)),s("input",{value:e.activityName,type:"text",placeholder:"‰æãÂ¶ÇÔºöÁ¨¨‰∫åÊ¨°ÂàÜÁµÑË®éË´ñ",class:"input input-bordered input-sm lg:input-md w-full lg:w-60",onInput:o[8]||(o[8]=i=>e.$emit("update:activityName",i.target.value))},null,40,Ft)]),s("div",Vt,[e.rewardEnabled?(u(),c("button",{key:0,onClick:o[9]||(o[9]=i=>e.$emit("openRewardInfoModal")),class:"btn btn-sm btn-info gap-1",type:"button"},[v(y,{name:"Sparkles",class:"w-4 h-4"}),o[27]||(o[27]=h(" ÁçéÂãµË™™Êòé ",-1))])):S("",!0),s("button",{onClick:o[10]||(o[10]=i=>e.$emit("toggleGroupsCollapsed")),class:"btn btn-sm btn-outline gap-1",disabled:e.localGroupsLength===0,title:e.groupsCollapsed?"Â±ïÈñãÊâÄÊúâÁµÑÂì°":"Êî∂ÂêàÊâÄÊúâÁµÑÂì°"},[v(y,{name:e.groupsCollapsed?"ChevronDown":"ChevronUp",class:"w-4 h-4"},null,8,["name"]),h(" "+m(e.groupsCollapsed?"Â±ïÈñãÁµÑÂì°":"Êî∂ÂêàÁµÑÂì°"),1)],8,zt),s("button",{onClick:o[11]||(o[11]=i=>e.$emit("startGroupEditing")),class:"btn btn-outline"},[v(y,{name:"SquarePen",class:"w-4 h-4 mr-2"}),o[28]||(o[28]=h("Á∑®ËºØÁµÑÂà• ",-1))]),s("button",{onClick:o[12]||(o[12]=i=>e.$emit("startGrouping")),class:"btn btn-success gap-2",disabled:e.localGroupsLength===0||!e.hasStudentsInGroups},[v(y,{name:"Play",class:"w-4 h-4"}),o[29]||(o[29]=h("ÈñãÂßãÂàÜÁµÑÊ¥ªÂãï ",-1))],8,qt)])]))]))])]))}}),en=Object.assign(Jt,{__name:"GroupingControlPanel"}),sn={class:"card bg-base-100 shadow-sm h-full flex flex-col"},tn={class:"card-body flex flex-col h-full p-4"},nn={class:"flex items-center justify-between mb-4"},on={key:0,class:"card-title text-base flex items-center whitespace-nowrap"},ln={class:"badge badge-neutral ml-2"},an=["title"],rn={class:"sticky top-0 bg-base-100 pb-2 z-10"},un={class:"input input-bordered input-sm flex items-center gap-2"},dn=["value"],cn={class:"mt-3 flex items-center justify-between text-xs text-base-content/70"},pn=["disabled"],vn=["draggable","onDragstart"],mn={class:"flex items-start gap-3 flex-1"},bn=["checked","onClick"],gn={class:"font-medium"},fn={class:"text-sm text-base-content/70"},hn={class:"text-sm font-semibold text-primary"},yn={key:0,class:"text-center text-base-content/50 py-8"},wn={key:1,class:"flex justify-center items-center h-full"},Sn={class:"flex items-center justify-between mb-4"},$n={key:0,class:"card-title text-base flex items-center whitespace-nowrap"},Cn=["title"],Gn={key:0,class:"flex-1 overflow-y-auto"},kn={class:"flex items-center gap-3 min-w-0 flex-1"},In={class:"flex flex-col flex-1 min-w-0"},xn={class:"font-semibold text-sm truncate"},_n={class:"flex items-center gap-2 shrink-0"},Mn={key:0,class:"badge badge-sm gap-1 bg-amber-100 text-amber-600 border border-amber-200"},An={class:"font-semibold text-xs"},Dn={key:1,class:"text-right"},Tn={class:"text-lg font-bold text-primary"},Pn={key:1,class:"flex justify-center items-center h-full"},En=Z({__name:"GroupingSidebar",props:{collapsed:{type:Boolean},groupingActive:{type:Boolean},ungroupedSearch:{},ungroupedCount:{},filteredUngroupedStudents:{},selectedStudentIds:{},canModifyGroups:{type:Boolean},leaderboardGroups:{},groupStarCounts:{},showRewardStars:{type:Boolean},showGroupTotalScores:{type:Boolean}},emits:["toggle-collapse","update:ungroupedSearch","clear-selection","drag-start","drag-end","toggle-student-selection","unassigned-drop"],setup(T){return(e,o)=>(u(),c("aside",{class:_(["transition-all duration-300 flex-shrink-0",e.collapsed?"w-20":"w-80"])},[s("div",sn,[s("div",tn,[e.groupingActive?(u(),c(W,{key:1},[s("div",Sn,[e.collapsed?S("",!0):(u(),c("h3",$n,[v(y,{name:"Trophy",class:"w-5 h-5 mr-2"}),o[10]||(o[10]=h(" Âç≥ÊôÇÁ©çÂàÜÊ¶ú ",-1))])),s("button",{onClick:o[8]||(o[8]=i=>e.$emit("toggle-collapse",!e.collapsed)),class:"btn btn-ghost btn-sm btn-circle ml-auto",title:e.collapsed?"Â±ïÈñã":"Êî∂Âêà"},[v(y,{name:e.collapsed?"ChevronsRight":"ChevronsLeft",class:"w-4 h-4"},null,8,["name"])],8,Cn)]),e.collapsed?S("",!0):(u(),c("div",Gn,[v(Hs,{name:"leaderboard",tag:"div",class:"space-y-2"},{default:Ee(()=>[(u(!0),c(W,null,ue(e.leaderboardGroups,(i,f)=>(u(),c("div",{key:i.id,class:_(["p-3 rounded-lg flex items-center justify-between gap-3 transition-all",f===0?"bg-amber-100 border-2 border-amber-400":"bg-base-200"])},[s("div",kn,[s("div",{class:_(["text-lg font-bold w-6 text-center shrink-0",{"text-amber-500":f===0,"text-slate-400":f>2}])},m(f+1),3),s("div",{class:"w-4 h-4 rounded-full shrink-0",style:re({backgroundColor:i.color})},null,4),s("div",In,[s("div",xn,m(i.name),1)])]),s("div",_n,[e.showGroupTotalScores&&e.showRewardStars?(u(),c("div",Mn,[v(y,{name:"Star",class:"w-3.5 h-3.5"}),s("span",An,m(e.groupStarCounts[i.id]??0),1)])):S("",!0),e.showGroupTotalScores?(u(),c("div",Dn,[s("div",Tn,m(i.totalScore),1)])):S("",!0)])],2))),128))]),_:1})])),e.collapsed?(u(),c("div",Pn,[v(y,{name:"Trophy",class:"w-8 h-8 text-base-content/30"})])):S("",!0)],64)):(u(),c(W,{key:0},[s("div",nn,[e.collapsed?S("",!0):(u(),c("h3",on,[v(y,{name:"Users",class:"w-5 h-5 mr-2"}),o[9]||(o[9]=h(" Êú™ÂàÜÁµÑÂ≠∏Áîü ",-1)),s("span",ln,m(e.ungroupedCount)+" ‰∫∫",1)])),s("button",{onClick:o[0]||(o[0]=i=>e.$emit("toggle-collapse",!e.collapsed)),class:"btn btn-ghost btn-sm btn-circle ml-auto",title:e.collapsed?"Â±ïÈñã":"Êî∂Âêà"},[v(y,{name:e.collapsed?"ChevronsRight":"ChevronsLeft",class:"w-4 h-4"},null,8,["name"])],8,an)]),e.collapsed?S("",!0):(u(),c("div",{key:0,class:"flex-1 overflow-y-auto space-y-3 p-1",onDrop:o[5]||(o[5]=i=>e.$emit("unassigned-drop",i)),onDragover:o[6]||(o[6]=se(()=>{},["prevent"])),onDragenter:o[7]||(o[7]=se(()=>{},["prevent"]))},[s("div",rn,[s("label",un,[v(y,{name:"Search",class:"w-4 h-4 text-base-content/60"}),s("input",{value:e.ungroupedSearch,type:"text",class:"grow",placeholder:"ÊêúÂ∞ãÂßìÂêçÊàñÂ∫ßËôü",onInput:o[1]||(o[1]=i=>e.$emit("update:ungroupedSearch",i.target.value))},null,40,dn),e.ungroupedSearch?(u(),c("button",{key:0,type:"button",class:"btn btn-xs btn-ghost",onClick:o[2]||(o[2]=i=>e.$emit("update:ungroupedSearch",""))}," Ê∏ÖÈô§ ")):S("",!0)]),s("div",cn,[s("span",null,"Â∑≤ÈÅ∏ "+m(e.selectedStudentIds.length)+" ‰∫∫",1),s("button",{type:"button",class:"btn btn-ghost btn-xs",disabled:e.selectedStudentIds.length===0,onClick:o[3]||(o[3]=i=>e.$emit("clear-selection"))}," Ê∏ÖÈô§ÈÅ∏Âèñ ",8,pn)])]),(u(!0),c(W,null,ue(e.filteredUngroupedStudents,i=>(u(),c("div",{key:i.id,class:_(["p-3 bg-base-200 rounded-lg cursor-move hover:bg-base-300 transition-colors","flex justify-between items-center gap-3",e.selectedStudentIds.includes(i.id)&&e.canModifyGroups?"ring-2 ring-primary ring-offset-2":"","mt-2"]),draggable:e.canModifyGroups,onDragstart:f=>e.$emit("drag-start",i.id,"unassigned",f),onDragend:o[4]||(o[4]=f=>e.$emit("drag-end",f))},[s("div",mn,[e.canModifyGroups?(u(),c("input",{key:0,type:"checkbox",class:"checkbox checkbox-sm mt-1",checked:e.selectedStudentIds.includes(i.id),onClick:se(f=>e.$emit("toggle-student-selection",i.id),["stop"])},null,8,bn)):S("",!0),s("div",gn,m(i.name),1),s("div",fn," Â∫ßËôü "+m(i.id),1)]),s("div",hn,m(i.totalScore)+"ÂàÜ ",1)],42,vn))),128)),e.filteredUngroupedStudents.length===0?(u(),c("div",yn," ÊâÄÊúâÂ≠∏ÁîüÈÉΩÂ∑≤ÂàÜÁµÑ ")):S("",!0)],32)),e.collapsed?(u(),c("div",wn,[v(y,{name:"Users",class:"w-8 h-8 text-base-content/30"})])):S("",!0)],64))])])],2))}}),Bn=Object.assign(En,{__name:"GroupingSidebar"}),jn={key:0,class:"invincible-burst-layer"},Un={key:1,class:"invincible-rings-layer"},Nn={key:0,class:"milestone-floating"},Rn={class:"milestone-message"},Ln=Z({__name:"GroupCard",props:{compact:{type:Boolean},isInvincible:{type:Boolean},invincibleBurst:{type:Boolean},invincibleHighlight:{type:Boolean},milestoneMessage:{}},setup(T){return(e,o)=>(u(),c("div",Ws(e.$attrs,{class:["card bg-base-100 shadow-sm transition-all duration-300 relative",e.isInvincible?"invincible-glow":"",e.invincibleHighlight?"invincible-activate-scale":""]}),[e.invincibleBurst?(u(),c("div",jn,[...o[0]||(o[0]=[Qs('<span class="burst-star" data-v-c5107c19>‚≠ê</span><span class="burst-star" data-v-c5107c19>‚≠ê</span><span class="burst-star" data-v-c5107c19>‚≠ê</span><span class="burst-star" data-v-c5107c19>‚≠ê</span><span class="burst-star" data-v-c5107c19>‚≠ê</span><span class="burst-star" data-v-c5107c19>‚≠ê</span>',6)])])):S("",!0),e.invincibleHighlight?(u(),c("div",Un)):S("",!0),s("div",{class:_(["card-body flex flex-col gap-2 relative overflow-visible",e.compact?"p-2":"p-3"])},[e.milestoneMessage?(u(),c("div",Nn,[s("span",Rn,m(e.milestoneMessage),1)])):S("",!0),Ks(e.$slots,"default",{},void 0)],2)],16))}}),On=Object.assign(Se(Ln,[["__scopeId","data-v-c5107c19"]]),{__name:"GroupingGroupCard"}),Fn=["draggable","onDragstart","onDragover","onDrop"],Vn={key:0,class:"px-3 py-2 flex flex-col gap-1"},zn={class:"text-xs text-base-content/70"},qn={class:"font-medium text-sm"},Hn={key:1,class:"p-2 flex flex-col gap-2"},Wn={class:"flex justify-between items-center"},Qn={class:"font-medium text-sm flex items-center"},Kn={key:0,class:"ml-2 px-2 py-0.5 rounded bg-gray-300 text-xs text-gray-600"},Yn={class:"text-xs text-base-content/70"},Zn={class:"flex justify-end items-center gap-2"},Xn={key:0,class:"flex items-center gap-1 text-xs"},Jn={class:"opacity-60"},eo={key:1,class:"flex gap-1"},so=["onClick"],to=["onClick"],no=Z({__name:"GroupMembersList",props:{groupId:{},members:{},isEditMode:{type:Boolean},canModify:{type:Boolean},groupingActive:{type:Boolean},showIndividualScores:{type:Boolean},allowIndividualScoring:{type:Boolean},baseScores:{},sessionScores:{},studentScoreAnimation:{},dropIndicator:{}},emits:["drag-start","drag-end","member-drag-over","member-drop","add-individual-score"],setup(T){const e=T,o=(i,f)=>["rounded transition-all",e.canModify?"cursor-move border border-base-200 bg-base-100":i.isPresent?"bg-base-200":"bg-gray-200 text-gray-400 opacity-60",e.dropIndicator?.groupId===e.groupId&&e.dropIndicator.index===f?"ring-2 ring-primary ring-offset-2":"",!e.canModify&&i.isPresent?"hover:bg-base-300":""];return(i,f)=>(u(),c("div",{class:_(["flex-1",i.isEditMode?"grid grid-cols-1 md:grid-cols-2 gap-2":"flex flex-col gap-2"])},[(u(!0),c(W,null,ue(i.members,($,g)=>(u(),c("div",{key:$.id,class:_(o($,g)),draggable:i.canModify,onDragstart:G=>i.$emit("drag-start",$.id,i.groupId,G),onDragend:f[0]||(f[0]=G=>i.$emit("drag-end")),onDragover:se(G=>i.$emit("member-drag-over",i.groupId,g,G),["prevent"]),onDrop:se(G=>i.$emit("member-drop",i.groupId,g),["stop"])},[i.isEditMode?(u(),c("div",Vn,[s("div",zn,"Â∫ßËôü "+m($.id),1),s("div",qn,m($.name),1)])):(u(),c("div",Hn,[s("div",Wn,[s("div",Qn,[h(m($.name)+" ",1),$.isPresent?S("",!0):(u(),c("span",Kn," ‰ªäÊó•Áº∫Â∏≠ "))]),s("div",Yn,"Â∫ßËôü "+m($.id),1)]),s("div",Zn,[i.groupingActive?(u(),c(W,{key:0},[i.showIndividualScores?(u(),c("div",Xn,[s("span",Jn,m(i.baseScores[$.id]??""),1),f[1]||(f[1]=s("span",{class:"opacity-60"},"ÂàÜ",-1)),v(y,{name:"ArrowRight",class:"w-3 h-3 text-success"}),s("span",{class:_(["text-success font-bold",i.studentScoreAnimation?.[$.id]??""])},m((i.baseScores[$.id]??0)+(i.sessionScores[$.id]??0)),3),f[2]||(f[2]=s("span",{class:"text-success"},"ÂàÜ",-1))])):S("",!0),i.allowIndividualScoring?(u(),c("div",eo,[s("button",{class:"btn btn-xs btn-circle btn-outline btn-success",title:"ÂÄã‰∫∫Âä†ÂàÜ",onClick:G=>i.$emit("add-individual-score",$.id,1)}," + ",8,so),s("button",{class:"btn btn-xs btn-circle btn-outline btn-error",title:"ÂÄã‰∫∫Êâ£ÂàÜ",onClick:G=>i.$emit("add-individual-score",$.id,-1)}," - ",8,to)])):S("",!0)],64)):(u(),c(W,{key:1},[h(m($.totalScore)+"ÂàÜ ",1)],64))])]))],42,Fn))),128))],2))}}),oo=Object.assign(no,{__name:"GroupingGroupMembersList"}),lo={key:0,class:"celebration-overlay",role:"status","aria-live":"assertive"},ao={class:"celebration-content"},io={class:"headline"},ro={class:"details"},uo={class:"particle-layer"},co=Z({__name:"InvincibleCelebration",props:{visible:{type:Boolean},groupName:{},duration:{},pointsPerClick:{}},emits:["close"],setup(T){return(e,o)=>(u(),Pe(Zs,{to:"body"},[v(Ys,{name:"celebration-fade"},{default:Ee(()=>[e.visible?(u(),c("div",lo,[o[7]||(o[7]=s("div",{class:"celebration-backdrop"},null,-1)),s("div",ao,[o[4]||(o[4]=s("div",{class:"glow-ring"},null,-1)),o[5]||(o[5]=s("div",{class:"star-stack"},[s("span",{class:"star-icon"},"‚òÖ"),s("span",{class:"star-shadow"},"‚òÖ")],-1)),o[6]||(o[6]=s("p",{class:"subtitle"},"Invincible Mode Activated",-1)),s("h2",io,m(e.groupName)+" ÈÄ≤ÂÖ•ÁÑ°ÊïµÊòüÊòüÔºÅ ",1),s("p",ro,[o[1]||(o[1]=h(" Êé•‰∏ã‰æÜ ",-1)),s("strong",null,m(e.duration),1),o[2]||(o[2]=h(" ÁßíÊØèÊ¨°Âä†ÂàÜ = ",-1)),s("strong",null,"+"+m(e.pointsPerClick),1),o[3]||(o[3]=h(" ÂàÜ ",-1))]),s("button",{class:"dismiss-btn",type:"button",onClick:o[0]||(o[0]=i=>e.$emit("close"))}," Êî∂Âà∞ÔºÅ ")]),s("div",uo,[(u(),c(W,null,ue(14,i=>s("span",{key:i,class:_(["particle",`particle-${i}`])},null,2)),64))])])):S("",!0)]),_:1})]))}}),po=Object.assign(Se(co,[["__scopeId","data-v-8ea7d13b"]]),{__name:"GroupingInvincibleCelebration"}),vo=({activeRewardSettings:T,timers:e,uiNotifier:o})=>{const i=C({}),f=C({}),$=C({}),g=C({}),G=C({}),F=C({}),V=new Map,X=new Map,be=a=>{V.has(a)&&(clearTimeout(V.get(a)),V.delete(a)),g.value[a]=null},$e=(a,p)=>{g.value[a]={message:p},V.has(a)&&clearTimeout(V.get(a)),V.set(a,setTimeout(()=>{g.value[a]=null,V.delete(a)},1800))},Ce=a=>{const p="animate-star-pop";i.value[a]=p,setTimeout(()=>{i.value[a]===p&&(i.value[a]=null)},600)},Ge=a=>{const p="animate-invincible-burst";i.value[a.id]=p,setTimeout(()=>{i.value[a.id]===p&&(i.value[a.id]=null)},800),f.value[a.id]=!0,setTimeout(()=>{f.value[a.id]=!1},900),$.value[a.id]=!0,X.has(a.id)&&clearTimeout(X.get(a.id)),X.set(a.id,setTimeout(()=>{$.value[a.id]=!1,X.delete(a.id)},1e3));const A=T.value;if(o.triggerInvincibleCelebration)o.triggerInvincibleCelebration({group:a,settings:A??null});else{const L=A?.enabled?`üéâ ${a.name} ÈÄ≤ÂÖ•ÁÑ°ÊïµÊòüÊòüÊ®°ÂºèÔºÅÊé•‰∏ã‰æÜ ${A.invincibleDurationSeconds} ÁßíÊØèÊ¨° +${A.invinciblePointsPerClick} ÂàÜÔºåÂø´ÊääÊè°Ê©üÊúÉÔºÅ`:`üéâ ${a.name} ÈÄ≤ÂÖ•ÁÑ°ÊïµÊòüÊòüÊ®°ÂºèÔºÅ`;o.showToast(L,"success",6e3)}},le=a=>typeof a.totalCollectedStars=="number"?a.totalCollectedStars:a.stars||0,ge=a=>{const p=T.value;if(!p?.enabled||!p.starsToInvincible)return 0;const A=a.stars||0;return Math.max(0,Math.min(1,A/p.starsToInvincible))},de=a=>Array.isArray(a.milestoneMessages)&&a.milestoneMessages.length>0?[...a.milestoneMessages].sort((p,A)=>p.threshold-A.threshold):Xs(a.starsToInvincible),N=a=>{const p=T.value;if(!p?.enabled||!p.starsToInvincible)return null;const A=a.stars||0;if(A<=0)return null;const L=de(p);let I=null;return L.forEach(P=>{A>=P.threshold&&(I=P)}),I?.message??null},R=a=>{const p=e.value[a];return typeof p=="number"&&p<=10},ce=a=>(a.totalCollectedStars==null&&(a.totalCollectedStars=a.stars||0),a.invincibleStarQueue==null&&(a.invincibleStarQueue=0),a.invincibleUntil==null&&(a.invincibleUntil=null),a.isInvincible==null&&(a.isInvincible=!1),a.isInvincible&&a.invincibleUntil&&a.invincibleUntil<=Date.now()&&(a.isInvincible=!1,a.invincibleUntil=null),a),b=(a,p,A={})=>{const L=a.stars||0,I=G.value[a.id];if(typeof I!="number"&&L>0&&!A.skipMilestoneAnimation){const D=N(a);D&&(F.value[a.id]=D)}if(typeof I=="number"&&L>I){if(Ce(a.id),!a.isInvincible)try{const M=new Audio("/star.mp3");M.volume=.7,M.play()}catch{}const D=N(a);D&&D!==F.value[a.id]&&!A.skipMilestoneAnimation&&($e(a.id,D),F.value[a.id]=D)}!(p?.isInvincible??!1)&&a.isInvincible&&!A.skipMilestoneAnimation&&Ge(a),p&&(p.stars||0)>L&&(F.value[a.id]=null,be(a.id)),G.value[a.id]=L},fe=a=>{Object.keys(i.value).forEach(p=>{a.has(p)||delete i.value[p]}),Object.keys(f.value).forEach(p=>{a.has(p)||delete f.value[p]}),Object.keys($.value).forEach(p=>{a.has(p)||delete $.value[p]}),Object.keys(g.value).forEach(p=>{a.has(p)||(be(p),delete g.value[p])}),Object.keys(G.value).forEach(p=>{a.has(p)||delete G.value[p]}),Object.keys(F.value).forEach(p=>{a.has(p)||delete F.value[p]})},te=()=>{V.forEach(a=>clearTimeout(a)),V.clear(),X.forEach(a=>clearTimeout(a)),X.clear()};return Ze(()=>{te()}),ee(T,()=>{F.value={},Object.keys(g.value).forEach(a=>{g.value[a]=null})},{immediate:!0}),{starGainAnimation:i,invincibleBurstActive:f,invincibleHighlight:$,milestoneBubbles:g,getTotalStarsForDisplay:le,getStarProgress:ge,isCountdownCritical:R,trackGroupUpdate:b,prepareGroupData:ce,cleanupForRemovedGroups:fe,cleanupRewards:te}},mo={class:"space-y-6"},bo={class:"flex gap-6 h-[calc(100vh-220px)]"},go={key:0,class:"flex justify-between items-center gap-3"},fo={class:"flex items-center gap-3 truncate"},ho={class:"flex items-center gap-2 text-base font-semibold truncate"},yo={class:"truncate"},wo={class:"badge badge-ghost badge-sm"},So={class:"dropdown dropdown-end"},$o={tabindex:"0",role:"button",class:"btn btn-ghost btn-xs btn-circle"},Co={tabindex:"0",class:"dropdown-content menu bg-base-100 rounded-box z-[1] w-48 p-2 shadow"},Go=["onClick"],ko=["onClick"],Io={class:"flex justify-between items-start"},xo={class:"flex items-center gap-2 text-base font-semibold"},_o=["onDrop","onDragover","onDragenter"],Mo={key:0,class:"flex justify-end"},Ao=["disabled","onClick"],Do={class:"modal-box max-w-md space-y-4"},To={class:"text-lg font-bold flex items-center gap-2"},Po={key:0,class:"space-y-3 text-sm leading-relaxed"},Eo={class:"font-semibold"},Bo={class:"space-y-2"},jo={class:"flex items-start gap-2"},Uo={class:"flex items-start gap-2"},No={class:"flex items-start gap-2"},Ro={key:1,class:"text-sm text-base-content/70"},Lo={class:"modal-box w-11/12 max-w-4xl py-6 sm:py-8 max-h-[90vh] overflow-y-auto my-4 sm:my-6"},Oo={class:"text-lg font-bold mb-4 flex items-center"},Fo={class:"space-y-4"},Vo={class:"flex items-center gap-4 min-w-0 flex-1"},zo={class:"text-2xl font-bold w-8 shrink-0"},qo={class:"flex-1 min-w-0"},Ho={class:"font-semibold truncate"},Wo={class:"text-sm text-base-content/70"},Qo={key:0,class:"flex items-center gap-2 shrink-0"},Ko={key:0,class:"badge badge-sm gap-1 bg-amber-100 text-amber-600 border border-amber-200"},Yo={class:"text-xs font-semibold"},Zo={class:"text-right"},Xo={class:"modal-action"},Jo={key:0,class:"w-full"},el={class:"flex justify-between items-center flex-wrap gap-y-2 gap-x-4"},sl={class:"flex gap-2 flex-wrap"},tl=["disabled"],nl={key:1,class:"w-full flex justify-end"},ol=Z({__name:"GroupingTab",props:{classInfo:{}},setup(T){const e=T,o=Xe(),i=Js(),f=et(),{exportToExcel:$}=ot(),g=globalThis.Math,{groupingSettings:G,groupingViewCollapsed:F,userPreferences:V}=Ye(i),{groupingBaseScores:X,groupingSessionScores:be,groupingActivityNames:$e,groupingSessionGroupScores:Ce,groupingSessionIndividualScores:Ge}=Ye(o),le=C(),ge=C(),de=t=>{const n=g.floor(Number(t));return!Number.isFinite(n)||n<2?2:g.min(n,10)},N=C(de(e.classInfo.groupCount)),R=C(String(N.value)),ce=C(!1),b=C([]),fe=C(!1),te=C(!1),a=C({}),p=C({}),A=C(null),L=C(""),I=C([]),P=C({groupId:null,index:null}),D=C({studentIds:[],sourceGroupId:null}),M=C(!1),pe=C(!0);let ke=null;const ne=C({}),z=E(()=>e.classInfo.rewardSettingsMode==="disabled"?null:e.classInfo.rewardSettingsMode==="template"&&f.getTemplateById(e.classInfo.appliedRewardTemplateId)?.settings||null),oe=E(()=>{const t=z.value;return t?{enabled:!!t.enabled,pointsPerStar:t.pointsPerStar,starsToInvincible:t.starsToInvincible,invincibleDurationSeconds:t.invincibleDurationSeconds,invinciblePointsPerClick:t.invinciblePointsPerClick}:{enabled:!1}});ee(()=>e.classInfo.id,t=>{t&&i.hydrateGroupingViewCollapsed(t,!!e.classInfo.groupingActive)},{immediate:!0}),ee(()=>!!z.value?.enabled,t=>{G.value.compactMode!==t&&(G.value.compactMode=t,i.persistGroupingSettings())},{immediate:!0});const Je=at(),ae=C({visible:!1,groupName:"",duration:0,pointsPerClick:0});let Q=null,J=null;const Ie=()=>{ae.value.visible=!1,Q&&(clearTimeout(Q),Q=null)},es=()=>{if(!V.value.enableSounds)return;const t=Je.app.baseURL||"/";J||(J=new Audio(`${t}super-star.mp3`),J.volume=.65),J.currentTime=0,J.play().catch(n=>{console.warn("ÁÑ°Ê≥ïÊí≠ÊîæÁÑ°ÊïµÊòüÊòüÈü≥ÊïàÔºö",n)})},ss=(t,n)=>{ae.value={visible:!0,groupName:t.name,duration:g.max(n?.invincibleDurationSeconds??0,0),pointsPerClick:g.max(n?.invinciblePointsPerClick??1,1)},Q&&clearTimeout(Q),es(),Q=setTimeout(()=>{Ie()},2800)},{starGainAnimation:ts,invincibleBurstActive:ns,invincibleHighlight:os,milestoneBubbles:ls,getTotalStarsForDisplay:xe,getStarProgress:as,isCountdownCritical:is,trackGroupUpdate:rs,prepareGroupData:_e,cleanupForRemovedGroups:us,cleanupRewards:ds}=vo({activeRewardSettings:z,timers:ne,uiNotifier:{showToast:i.showToast,triggerInvincibleCelebration:({group:t,settings:n})=>ss(t,n)}}),ve=E({get:()=>$e.value[e.classInfo.id]||"",set:t=>{o.setGroupingActivityName(e.classInfo.id,t)}}),Be=E(()=>X.value[e.classInfo.id]||{}),je=E(()=>be.value[e.classInfo.id]||{}),Ue=E(()=>{const t={};return b.value.forEach(n=>{t[n.id]=xe(n)}),t}),he=E(()=>e.classInfo.students.filter(t=>t.isPresent&&!b.value.some(n=>n.members.some(r=>r.id===t.id)))),cs=E(()=>{const t=L.value.trim().toLowerCase();return t?he.value.filter(n=>n.name.toLowerCase().includes(t)||String(n.id).toLowerCase().includes(t)):he.value}),ps=E(()=>he.value.length),O=E(()=>M.value&&!e.classInfo.groupingActive),Ne=E(()=>[...b.value].sort((t,n)=>n.totalScore-t.totalScore)),Re=E(()=>{const t=Ne.value,n=G.value.leaderboardDisplayCount;return n==="all"?t:t.slice(0,n)}),Le=E(()=>b.value.some(t=>t.members.length>0)),vs=()=>{ge.value?.showModal()},ms=t=>{const n=z.value?.invincibleDurationSeconds;if(!n||n<=0)return 1;const r=ne.value[t];if(typeof r=="number")return g.max(0,g.min(1,r/n));const l=b.value.find(d=>d.id===t);if(l?.invincibleUntil){const d=g.max(0,(l.invincibleUntil-Date.now())/1e3);return g.max(0,g.min(1,d/n))}return 1},bs=(t,n)=>{const r=b.value.find(l=>l.id===t);return r?r.isInvincible&&z.value?.enabled&&z.value.invinciblePointsPerClick||1:n},gs=()=>{i.setGroupingViewCollapsed(!1,e.classInfo.id)},fs=()=>{b.value.length!==0&&i.setGroupingViewCollapsed(!0,e.classInfo.id)},K=t=>t.members.map(n=>e.classInfo.students.find(l=>l.id===n.id)||n),Me=t=>{const n=b.value.find(r=>r.id===t);return n?K(n):[]},hs=t=>K(t).every(n=>!n.isPresent),ys=t=>{const n=z.value;let r=1;return t.isInvincible&&n?.enabled&&(r=n.invinciblePointsPerClick||1),`+${r}`},q=()=>{const t=b.value.map(n=>({...n,members:n.members.map(r=>({...r}))}));ce.value=!0,o.updateGroups(e.classInfo.id,t)},Oe=t=>{const n=Array.isArray(t)?t:[],r=b.value.length===0;n.forEach(d=>{_e(d);const w=b.value.find(j=>j.id===d.id);rs(d,w,{skipMilestoneAnimation:r})}),b.value=n.map(d=>({..._e({...d}),members:d.members?.map(w=>({...w}))||[],createdAt:d.createdAt?new Date(d.createdAt):new Date})),b.value.length===0&&i.setGroupingViewCollapsed(!1,e.classInfo.id);const l=new Set(b.value.map(d=>d.id));Object.keys(a.value).forEach(d=>{l.has(d)||delete a.value[d]}),us(l),M.value||(pe.value=!0)},ws=(t,n=!0,r)=>{const l={id:`group_${Date.now()}_${g.random().toString(36).substr(2,9)}`,name:t.trim(),members:[],totalScore:0,averageScore:0,createdAt:new Date,color:ye(),stars:0,isInvincible:!1,invincibleUntil:null,invincibleStarQueue:0,totalCollectedStars:0};return b.value.push(_e(l)),n&&q(),l},ye=t=>{const n=typeof t=="number"?t%B.defaultColors.length:b.value.length%B.defaultColors.length;return B.defaultColors[n]},Fe=()=>de(N.value),Ss=()=>{const t=Number(R.value);if(!Number.isFinite(t)||t<B.minGroups||t>B.maxGroups){alert(`ÁµÑÊï∏ÂøÖÈ†à‰ªãÊñº ${B.minGroups} Âà∞ ${B.maxGroups} ‰πãÈñì„ÄÇ`);return}if(!e.classInfo?.students?.length||(Ae(),!confirm("ÈÄôÂ∞áÈáçÊñ∞ÂàÜÈÖçÊâÄÊúâÂ≠∏ÁîüÔºå‰∏¶Â∞áÊâÄÊúâÁµÑÂà•ÁöÑÁ∏ΩÂàÜÊ≠∏Èõ∂„ÄÇÁ¢∫ÂÆöË¶ÅÁπºÁ∫åÂóéÔºü")))return;const r=b.value.map((x,U)=>({id:x.id||`group_${Date.now()}_${U}`,name:x.name?.trim()||`Á¨¨ ${U+1} ÁµÑ`,color:x.color||ye(U),totalScore:0,averageScore:0,createdAt:x.createdAt?new Date(x.createdAt):new Date,stars:0,invincibleStarQueue:0,isInvincible:!1,invincibleUntil:null,totalCollectedStars:0})),d=(r.length?r:Array.from({length:Fe()},(x,U)=>({id:`group_${Date.now()}_${g.random().toString(36).substr(2,9)}`,name:`Á¨¨ ${U+1} ÁµÑ`,color:ye(U),totalScore:0,averageScore:0,createdAt:new Date,stars:0,invincibleStarQueue:0,isInvincible:!1,invincibleUntil:null,totalCollectedStars:0}))).map((x,U)=>({...x,members:[],color:x.color||ye(U)}));b.value=d,a.value={};const w=e.classInfo.students.filter(x=>x.isPresent);if(b.value.length===0){alert("Êú™Âª∫Á´ã‰ªª‰ΩïÁµÑÂà•ÔºåË´ãÂÖàË®≠ÂÆöÊúâÊïàÁöÑÁµÑÊï∏");return}if(w.length===0){alert("ÁõÆÂâçÊ≤íÊúâÂá∫Â∏≠Â≠∏ÁîüÂèØ‰æõÂàÜÁµÑ");return}[...w].sort(()=>g.random()-.5).forEach((x,U)=>{const H=U%b.value.length;b.value[H].members.push({...x})}),M.value||q()},Ve=(t,n=!0)=>{const r=b.value.length;let l=!1;if(t>r)for(let d=r;d<t;d++)ws(`Á¨¨ ${d+1} ÁµÑ`,!1),l=!0;else t<r&&(l=b.value.splice(t).length>0);return l&&n&&q(),l},Ae=()=>{if(String(R.value).trim()===""){R.value=String(N.value);return}const t=Number(R.value);if(!Number.isFinite(t)){R.value=String(N.value);return}const n=g.min(g.max(g.floor(t),B.minGroups),B.maxGroups);n!==N.value&&(N.value=n,Ve(n,!1)&&!M.value&&q(),o.updateGroupCount(e.classInfo.id,n)),R.value=String(N.value)},$s=()=>{Ae();const t=Fe();Ve(t,!M.value)},Cs=()=>{confirm("ÈÄôÊúÉÂ∞áÊâÄÊúâÂ≠∏ÁîüÁßªÂõûÊú™ÂàÜÁµÑÁãÄÊÖãÔºå‰ΩÜÊúÉ‰øùÁïôÁèæÊúâÁµÑÂà•„ÄÇÁ¢∫ÂÆöÂóéÔºü")&&(b.value=b.value.map(t=>({...t,members:[]})),M.value||q(),ie())},Gs=t=>{O.value&&(I.value.includes(t)?I.value=I.value.filter(n=>n!==t):I.value=[...I.value,t])},ie=()=>{I.value=[]},De=t=>{const n=A.value;if(!n)return;const r=n.getBoundingClientRect(),l=80,d=20;t.clientY<r.top+l?n.scrollTop-=d:t.clientY>r.bottom-l&&(n.scrollTop+=d)},ze=(t,n,r)=>{if(!O.value){r.preventDefault();return}const l=new Set(I.value),d=n==="unassigned"&&l.size>0&&l.has(t)?Array.from(l):[t];D.value={studentIds:d,sourceGroupId:n},P.value={groupId:null,index:null},r.dataTransfer?.setData("text/plain",d.join(","))},qe=()=>{P.value={groupId:null,index:null}},ks=t=>{O.value&&De(t)},He=(t,n)=>{O.value&&(De(n),P.value={groupId:t,index:Me(t).length})},Is=(t,n,r)=>{O.value&&(De(r),P.value={groupId:t,index:n})},me=(t=!1)=>{(t||D.value.sourceGroupId==="unassigned")&&ie(),D.value={studentIds:[],sourceGroupId:null},P.value={groupId:null,index:null}},xs=t=>{if(!O.value||!D.value.studentIds.length)return;const n=P.value.groupId===t&&P.value.index!==null?P.value.index:Me(t).length;Te(D.value.studentIds,t,n),me()},_s=(t,n)=>{if(!O.value||!D.value.studentIds.length)return;const r=Me(t),l=new Set(D.value.studentIds),d=r.slice(0,n).filter(j=>l.has(j.id)).length,w=g.max(n-d,0);Te(D.value.studentIds,t,w),me()},Ms=()=>{O.value&&D.value.studentIds.length&&(As(D.value.studentIds),me(!0))},Te=(t,n,r)=>{if(!t.length)return;const l=t.map(w=>e.classInfo.students.find(j=>j.id===w)).filter(w=>!!w).map(w=>({...w}));if(!l.length)return;const d=b.value.map(w=>{const j=w.members.filter(H=>!t.includes(H.id));if(w.id!==n)return{...w,members:j};const x=[...j],U=typeof r=="number"?g.min(g.max(r,0),x.length):x.length;return x.splice(U,0,...l),{...w,members:x}});b.value=d,M.value||M.value||q()},As=(t,n=!0)=>{t.length&&(b.value=b.value.map(r=>({...r,members:r.members.filter(l=>!t.includes(l.id))})),n&&!M.value&&q())},Ds=t=>{if(!O.value){alert("Ë´ãÂÖàÈÄ≤ÂÖ•Á∑®ËºØÊ®°ÂºèÂæåÂÜç‰ΩøÁî®Âø´ÈÄüÊåáÊ¥æ");return}if(I.value.length===0){alert("Ë´ãÂÖàÂú®Êú™ÂàÜÁµÑÂ≠∏ÁîüÂàóË°®‰∏≠ÈÅ∏ÂèñÂ≠∏Áîü");return}Te([...I.value],t),ie()},Ts=()=>{if(e.classInfo.groupingActive){alert("ÂàÜÁµÑÊ¥ªÂãïÈÄ≤Ë°å‰∏≠ÔºåË´ãÂÖàÁµêÊùüÂæåÂÜçÁ∑®ËºØÁµÑÂà•„ÄÇ");return}M.value=!0,pe.value=!1,i.setGroupingViewCollapsed(!1),ie()},Ps=()=>{q(),M.value=!1,pe.value=!0,me(!0)},Es=()=>{Oe(e.classInfo.groups),M.value=!1,pe.value=!0,me(!0)},We=(t,n)=>{if(!e.classInfo.groupingActive)return;const r=n>0?"animate-score-bounce-green":"animate-score-bounce-red";a.value[t]=r,setTimeout(()=>{a.value[t]===r&&(a.value[t]=null)},500),o.addScoreToGroup(e.classInfo.id,t,n)},Bs=t=>{const n=b.value.find(l=>l.id===t);if(!n)return;const r=prompt("Ë´ãËº∏ÂÖ•Êñ∞ÁöÑÁµÑÂêçÔºö",n.name);r&&r.trim()&&(n.name=r.trim(),q())},js=t=>{if(confirm("Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§ÁµÑÂà•ÂóéÔºüÁµÑÂÖßÂ≠∏ÁîüÂ∞áÁßªËá≥Êú™ÂàÜÁµÑ„ÄÇ")){const n=b.value.findIndex(r=>r.id===t);n>-1&&(b.value.splice(n,1),q())}},Us=(t,n)=>{if(!e.classInfo.groupingActive)return;const r=n>0?"animate-score-bounce-green":"animate-score-bounce-red";p.value[t]=r,setTimeout(()=>{p.value[t]===r&&(p.value[t]=null)},500),o.addIndividualScoreInGroup(e.classInfo.id,t,n)},Ns=()=>{if(!Le.value){alert("Ë´ãÂÖàÂ∞áÂ≠∏ÁîüÂàÜÁµÑÔºåÊâçËÉΩÈñãÂßãÂàÜÁµÑÊ¥ªÂãïÔºÅ");return}const t=b.value.filter(n=>K(n).length===0);if(t.length>0){const n=t.map(l=>l.name||"Êú™ÂëΩÂêçÁµÑ").join("„ÄÅ ");if(!confirm(`‰ª•‰∏ãÁµÑÂà•ÁõÆÂâçÊ≤íÊúâÊàêÂì°Ôºö${n}„ÄÇ
‰ªçË¶ÅÈñãÂßãÂàÜÁµÑÊ¥ªÂãïÂóéÔºü`))return}o.startClassGrouping(e.classInfo.id),i.setGroupingViewCollapsed(!0,e.classInfo.id)},Rs=()=>{te.value=!0,le.value?.showModal()},Ls=()=>{confirm("Á¢∫Ë™çË¶ÅÈáçË®≠ÂêÑÁµÑÂàÜÊï∏ÂóéÔºüÈÄôÂ∞áÊ∏ÖÈô§ÊâÄÊúâÁµÑÂà•ÁöÑÁ∏ΩÂàÜ„ÄÇ")&&(b.value.forEach(t=>{t.totalScore=0}),q(),o.endClassGrouping(e.classInfo.id),we(),i.setGroupingViewCollapsed(!1,e.classInfo.id))},Os=()=>{te.value=!1,le.value?.showModal()},we=()=>{le.value?.close(),te.value=!1},Qe=()=>{const t=new Date,n=t.toISOString().split("T")[0],r=Ne.value.map((H,Y)=>({ÊéíË°å:Y+1,ÁµÑÂà•:H.name,‰∫∫Êï∏:K(H).length,Á∏ΩÂàÜ:H.totalScore,...z.value?.enabled&&{ÊòüÊòüÊï∏:xe(H)}})),l=[{wch:8},{wch:25},{wch:8},{wch:10}];z.value?.enabled&&l.push({wch:10});const d={sheetName:"ÂàÜÁµÑÊëòË¶Å",header:[["Ê¥ªÂãïÂêçÁ®±:",ve.value||"Êú™ÂëΩÂêç"],["Áè≠Á¥ö:",e.classInfo.name],["ÂåØÂá∫Êó•Êúü:",t.toLocaleString("zh-TW")],[]],data:r,columnWidths:l},x={sheetName:"Â≠∏ÁîüÂæóÂàÜÊòéÁ¥∞",data:b.value.flatMap(H=>K(H).map(Y=>{const Fs=Be.value[Y.id]??0,Ke=je.value[Y.id]??0,Vs=Ce.value[e.classInfo.id]?.[Y.id]??0,zs=Ge.value[e.classInfo.id]?.[Y.id]??0;return{ÁµÑÂà•:H.name,Â∫ßËôü:Y.id,ÂßìÂêç:Y.name,Âá∫Â∏≠ÊÉÖÊ≥Å:Y.isPresent?"Âá∫Â∏≠":"Áº∫Â∏≠",Â∞èÁµÑÂúòÈ´îÂä†ÂàÜ:Vs,Â∞èÁµÑÂÄã‰∫∫Âä†ÂàÜ:zs,Êú¨Ê¨°Ê¥ªÂãïÁ∏ΩÂæóÂàÜ:Ke,Ê¥ªÂãïÂæåÁ∏ΩÂàÜ:Fs+Ke}})),columnWidths:[{wch:25},{wch:10},{wch:15},{wch:12},{wch:15},{wch:15},{wch:15},{wch:15}]},U=`${n}-${ve.value||"ÂàÜÁµÑÊ¥ªÂãïÂ†±Âëä"}-${e.classInfo.name}`;$([d,x],U)};return ee(()=>e.classInfo.groups,t=>{Oe(t),ce.value&&(ce.value=!1)},{deep:!0,immediate:!0}),ee(()=>e.classInfo.groupCount,t=>{const n=de(t);N.value!==n&&(N.value=n),R.value=String(n)},{immediate:!0}),ee(()=>N.value,(t,n)=>{t!==n&&(R.value=String(t))}),ee(()=>he.value.map(t=>t.id),t=>{const n=new Set(t);I.value=I.value.filter(r=>n.has(r))}),ee(()=>e.classInfo.groupingActive,t=>{t&&(M.value=!1,pe.value=!0,ie())},{immediate:!0}),st(()=>{if(e.classInfo.groupingActive){const t=()=>{const n=Date.now();let r=!1;e.classInfo.groups&&e.classInfo.groups.forEach(l=>{l.isInvincible&&l.invincibleUntil&&l.invincibleUntil-n<=500&&(r=!0)}),r&&o.checkInvincibleStatus(),e.classInfo.groups&&e.classInfo.groups.forEach(l=>{if(l.isInvincible&&l.invincibleUntil){const d=l.invincibleUntil-n;d<=0?delete ne.value[l.id]:d<1e3?ne.value[l.id]=1:ne.value[l.id]=g.ceil(d/1e3)}else delete ne.value[l.id]})};t(),ke=tt(t,250)}}),Ze(()=>{ke&&clearInterval(ke),Q&&(clearTimeout(Q),Q=null),J&&(J.pause(),J=null),Ie(),ds()}),(t,n)=>{const r=y;return u(),c("div",mo,[v(po,{visible:ae.value.visible,"group-name":ae.value.groupName,duration:ae.value.duration,"points-per-click":ae.value.pointsPerClick,onClose:Ie},null,8,["visible","group-name","duration","points-per-click"]),v(en,{"grouping-active":t.classInfo.groupingActive,"is-group-edit-mode":M.value,"group-count-input":R.value,"group-count-min":k(B).minGroups,"group-count-max":k(B).maxGroups,"local-groups-length":b.value.length,"activity-name":ve.value,"has-students-in-groups":Le.value,"reward-enabled":oe.value.enabled,"groups-collapsed":k(F),"onUpdate:groupCountInput":n[0]||(n[0]=l=>R.value=l),onCommitGroupCount:Ae,onBuildGroupsForCount:$s,onRandomAssignGroups:Ss,onResetAllGroups:Cs,onOpenRewardInfoModal:vs,onSaveGroupEdits:Ps,onCancelGroupEdits:Es,"onUpdate:activityName":n[1]||(n[1]=l=>ve.value=l),onExpandAllGroups:gs,onCollapseAllGroups:fs,onToggleGroupsCollapsed:n[2]||(n[2]=()=>k(i).setGroupingViewCollapsed(!k(F),e.classInfo.id)),onStartGroupEditing:Ts,onStartGrouping:Ns,onExportActivityReport:Qe,onShowGroupScoreboard:Os,onEndGrouping:Rs},null,8,["grouping-active","is-group-edit-mode","group-count-input","group-count-min","group-count-max","local-groups-length","activity-name","has-students-in-groups","reward-enabled","groups-collapsed"]),s("div",bo,[v(Bn,{collapsed:fe.value,"grouping-active":t.classInfo.groupingActive,"ungrouped-search":L.value,"ungrouped-count":ps.value,"filtered-ungrouped-students":cs.value,"selected-student-ids":I.value,"can-modify-groups":O.value,"leaderboard-groups":Re.value,"group-star-counts":Ue.value,"show-reward-stars":z.value?.enabled??!1,"show-group-total-scores":k(G).showGroupTotalScores,onToggleCollapse:n[3]||(n[3]=l=>fe.value=l),"onUpdate:ungroupedSearch":n[4]||(n[4]=l=>L.value=l),onClearSelection:ie,onToggleStudentSelection:Gs,onDragStart:n[5]||(n[5]=(l,d,w)=>ze(l,d,w)),onDragEnd:qe,onUnassignedDrop:Ms},null,8,["collapsed","grouping-active","ungrouped-search","ungrouped-count","filtered-ungrouped-students","selected-student-ids","can-modify-groups","leaderboard-groups","group-star-counts","show-reward-stars","show-group-total-scores"]),s("main",{ref_key:"groupsContainer",ref:A,class:"flex-1 content-start",onDragover:se(ks,["prevent"])},[s("div",{class:_(["p-1",t.classInfo.groupingActive?k(G).compactMode?"grid grid-cols-4 content-start gap-2":"grid grid-cols-4 content-start gap-3":"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4"])},[(u(!0),c(W,null,ue(b.value,l=>(u(),Pe(On,{key:l.id,compact:t.classInfo.groupingActive&&k(G).compactMode,"is-invincible":l.isInvincible,"invincible-burst":!!k(ns)[l.id],"invincible-highlight":!!k(os)[l.id],"milestone-message":k(ls)[l.id]?.message??null,class:"relative"},{default:Ee(()=>[t.classInfo.groupingActive?(u(),c("div",{key:1,class:_(["flex flex-col",k(G).compactMode?"gap-1":"gap-1.5"])},[s("div",Io,[s("h3",xo,[s("div",{class:"w-3 h-3 rounded-full shrink-0 mt-1",style:re({backgroundColor:l.color})},null,4),s("span",null,m(l.name),1)]),s("div",{class:_(["flex items-center gap-1 text-primary font-semibold text-lg",a.value[l.id]])},[s("span",null,m(l.totalScore),1)],2)]),v(Mt,{"positive-label":ys(l),"negative-label":"-1",disabled:hs(l),onAddPositive:d=>We(l.id,bs(l.id,1)),onAddNegative:d=>We(l.id,-1)},null,8,["positive-label","disabled","onAddPositive","onAddNegative"]),z.value?.enabled?(u(),Pe(Gt,{key:0,group:l,"formatted-timer":k(lt)(ne.value[l.id]||0),"total-stars":k(xe)(l),"star-progress":k(as)(l),"invincible-progress":ms(l.id),"queue-count":l.invincibleStarQueue||0,"star-gain-class":k(ts)[l.id]??null,"countdown-critical":k(is)(l.id)},null,8,["group","formatted-timer","total-stars","star-progress","invincible-progress","queue-count","star-gain-class","countdown-critical"])):S("",!0)],2)):(u(),c("div",go,[s("div",fo,[s("h3",ho,[s("div",{class:"w-4 h-4 rounded-full shrink-0",style:re({backgroundColor:l.color})},null,4),s("span",yo,m(l.name),1),s("span",wo,m(K(l).length),1)]),s("div",{class:_(["flex items-center gap-1 text-primary font-semibold whitespace-nowrap",a.value[l.id]])},[s("span",null,m(l.totalScore),1)],2)]),s("div",So,[s("div",$o,[v(r,{name:"MoreVertical",class:"w-4 h-4"})]),s("ul",Co,[s("li",null,[s("a",{onClick:d=>Bs(l.id)},[v(r,{name:"Edit",class:"w-4 h-4"}),n[9]||(n[9]=h(" Á∑®ËºØÁµÑÂêç ",-1))],8,Go)]),s("li",null,[s("a",{onClick:d=>js(l.id),class:"text-error"},[v(r,{name:"Trash2",class:"w-4 h-4"}),n[10]||(n[10]=h(" Âà™Èô§ÁµÑÂà• ",-1))],8,ko)])])])])),k(F)?S("",!0):(u(),c("div",{key:2,class:_(["flex-1 min-h-32 rounded-xl border border-dashed border-base-300 bg-base-100/60 p-2 flex flex-col gap-2 relative mt-2 overflow-visible",P.value.groupId===l.id&&P.value.index===K(l).length?"ring-2 ring-primary/60 ring-offset-2":""]),onDrop:d=>xs(l.id),onDragover:se(d=>He(l.id,d),["prevent"]),onDragenter:se(d=>He(l.id,d),["prevent"])},[O.value?(u(),c("div",Mo,[s("button",{type:"button",class:"btn btn-ghost btn-xs",disabled:I.value.length===0,onClick:d=>Ds(l.id)}," Âø´ÈÄüÊåáÊ¥æ ",8,Ao)])):S("",!0),v(oo,{"group-id":l.id,members:K(l),"is-edit-mode":M.value,"can-modify":O.value,"grouping-active":t.classInfo.groupingActive,"show-individual-scores":k(G).showStudentIndividualScores,"allow-individual-scoring":k(G).allowIndividualScoring,"base-scores":Be.value,"session-scores":je.value,"student-score-animation":p.value,"drop-indicator":P.value,onDragStart:n[6]||(n[6]=(d,w,j)=>ze(d,w,j)),onDragEnd:qe,onMemberDragOver:n[7]||(n[7]=(d,w,j)=>Is(d,w,j)),onMemberDrop:n[8]||(n[8]=(d,w)=>_s(d,w)),onAddIndividualScore:Us},null,8,["group-id","members","is-edit-mode","can-modify","grouping-active","show-individual-scores","allow-individual-scoring","base-scores","session-scores","student-score-animation","drop-indicator"])],42,_o))]),_:2},1032,["compact","is-invincible","invincible-burst","invincible-highlight","milestone-message"]))),128))],2)],544)]),s("dialog",{ref_key:"rewardInfoModal",ref:ge,class:"modal"},[s("div",Do,[s("h3",To,[v(r,{name:"Sparkles",class:"w-5 h-5 text-warning"}),n[11]||(n[11]=h(" ÁçéÂãµÊ©üÂà∂Ë™™Êòé ",-1))]),oe.value.enabled?(u(),c("div",Po,[s("p",null,[n[12]||(n[12]=h(" ÊØèÁ¥ØÁ©ç ",-1)),s("span",Eo,m(oe.value.pointsPerStar),1),n[13]||(n[13]=h(" ÂàÜÂèØÁç≤Âæó ",-1)),n[14]||(n[14]=s("span",{class:"font-semibold"},"1 È°ÜÊòü",-1)),n[15]||(n[15]=h("„ÄÇ ",-1))]),s("ul",Bo,[s("li",jo,[v(r,{name:"Star",class:"w-4 h-4 mt-0.5 text-yellow-400"}),s("span",null,"ÈõÜÊªø "+m(oe.value.starsToInvincible)+" È°ÜÊòüÂç≥ÂèØÂïüÂãïÁÑ°ÊïµÊòüÊòüÊ®°Âºè„ÄÇ",1)]),s("li",Uo,[v(r,{name:"Timer",class:"w-4 h-4 mt-0.5 text-info"}),s("span",null,"ÁÑ°ÊïµÁãÄÊÖãÂ∞áÊåÅÁ∫å "+m(k(nt)(oe.value.invincibleDurationSeconds))+"„ÄÇ",1)]),s("li",No,[v(r,{name:"Target",class:"w-4 h-4 mt-0.5 text-success"}),s("span",null,"ÁÑ°ÊïµÊúüÈñìÊØèÊ¨°Âä†ÂàÜ = +"+m(oe.value.invinciblePointsPerClick)+" ÂàÜ„ÄÇ",1)])]),n[16]||(n[16]=s("p",{class:"text-xs text-base-content/60"}," Áï∂‰ªª‰ΩïÂ∞èÁµÑÂïüÂãïÁÑ°ÊïµÊòüÊòüÊ®°ÂºèÔºåÁ≥ªÁµ±ÊúÉË∑≥Âá∫ÊèêÈÜíÔºåË´ãÊääÊè°ÈªÉÈáëÊôÇÊÆµÔºÅ ",-1))])):(u(),c("div",Ro," ÁõÆÂâçÊ≠§Áè≠Á¥öÂ∞öÊú™ÂïüÁî®ÁçéÂãµÊ©üÂà∂ÔºåÈªûÊìäÂè≥‰∏äËßí„ÄåÁçéÂãµË®≠ÂÆö„ÄçÂèØÈÄ≤Ë°åË™øÊï¥„ÄÇ ")),n[17]||(n[17]=s("div",{class:"modal-action"},[s("form",{method:"dialog"},[s("button",{type:"submit",class:"btn btn-ghost"},"ÈóúÈñâ")])],-1))])],512),s("dialog",{ref_key:"scoreboardModal",ref:le,class:"modal"},[s("div",Lo,[s("h3",Oo,[v(r,{name:"Trophy",class:"w-5 h-5 mr-2"}),n[18]||(n[18]=h(" Â∞èÁµÑÁ©çÂàÜÂÑÄË°®Êùø ",-1))]),s("div",Fo,[(u(!0),c(W,null,ue(Re.value,(l,d)=>(u(),c("div",{key:l.id,class:_(["flex items-center justify-between gap-4 p-4 rounded-lg",d===0?"bg-warning/20":d===1?"bg-info/20":d===2?"bg-accent/20":"bg-base-200"])},[s("div",Vo,[s("div",zo,m(d+1),1),s("div",{class:"w-6 h-6 rounded-full shrink-0",style:re({backgroundColor:l.color})},null,4),s("div",qo,[s("div",Ho,m(l.name),1),s("div",Wo,m(K(l).length)+" ‰ΩçÂ≠∏Áîü ",1)])]),k(G).showGroupTotalScores?(u(),c("div",Qo,[oe.value.enabled?(u(),c("div",Ko,[v(r,{name:"Star",class:"w-4 h-4"}),s("span",Yo,m(Ue.value[l.id]??0),1)])):S("",!0),s("div",Zo,[s("div",{class:_(["text-2xl font-bold text-primary",a.value[l.id]])},m(l.totalScore),3)])])):S("",!0)],2))),128))]),s("div",Xo,[te.value?(u(),c("div",Jo,[s("div",el,[s("div",sl,[s("button",{onClick:Qe,class:"btn btn-info",disabled:!ve.value.trim()},[v(r,{name:"Download",class:"w-4 h-4 mr-2"}),n[19]||(n[19]=h(" ÂåØÂá∫Ê¥ªÂãïÂ†±Ë°® ",-1))],8,tl),s("button",{onClick:Ls,class:"btn btn-warning"}," ÁµêÊùü‰∏¶ÈáçË®≠ÂàÜÊï∏ ")]),s("button",{onClick:we,class:"btn btn-ghost"}," ÂèñÊ∂à ")]),n[20]||(n[20]=s("p",{class:"text-xs text-base-content/60 mt-3 w-full"}," ÊèêÈÜíÔºöË®≠ÁΩÆÊ¥ªÂãïÂêçÁ®±ÊñπÂèØÂåØÂá∫Ê¥ªÂãïÂ†±ÂëäÔºåÊ¥ªÂãïÁµêÊùüÂæåÂ∞±‰∏çÂèØÂÜçÂåØÂá∫Ê≠§Ê¨°ÂàÜÁµÑÊ¥ªÂãïÁöÑÂ†±Âëä„ÄÇ ",-1))])):(u(),c("div",nl,[s("button",{onClick:we,class:"btn"},"ÈóúÈñâ")]))])]),s("form",{method:"dialog",class:"modal-backdrop"},[s("button",{onClick:we},"close")])],512)])}}}),ll=Object.assign(Se(ol,[["__scopeId","data-v-8fccc69c"]]),{__name:"GroupingTab"}),al={key:0,class:"p-4 sm:p-6"},il={key:1,class:"text-center p-8"},ul=Z({__name:"grouping",setup(T){const e=Xe(),o=it(),i=E(()=>o.params.id),f=E(()=>e.classes.find($=>$.id===i.value));return rt(()=>({title:`${f.value?.name||"Áè≠Á¥öÂàÜÁµÑ"} - ÂàÜÁµÑÊ®°Âºè`})),($,g)=>f.value?(u(),c("div",al,[v(ll,{"class-info":f.value},null,8,["class-info"])])):(u(),c("div",il,[...g[0]||(g[0]=[s("p",null,"Ê≠£Âú®ËºâÂÖ•Áè≠Á¥öË≥áÊñô...",-1),s("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}});export{ul as default};
