import{f as K,g as R,h as X,r as p,i as Y,j as w,u as L,c as u,o as m,a as t,k as N,b as o,d as b,L as Z,t as d,l as y,m as S,v as D,F as tt,n as st,p as j,q as et}from"#entry";import{f as U}from"./s03H60Zk.js";const at={class:"p-6 max-w-7xl mx-auto"},lt={class:"mb-8"},nt={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},ot={class:"flex flex-col items-end gap-1"},it={class:"flex flex-wrap gap-2 justify-end"},rt={class:"dropdown dropdown-end"},dt={tabindex:"0",class:"btn btn-outline gap-2"},ct={tabindex:"0",class:"dropdown-content menu p-2 shadow bg-base-200 rounded-box w-52"},ut={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-6"},mt={class:"stats shadow"},pt={class:"stat"},bt={class:"stat-figure text-primary"},vt={class:"stat-value text-primary"},ft={class:"stats shadow"},gt={class:"stat"},xt={class:"stat-figure text-secondary"},ht={class:"stat-value text-secondary"},_t={class:"stats shadow"},wt={class:"stat"},yt={class:"stat-figure text-accent"},Ct={class:"stat-value text-accent"},kt={class:"stats shadow"},St={class:"stat"},Dt={class:"stat-figure text-success"},jt={class:"stat-value text-success"},Mt={key:0,class:"space-y-6"},At={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3"},$t={class:"relative sm:w-72"},Nt={class:"grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},Ut=["onClick"],Lt={class:"w-16 h-16 bg-gradient-to-br from-primary to-secondary rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},Vt={class:"text-xl font-bold text-base-content mb-2 group-hover:text-primary transition-colors"},Bt={class:"space-y-2 text-sm text-base-content/70"},Ft={class:"flex items-center gap-2"},Ot={class:"flex items-center gap-2"},Pt={class:"flex items-center gap-2"},Tt={class:"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1"},qt=["onClick"],Et=["onClick"],Gt={class:"mt-6 pt-4 border-t border-base-300"},Jt=["onClick"],It={key:1,class:"text-center py-20"},Wt={class:"bg-gradient-to-br from-base-200 to-base-300 rounded-3xl p-12 max-w-md mx-auto"},Ht={class:"w-24 h-24 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-full flex items-center justify-center mx-auto mb-6"},Qt={key:2,class:"fixed bottom-6 right-6"},zt={class:"modal-box w-11/12 max-w-2xl"},Kt={class:"text-lg font-bold mb-6"},Rt={class:"form-control"},Xt={class:"form-control"},Yt={class:"modal-action mt-8 pt-4 border-t border-base-200"},Zt={class:"flex justify-between w-full"},ts={class:"flex gap-3"},ss={type:"submit",class:"btn btn-primary"},es={class:"modal-box"},as={class:"py-4"},ls=K({__name:"ClassesDashboard",setup(V){const n=R();X();const f=p(),v=p(),M=p(),r=p(null),g=p(null),x=p(""),h=p(""),i=Y({name:"",students:""}),C=w(()=>n?.classes?h.value?n.classes.filter(a=>a.name.toLowerCase().includes(h.value.toLowerCase())):n.classes:[]),B=w(()=>n?.classes?n.classes.reduce((a,s)=>a+(s.students?.length||0),0):0),F=w(()=>n?.classes?n.classes.filter(a=>a.students&&a.students.length>0).length:0),O=w(()=>{if(!n?.classes)return 0;const a=new Date;return a.setDate(a.getDate()-7),n.classes.filter(s=>new Date(s.updatedAt)>a).length}),k=()=>{r.value=null,i.name="",i.students="",f.value?.showModal()},P=a=>{const s=n.classes.find(e=>e.id===a);s&&(r.value=a,i.name=s.name,i.students=s.students.map(e=>`${e.id} ${e.name}`).join(`
`),f.value?.showModal())},T=(a,s)=>{g.value=a,x.value=s,v.value?.showModal()},q=()=>{if(!i.name.trim()||!i.students.trim()){alert("班級名稱和學生名單不能為空！");return}if(r.value){const a=n.classes.find(s=>s.id===r.value);if(a){const e=Q(i.students).map(l=>{const c=a.students.find(z=>z.id===l.id);return c?{...c,name:l.name}:l});n.updateClass(r.value,{name:i.name,students:e})}}else n.createClass(i.name,i.students);_()},E=()=>{if(r.value){const a=n.classes.find(s=>s.id===r.value);a&&(g.value=r.value,x.value=a.name,_(),v.value?.showModal())}},G=()=>{g.value&&n.deleteClass(g.value),A()},_=()=>{f.value?.close(),r.value=null},A=()=>{v.value?.close(),g.value=null,x.value=""},$=a=>{n.selectClass(a),et(`/class/${a}`)},J=()=>{confirm("將匯出完整備份 (含全域作業、班級、分組資料)。匯入時會以全域作業為主同步各班作業設定，請妥善保管檔案。")&&n.exportAllClasses()},I=()=>{n.exportDashboardSummary()},W=()=>{M.value?.click()},H=async a=>{const s=a.target,e=s.files?.[0];if(e){if(!e.name.endsWith(".json")){alert("檔案格式錯誤！請選擇 .json 格式的備份檔案。");return}const l=await n.importAllClasses(e);alert(l?"資料匯入成功！":"資料匯入失敗，請檢查檔案格式或內容。"),s.value=""}},Q=a=>{const s=a.trim();if(/^\d+$/.test(s)){const e=parseInt(s);return Array.from({length:e},(l,c)=>({id:String(c+1),name:`${c+1}號`,scores:[],totalScore:0,averageScore:0,group:null,grade:null,createdAt:new Date,isPresent:!0}))}return s.split(`
`).map(e=>{const l=e.trim().split(/\s+/);return l.length>=1&&l[0]?{id:l[0],name:l.slice(1).join(" ")||`${l[0]}號`,scores:[],totalScore:0,averageScore:0,group:null,grade:null,createdAt:new Date,isPresent:!0}:null}).filter(Boolean)};return L({title:"班級總覽 - 班級分組計分工具"}),(a,s)=>{const e=Z;return m(),u("div",at,[t("div",lt,[t("div",nt,[s[9]||(s[9]=t("div",null,[t("h1",{class:"text-4xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent"}," 班級管理 "),t("p",{class:"text-base-content/70 text-lg mt-2"}," 管理您的所有班級，開始精彩的教學旅程 ")],-1)),t("div",ot,[t("div",it,[t("button",{onClick:W,class:"btn btn-outline gap-2"},[o(e,{name:"Upload",class:"w-4 h-4"}),s[3]||(s[3]=b(" 還原備份 (JSON) ",-1))]),t("div",rt,[t("label",dt,[o(e,{name:"Download",class:"w-4 h-4"}),s[4]||(s[4]=b(" 匯出資料 ",-1)),o(e,{name:"ChevronDown",class:"w-4 h-4"})]),t("ul",ct,[t("li",null,[t("a",{onClick:I},[o(e,{name:"FileSpreadsheet",class:"w-4 h-4"}),s[5]||(s[5]=b(" 匯出總覽報告 (Excel) ",-1))])]),t("li",null,[t("a",{onClick:J},[o(e,{name:"Archive",class:"w-4 h-4"}),s[6]||(s[6]=b(" 建立完整備份 (JSON) ",-1))])])])]),t("button",{onClick:k,class:"btn btn-primary gap-2"},[o(e,{name:"Plus",class:"w-4 h-4"}),s[7]||(s[7]=b(" 新增班級 ",-1))])]),s[8]||(s[8]=t("p",{class:"text-xs text-base-content/60 text-right"}," 備份檔會包含全域作業、班級資料與分組設定；匯入時將以全域作業為主，同步移除各班中不存在的作業設定。 ",-1))])]),t("div",ut,[t("div",mt,[t("div",pt,[t("div",bt,[o(e,{name:"GraduationCap",class:"w-8 h-8"})]),s[10]||(s[10]=t("div",{class:"stat-title"},"總班級數",-1)),t("div",vt,d(y(n)?.totalClasses||0),1)])]),t("div",ft,[t("div",gt,[t("div",xt,[o(e,{name:"Users",class:"w-8 h-8"})]),s[11]||(s[11]=t("div",{class:"stat-title"},"總學生數",-1)),t("div",ht,d(B.value),1)])]),t("div",_t,[t("div",wt,[t("div",yt,[o(e,{name:"BookOpen",class:"w-8 h-8"})]),s[12]||(s[12]=t("div",{class:"stat-title"},"活躍班級",-1)),t("div",Ct,d(F.value),1)])]),t("div",kt,[t("div",St,[t("div",Dt,[o(e,{name:"TrendingUp",class:"w-8 h-8"})]),s[13]||(s[13]=t("div",{class:"stat-title"},"本週活動",-1)),t("div",jt,d(O.value),1)])])])]),C.value&&C.value.length>0?(m(),u("div",Mt,[t("div",At,[s[14]||(s[14]=t("h2",{class:"text-2xl font-semibold text-base-content"},"您的班級",-1)),t("div",$t,[S(t("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>h.value=l),type:"text",placeholder:"搜尋班級...",class:"input input-bordered pl-10 w-full"},null,512),[[D,h.value]]),o(e,{name:"Search",class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-base-content/50"})])]),t("div",Nt,[(m(!0),u(tt,null,st(C.value,l=>(m(),u("div",{key:l.id,class:"group relative bg-gradient-to-br from-base-100 to-base-200 rounded-2xl p-6 shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2 border border-base-300"},[t("div",{onClick:c=>$(l.id),class:"cursor-pointer"},[t("div",Lt,[o(e,{name:"GraduationCap",class:"w-8 h-8 text-white"})]),t("h3",Vt,d(l.name),1),t("div",Bt,[t("div",Ft,[o(e,{name:"Users",class:"w-4 h-4"}),t("span",null,d((l.students||[]).length)+" 位學生",1)]),t("div",Ot,[o(e,{name:"Calendar",class:"w-4 h-4"}),t("span",null,d(y(U)(l.createdAt)),1)]),t("div",Pt,[o(e,{name:"Clock",class:"w-4 h-4"}),t("span",null,d(y(U)(l.updatedAt)),1)])])],8,Ut),t("div",Tt,[t("button",{onClick:j(c=>P(l.id),["stop"]),class:"btn btn-sm btn-ghost btn-circle bg-base-100/80 hover:bg-info hover:text-info-content",title:"編輯班級"},[o(e,{name:"Edit",class:"w-4 h-4"})],8,qt),t("button",{onClick:j(c=>T(l.id,l.name),["stop"]),class:"btn btn-sm btn-ghost btn-circle bg-base-100/80 hover:bg-error hover:text-error-content",title:"刪除班級"},[o(e,{name:"Trash2",class:"w-4 h-4"})],8,Et)]),t("div",Gt,[t("button",{onClick:c=>$(l.id),class:"w-full btn btn-primary btn-sm group-hover:btn-accent transition-all"},[o(e,{name:"LogIn",class:"w-4 h-4 mr-2"}),s[15]||(s[15]=b(" 進入班級 ",-1))],8,Jt)])]))),128))])])):(m(),u("div",It,[t("div",Wt,[t("div",Ht,[o(e,{name:"GraduationCap",class:"w-12 h-12 text-primary"})]),s[17]||(s[17]=t("h3",{class:"text-2xl font-bold text-base-content mb-3"},"開始您的教學旅程",-1)),s[18]||(s[18]=t("p",{class:"text-base-content/70 mb-8 text-lg"}," 創建您的第一個班級，開啟現代化的班級管理體驗 ",-1)),t("button",{onClick:k,class:"btn btn-primary btn-lg gap-3 hover:scale-105 transition-transform"},[o(e,{name:"Plus",class:"w-5 h-5"}),s[16]||(s[16]=b(" 建立第一個班級 ",-1))])])])),(y(n)?.totalClasses||0)>0?(m(),u("div",Qt,[t("button",{onClick:k,class:"btn btn-primary btn-lg btn-circle shadow-lg",title:"新增班級"},[o(e,{name:"Plus",class:"w-6 h-6"})])])):N("",!0),t("dialog",{ref_key:"classModal",ref:f,class:"modal"},[t("div",zt,[t("h3",Kt,d(r.value?"編輯班級":"新增班級"),1),t("form",{onSubmit:j(q,["prevent"]),class:"space-y-6"},[t("div",Rt,[s[19]||(s[19]=t("label",{class:"label mb-2"},[t("span",{class:"label-text font-medium"},"班級名稱")],-1)),S(t("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>i.name=l),type:"text",placeholder:"例如：一年一班",class:"input input-bordered w-full",required:""},null,512),[[D,i.name]])]),t("div",Xt,[s[20]||(s[20]=t("label",{class:"label"},[t("span",{class:"label-text font-medium"},"學生名單"),t("span",{class:"label-text-alt"},"可輸入人數或名單")],-1)),S(t("textarea",{"onUpdate:modelValue":s[2]||(s[2]=l=>i.students=l),class:"textarea textarea-bordered h-32 w-full mt-2",placeholder:"輸入班級總人數 (例如 28)或  1 王小明  2 陳大華...",required:""},null,512),[[D,i.students]]),s[21]||(s[21]=t("div",{class:"label mt-2"},[t("span",{class:"label-text-alt text-gray-500"}," 可以輸入純數字表示學生人數，或每行一個學生（格式：座號 姓名） ")],-1))]),t("div",Yt,[t("div",Zt,[t("div",null,[r.value?(m(),u("button",{key:0,type:"button",onClick:E,class:"btn btn-error"}," 刪除班級 ")):N("",!0)]),t("div",ts,[t("button",{type:"button",onClick:_,class:"btn btn-ghost"}," 取消 "),t("button",ss,d(r.value?"更新":"建立"),1)])])])],32)]),t("form",{method:"dialog",class:"modal-backdrop"},[t("button",{onClick:_},"close")])],512),t("dialog",{ref_key:"deleteModal",ref:v,class:"modal"},[t("div",es,[s[22]||(s[22]=t("h3",{class:"text-lg font-bold"},"確認刪除",-1)),t("p",as,"您確定要刪除班級「"+d(x.value)+"」嗎？此操作無法復原。",1),t("div",{class:"modal-action"},[t("button",{onClick:A,class:"btn btn-ghost"},"取消"),t("button",{onClick:G,class:"btn btn-error"},"刪除")])])],512),t("input",{ref_key:"fileInput",ref:M,type:"file",accept:".json",style:{display:"none"},onChange:H},null,544)])}}}),ns=Object.assign(ls,{__name:"ClassesDashboard"}),rs={__name:"index",setup(V){return L({title:"班級分組計分工具 - 現代化班級管理系統"}),(n,f)=>{const v=ns;return m(),u("div",null,[o(v)])}}};export{rs as default};
