import{f as V,g as A,h as G,r as f,j as B,c as i,o as r,a as e,F as S,n as C,A as b,t as a,k as L,b as m,d as $,L as J,l as h,S as U,p as u,U as X,_ as Y,K as Z}from"#entry";import{a as ee}from"./s03H60Zk.js";const se={key:0,class:"space-y-6"},te={class:"card bg-base-100 shadow-sm"},oe={class:"card-body"},ne={class:"flex flex-wrap gap-4 items-center"},le={class:"form-control flex-1"},ae={class:"flex flex-wrap items-center gap-4 justify-between w-full"},ie={class:"flex items-center gap-2"},re={class:"flex flex-wrap gap-2"},ce=["onClick","title"],de={class:"flex items-center gap-2 ml-auto"},ue=["onClick"],me={class:"card-body p-0"},be={class:"flex flex-row items-stretch divide-x divide-base-100"},pe={class:"flex flex-col justify-between gap-4 p-4 flex-1"},ve={class:"flex items-center justify-between"},ge={class:"font-semibold text-lg"},xe={class:"text-sm text-base-content/70"},fe={class:"flex justify-between items-center"},he={class:"flex items-center gap-2"},_e={class:"flex items-center gap-2 select-none"},ke=["checked","onChange"],we={class:"flex flex-col justify-center items-center bg-gradient-to-br from-base-200 via-base-100 to-base-300 rounded-r-2xl p-4 min-w-[80px] gap-2"},ye={class:"flex flex-col items-center"},Se={class:"flex gap-2 mt-2"},Ce=["onClick"],$e=["onClick"],Te={class:"absolute top-3 right-3 z-10"},Pe={class:"dropdown dropdown-end"},je={tabindex:"0",class:"dropdown-content menu bg-base-100 rounded-box z-[1] w-48 p-2 shadow"},Me=["onClick"],Ee=["onClick"],Ne=["onClick"],ze=["onClick"],De={class:"modal-box w-11/12 max-w-2xl"},Ie={class:"text-lg font-bold mb-4"},Le={key:0,class:"space-y-3 max-h-96 overflow-y-auto"},Ue={class:"flex items-center gap-2"},Ve={class:"text-sm"},Ae={class:"text-right"},Be={class:"text-sm text-base-content/70"},Fe={key:1,class:"text-center py-8 text-base-content/70"},Oe={key:1,class:"text-center p-8"},qe=V({__name:"ScoringTab",props:{classInfo:{}},setup(T){const w=T,p=A(),g=G(),{exportToExcel:P}=X(),x=U("addStudent"),j=U("editStudent"),y=f(),M=f(1),c=f([]),v=f(null),_=f({}),F=[3,2,1,-1,-2,-3],n=B(()=>w.classInfo),O=o=>{const s=c.value.indexOf(o);s>-1?c.value.splice(s,1):c.value.push(o)},q=()=>{n.value&&(c.value=n.value.students.map(o=>o.id))},E=()=>{c.value=[]},N=(o,s)=>{z(o,s,"快速評分"),_.value[o]=s>0?"animate-score-bounce-green":"animate-score-bounce-red",setTimeout(()=>{_.value[o]=null},500)},H=o=>{c.value.length>0?(c.value.forEach(s=>z(s,o,"批量快速評分")),E()):M.value=o},z=(o,s,l)=>{n.value&&p.addScoreToStudent(n.value.id,o,s,l)},R=o=>{n.value&&confirm(`確定要刪除學生「${o.name}」嗎？此操作無法復原。`)&&(p.removeStudentFromClass(n.value.id,o.id),g.showSuccess("學生已刪除"))},W=o=>{v.value=o,y.value?.showModal()},D=()=>{y.value?.close(),v.value=null},I=o=>{if(!n.value)return;const s=n.value.students.find(l=>l.id===o);s&&p.updateStudent(n.value.id,o,{isPresent:!s.isPresent})},K=()=>{if(!n.value)return;const o=new Date,s=o.toISOString().split("T")[0],l=n.value.students.map(k=>({座號:k.id,姓名:k.name,總分:k.totalScore,出席:k.isPresent?"是":"否"})),t={sheetName:`${n.value.name} - 成績單`,header:[["班級:",n.value.name],["匯出日期:",o.toLocaleString("zh-TW")],[]],data:l,columnWidths:[{wch:10},{wch:20},{wch:10},{wch:10}]},d=`${s}-${n.value.name}-成績單`;P([t],d)},Q=()=>{if(!n.value||!confirm(`將會把「${n.value.name}」全體學生的總分歸零並清除評分紀錄，確定要執行嗎？`))return;p.resetClassTotals(n.value.id)&&(g.showSuccess("已重置全班總分"),_.value={})};return(o,s)=>{const l=J;return n.value?(r(),i("div",se,[e("div",te,[e("div",oe,[e("div",ne,[e("div",le,[e("div",ae,[e("div",ie,[s[3]||(s[3]=e("span",{class:"label-text whitespace-nowrap"},"快速加分",-1)),e("div",re,[(r(),i(S,null,C(F,t=>e("button",{key:t,onClick:d=>H(t),class:b(["px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 border focus:outline-none focus:ring-2 focus:ring-primary/40",t===M.value?t>0?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow":"bg-gradient-to-r from-rose-500 to-red-500 text-white shadow":t>0?"bg-green-50 dark:bg-green-900/20 text-green-600 border-green-200 dark:border-green-700 hover:bg-green-100 dark:hover:bg-green-900/40":"bg-rose-50 dark:bg-rose-900/20 text-rose-600 border-rose-200 dark:border-rose-700 hover:bg-rose-100 dark:hover:bg-rose-900/40"]),title:c.value.length?"立即對選取學生套用":"設定批量評分預設分數"},a(t>0?"+":"")+a(t),11,ce)),64))])]),e("div",de,[e("button",{class:"btn btn-sm btn-outline",onClick:q,type:"button"}," 全選 "),e("button",{class:"btn btn-sm btn-outline",onClick:E,type:"button"}," 取消全選 "),s[7]||(s[7]=e("div",{class:"divider divider-horizontal mx-1"},null,-1)),e("button",{class:"btn btn-sm btn-outline",onClick:K,type:"button"},[m(l,{name:"Download",class:"w-4 h-4 mr-1"}),s[4]||(s[4]=$(" 匯出成績 ",-1))]),e("button",{class:"btn btn-sm btn-outline btn-warning",onClick:Q,type:"button"},[m(l,{name:"RotateCcw",class:"w-4 h-4 mr-1"}),s[5]||(s[5]=$(" 全班總分歸零 ",-1))]),h(x)?(r(),i("button",{key:0,class:"btn btn-sm btn-primary",onClick:s[0]||(s[0]=t=>h(x)?.()),type:"button"},[m(l,{name:"UserPlus",class:"w-4 h-4 mr-1"}),s[6]||(s[6]=$(" 新增學生 ",-1))])):L("",!0)])])])])])]),e("div",{class:b(["grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 transition-all",c.value.length?"pb-32":""])},[(r(!0),i(S,null,C(n.value.students,t=>(r(),i("div",{key:t.id,class:b(["card bg-base-100 border-2 border-base-300 shadow-md rounded-xl hover:shadow-xl transition-all duration-200 cursor-pointer",{"ring-2 ring-primary":c.value.includes(t.id)}]),onClick:d=>O(t.id)},[e("div",me,[e("div",be,[e("div",pe,[e("div",ve,[e("div",null,[e("h3",ge,a(t.name),1),e("p",xe," 座號 "+a(t.id),1)]),e("span",{class:b(["badge badge-soft",t.isPresent?"badge-success":"badge-ghost text-base-content/60"])},a(t.isPresent?"出席":"缺席"),3)]),e("div",fe,[e("div",he,[e("label",_e,[e("input",{type:"checkbox",checked:t.isPresent,onClick:s[1]||(s[1]=u(()=>{},["stop"])),onChange:u(d=>I(t.id),["stop"]),class:"toggle toggle-success toggle-sm"},null,40,ke),e("span",{class:b(["text-sm font-medium",t.isPresent?"text-green-600":"text-gray-400"])},a(t.isPresent?"出席":"缺席"),3)])])])]),e("div",we,[e("div",ye,[s[8]||(s[8]=e("span",{class:"text-xs text-base-content/60 mb-1"},"總分",-1)),e("span",{class:b(["font-extrabold text-xl md:text-2xl lg:text-3xl text-primary px-2 py-2",_.value[t.id]])},a(t.totalScore),3)]),e("div",Se,[e("button",{onClick:u(d=>N(t.id,1),["stop"]),class:"btn btn-md font-bold text-base px-4 py-1 rounded-full bg-gradient-to-r from-green-400 to-emerald-500 text-white border-none shadow hover:scale-105 hover:from-green-500 hover:to-emerald-600",title:"+1分"}," +1 ",8,Ce),e("button",{onClick:u(d=>N(t.id,-1),["stop"]),class:"btn btn-md font-bold text-base px-4 py-1 rounded-full bg-gradient-to-r from-rose-400 to-red-500 text-white border-none shadow hover:scale-105 hover:from-rose-500 hover:to-red-600",title:"-1分"}," -1 ",8,$e)])])])]),e("div",Te,[e("div",Pe,[e("div",{tabindex:"0",role:"button",class:"btn btn-ghost btn-xs btn-circle",onClick:s[2]||(s[2]=u(()=>{},["stop"]))},[m(l,{name:"MoreVertical",class:"w-4 h-4"})]),e("ul",je,[e("li",null,[h(j)?(r(),i("a",{key:0,onClick:u(d=>h(j)?.(t.id),["stop"]),class:"flex items-center gap-2"},[m(l,{name:"Edit",class:"w-3 h-3"}),s[9]||(s[9]=e("span",null,"編輯學生",-1))],8,Me)):L("",!0)]),e("li",null,[e("a",{onClick:u(d=>W(t),["stop"]),class:"flex items-center gap-2"},[m(l,{name:"ScrollText",class:"w-3 h-3"}),s[10]||(s[10]=e("span",null,"評分記錄",-1))],8,Ee)]),e("li",null,[e("a",{onClick:u(d=>I(t.id),["stop"]),class:"flex items-center gap-2"},[m(l,{name:t.isPresent?"UserMinus":"UserCheck",class:"w-3 h-3"},null,8,["name"]),e("span",null,a(t.isPresent?"標記缺席":"標記出席"),1)],8,Ne)]),s[12]||(s[12]=e("div",{class:"divider my-1"},null,-1)),e("li",null,[e("a",{onClick:u(d=>R(t),["stop"]),class:"text-error flex items-center gap-2"},[m(l,{name:"Trash2",class:"w-3 h-3"}),s[11]||(s[11]=e("span",null,"刪除學生",-1))],8,ze)])])])])],10,ue))),128))],2),e("dialog",{ref_key:"historyModal",ref:y,class:"modal"},[e("div",De,[e("h3",Ie,a(v.value?.name)+" 的評分記錄",1),v.value&&v.value.scores.length>0?(r(),i("div",Le,[(r(!0),i(S,null,C(v.value.scores.slice().reverse(),t=>(r(),i("div",{key:t.id,class:"flex justify-between items-center p-3 bg-base-200 rounded-lg"},[e("div",null,[e("div",Ue,[e("span",{class:b(["badge",t.value>0?"badge-success":"badge-error"])},a(t.value>0?"+":"")+a(t.value),3),e("span",Ve,a(t.reason||"快速評分"),1)])]),e("div",Ae,[e("div",Be,a(h(ee)(t.timestamp)),1)])]))),128))])):(r(),i("div",Fe,"尚無評分記錄")),e("div",{class:"modal-action"},[e("button",{onClick:D,class:"btn btn-ghost"},"關閉")])]),e("form",{method:"dialog",class:"modal-backdrop"},[e("button",{onClick:D},"close")])],512)])):(r(),i("div",Oe,[...s[13]||(s[13]=[e("p",null,"正在載入班級資料...",-1),e("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}}}),He=Object.assign(Y(qe,[["__scopeId","data-v-9937835c"]]),{__name:"ScoringTab"}),Re={key:0,class:"p-4 sm:p-6"},We={key:1,class:"text-center p-8"},Ge=V({__name:"index",setup(T){const w=A(),{currentClass:p}=Z(w),g=B(()=>p.value??null);return(P,x)=>g.value?(r(),i("div",Re,[m(He,{"class-info":g.value},null,8,["class-info"])])):(r(),i("div",We,[...x[0]||(x[0]=[e("p",null,"正在載入班級資料...",-1),e("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}});export{Ge as default};
