import{f as T,g as z,K as A,r as g,i as D,j as d,M as U,z as q,u as E,c as u,l as h,o as i,a as e,b as f,L as O,t as p,F as H,n as K,D as Q,w as G,A as J,P as W,e as X,N as Y,p as Z,m as y,v as k,k as ee,O as te,Q as w}from"#entry";const se={key:0,class:"min-h-screen bg-base-200"},ne={class:"bg-base-100 shadow-sm sticky top-0 z-10"},ae={class:"container mx-auto px-4 py-2"},oe={class:"flex justify-between items-center"},le={class:"flex items-center gap-4"},ie={class:"text-xl font-bold text-base-content"},re={class:"text-xs text-base-content/70"},de={class:"tabs tabs-bordered"},ue={class:"hidden sm:inline"},ce={class:"container mx-auto px-4 py-6"},me={class:"modal-box"},pe={class:"text-lg font-bold mb-4"},ve={class:"form-control"},be=["disabled"],fe={class:"form-control"},_e={class:"modal-action"},he={type:"submit",class:"btn btn-primary"},xe={key:1,class:"min-h-screen flex items-center justify-center"},ge={key:2,class:"min-h-screen flex items-center justify-center"},ye={class:"text-center"},ke={key:3,class:"min-h-screen"},Se=T({__name:"[id]",setup(we){const r=z(),C=U(),{currentClass:a,isLoaded:_,currentClassId:S}=A(r),v=g(),o=g(null),n=D({id:"",name:""}),c=d(()=>{const s=C.params.id;return typeof s=="string"&&s.trim()?s:null}),M=d(()=>{const s=c.value||"overview";return[{id:"scoring",label:"個人計分",icon:"Star",path:`/class/${s}`},{id:"homework",label:"作業管理",icon:"BookOpen",path:`/class/${s}/homework`},{id:"grouping",label:"分組模式",icon:"Users",path:`/class/${s}/grouping`},{id:"grades",label:"成績結算",icon:"BarChart3",path:`/class/${s}/grades`}]});q(()=>[c.value,_.value],([s,t])=>{t&&r.selectClass(s??null)},{immediate:!0});const L=d(()=>{const s=c.value;return s?r.classes.some(t=>t.id===s):!1}),$=d(()=>{const s=c.value;return s?!_.value||S.value!==s||!a.value:!1}),B=d(()=>c.value?_.value?!L.value:!1:!0),I=te(),x=()=>{I.back()},N=()=>{o.value=null,n.id="",n.name="",v.value?.showModal()},V=s=>{const t=a.value?.students.find(m=>m.id===s);t&&(o.value=s,n.id=t.id,n.name=t.name,v.value?.showModal())},j=()=>{if(!n.id.trim()||!n.name.trim()){alert("座號和姓名不能為空！");return}if(a.value){if(o.value)r.updateStudent(a.value.id,o.value,{name:n.name});else{if(a.value.students.some(t=>t.id===n.id)){alert("座號已存在！");return}r.addStudentToClass(a.value.id,n.name,n.id)}b()}},F=()=>{!o.value||!a.value||confirm("確定要刪除此學生嗎？")&&(r.removeStudentFromClass(a.value.id,o.value),b())},b=()=>{v.value?.close(),o.value=null};return E({title:d(()=>a.value?`${a.value.name} - 班級分組計分工具`:"班級管理 - 班級分組計分工具")}),w("addStudent",N),w("editStudent",V),(s,t)=>{const m=O,P=X,R=Y;return h(a)?(i(),u("div",se,[e("div",ne,[e("div",ae,[e("div",oe,[e("div",le,[e("button",{onClick:x,class:"btn btn-ghost btn-sm gap-2"},[f(m,{name:"ArrowLeft",class:"w-4 h-4"}),t[2]||(t[2]=e("span",{class:"hidden sm:inline"},"返回",-1))]),e("div",null,[e("h1",ie,p(h(a).name),1),e("p",re,p(h(a).students.length)+" 位學生 ",1)])]),e("div",de,[(i(!0),u(H,null,K(M.value,l=>(i(),Q(P,{key:l.id,to:l.path,class:J(["tab",{"tab-active":(s._.provides[W]||s.$route).path===l.path}])},{default:G(()=>[f(m,{name:l.icon,class:"w-4 h-4 sm:mr-2"},null,8,["name"]),e("span",ue,p(l.label),1)]),_:2},1032,["to","class"]))),128))])])])]),e("div",ce,[f(R)]),e("dialog",{ref_key:"studentModal",ref:v,class:"modal"},[e("div",me,[e("h3",pe,p(o.value?"編輯學生":"新增學生"),1),e("form",{onSubmit:Z(j,["prevent"]),class:"space-y-4"},[e("div",ve,[t[3]||(t[3]=e("label",{class:"label mr-2"},[e("span",{class:"label-text"},"座號")],-1)),y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>n.id=l),type:"text",placeholder:"例如：01",class:"input input-bordered",disabled:!!o.value,required:""},null,8,be),[[k,n.id]])]),e("div",fe,[t[4]||(t[4]=e("label",{class:"label mr-2"},[e("span",{class:"label-text"},"姓名")],-1)),y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>n.name=l),type:"text",placeholder:"例如：王小明",class:"input input-bordered",required:""},null,512),[[k,n.name]])]),e("div",_e,[o.value?(i(),u("button",{key:0,type:"button",onClick:F,class:"btn btn-error"}," 刪除學生 ")):ee("",!0),e("button",{type:"button",onClick:b,class:"btn btn-ghost"}," 取消 "),e("button",he,p(o.value?"更新":"新增"),1)])],32)]),e("form",{method:"dialog",class:"modal-backdrop"},[e("button",{onClick:b},"close")])],512)])):$.value?(i(),u("div",xe,[...t[5]||(t[5]=[e("div",{class:"text-center flex flex-col items-center gap-3"},[e("span",{class:"loading loading-spinner loading-lg text-primary"}),e("p",{class:"text-base-content/70"},"正在載入班級資料...")],-1)])])):B.value?(i(),u("div",ge,[e("div",ye,[f(m,{name:"AlertCircle",class:"w-16 h-16 mx-auto text-warning mb-4"}),t[6]||(t[6]=e("h2",{class:"text-xl font-semibold mb-2"},"找不到班級",-1)),t[7]||(t[7]=e("p",{class:"text-base-content/70 mb-4"},"請確認網址是否正確，或返回上一頁",-1)),e("button",{onClick:x,class:"btn btn-primary"},"返回上一頁")])])):(i(),u("div",ke))}}});export{Se as default};
