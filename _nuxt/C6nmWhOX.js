import{f as O,g as R,D as G,G as Q,r as v,c as r,k as l,o as c,a as e,F as k,n as y,x as g,t as i,j as z,b,d as C,L as J,M as E,p as m,N as K,_ as X}from"#entry";const Y={key:0,class:"space-y-6"},Z={class:"card bg-base-100 shadow-sm"},ee={class:"card-body"},te={class:"flex flex-wrap gap-4 items-center"},se={class:"form-control flex-1"},oe={class:"flex items-center gap-4 justify-between w-full"},ne={class:"flex items-center gap-2"},le={class:"flex flex-wrap gap-2"},ae=["onClick","title"],ie={class:"flex flex-wrap items-center gap-2 ml-auto"},re=["onClick"],ce={class:"card-body p-0"},de={class:"flex flex-row items-stretch divide-x divide-base-100"},ue={class:"flex flex-col justify-between p-4 flex-1 min-w-0"},me={class:"flex items-center gap-2 mb-2"},be=["title"],ge={class:"font-bold text-base md:text-lg lg:text-xl xl:text-2xl leading-tight truncate"},pe={class:"text-sm text-base-content/70 mb-2"},xe={class:"flex items-center gap-2 select-none mt-2"},ve=["checked","onChange"],he={class:"flex flex-col justify-center items-center bg-gradient-to-br from-base-200 via-base-100 to-base-300 rounded-r-2xl p-4 min-w-[80px] gap-2"},fe={class:"flex flex-col items-center"},_e={class:"flex gap-2 mt-2"},we=["onClick"],ke=["onClick"],ye={class:"absolute top-3 right-3 z-10"},Ce={class:"dropdown dropdown-end"},Se={tabindex:"0",class:"dropdown-content menu bg-base-100 rounded-box z-[1] w-48 p-2 shadow"},$e=["onClick"],Te=["onClick"],Pe=["onClick"],Me=["onClick"],De={class:"modal-box w-11/12 max-w-2xl"},Ne={class:"text-lg font-bold mb-4"},je={key:0,class:"space-y-3 max-h-96 overflow-y-auto"},ze={class:"flex items-center gap-2"},Ee={class:"text-sm"},Le={class:"text-right"},Ve={class:"text-sm text-base-content/70"},Ue={key:1,class:"text-center py-8 text-base-content/70"},Be={key:1,class:"text-center p-8"},Fe=O({__name:"index",setup(We){const x=R(),S=G(),{exportToExcel:L}=K(),{currentClass:n}=Q(x),_=E("addStudent"),$=E("editStudent"),w=v(),T=v(1),d=v([]),p=v(null),h=v({}),V=[3,2,1,-1,-2,-3],U=o=>{const t=d.value.indexOf(o);t>-1?d.value.splice(t,1):d.value.push(o)},B=()=>{n.value&&(d.value=n.value.students.map(o=>o.id))},P=()=>{d.value=[]},M=(o,t)=>{D(o,t,"快速評分"),h.value[o]=t>0?"animate-score-bounce-green":"animate-score-bounce-red",setTimeout(()=>{h.value[o]=null},500)},F=o=>{d.value.length>0?(d.value.forEach(t=>D(t,o,"批量快速評分")),P()):T.value=o},D=(o,t,a)=>{n.value&&x.addScoreToStudent(n.value.id,o,t,a)},W=o=>{n.value&&confirm(`確定要刪除學生「${o.name}」嗎？此操作無法復原。`)&&(x.removeStudentFromClass(n.value.id,o.id),S.showSuccess("學生已刪除"))},q=o=>{p.value=o,w.value?.showModal()},N=()=>{w.value?.close(),p.value=null},j=o=>{if(!n.value)return;const t=n.value.students.find(a=>a.id===o);t&&x.updateStudent(n.value.id,o,{isPresent:!t.isPresent})},A=o=>new Date(o).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),H=()=>{if(!n.value)return;const o=new Date,t=o.toISOString().split("T")[0],a=n.value.students.map(f=>({座號:f.id,姓名:f.name,總分:f.totalScore,出席:f.isPresent?"是":"否"})),s={sheetName:`${n.value.name} - 成績單`,header:[["班級:",n.value.name],["匯出日期:",o.toLocaleString("zh-TW")],[]],data:a,columnWidths:[{wch:10},{wch:20},{wch:10},{wch:10}]},u=`${t}-${n.value.name}-成績單`;L([s],u)},I=()=>{if(!n.value||!confirm(`將會把「${n.value.name}」全體學生的總分歸零並清除評分紀錄，確定要執行嗎？`))return;x.resetClassTotals(n.value.id)&&(S.showSuccess("已重置全班總分"),h.value={})};return(o,t)=>{const a=J;return l(n)?(c(),r("div",Y,[e("div",Z,[e("div",ee,[e("div",te,[e("div",se,[e("div",oe,[e("div",ne,[t[3]||(t[3]=e("span",{class:"label-text whitespace-nowrap"},"快速加分",-1)),e("div",le,[(c(),r(k,null,y(V,s=>e("button",{key:s,onClick:u=>F(s),class:g(["px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 border focus:outline-none focus:ring-2 focus:ring-primary/40",s===l(T)?s>0?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow":"bg-gradient-to-r from-rose-500 to-red-500 text-white shadow":s>0?"bg-green-50 dark:bg-green-900/20 text-green-600 border-green-200 dark:border-green-700 hover:bg-green-100 dark:hover:bg-green-900/40":"bg-rose-50 dark:bg-rose-900/20 text-rose-600 border-rose-200 dark:border-rose-700 hover:bg-rose-100 dark:hover:bg-rose-900/40"]),title:l(d).length?"立即對選取學生套用":"設定批量評分預設分數"},i(s>0?"+":"")+i(s),11,ae)),64))])]),e("div",ie,[e("button",{class:"btn btn-sm btn-outline",onClick:B,type:"button"}," 全選 "),e("button",{class:"btn btn-sm btn-outline",onClick:P,type:"button"}," 取消全選 "),t[7]||(t[7]=e("div",{class:"divider divider-horizontal mx-1"},null,-1)),e("button",{class:"btn btn-sm btn-outline",onClick:H,type:"button"},[b(a,{name:"Download",class:"w-4 h-4 mr-1"}),t[4]||(t[4]=C(" 匯出成績 ",-1))]),e("button",{class:"btn btn-sm btn-outline btn-warning",onClick:I,type:"button"},[b(a,{name:"RotateCcw",class:"w-4 h-4 mr-1"}),t[5]||(t[5]=C(" 全班總分歸零 ",-1))]),l(_)?(c(),r("button",{key:0,class:"btn btn-sm btn-primary",onClick:t[0]||(t[0]=(...s)=>l(_)&&l(_)(...s)),type:"button"},[b(a,{name:"UserPlus",class:"w-4 h-4 mr-1"}),t[6]||(t[6]=C(" 新增學生 ",-1))])):z("",!0)])])])])])]),e("div",{class:g(["grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 transition-all",l(d).length?"pb-32":""])},[(c(!0),r(k,null,y(l(n).students,s=>(c(),r("div",{key:s.id,class:g(["card bg-base-100 border-2 border-base-300 shadow-md rounded-xl hover:shadow-xl transition-all duration-200 cursor-pointer",{"ring-2 ring-primary":l(d).includes(s.id)}]),onClick:u=>U(s.id)},[e("div",ce,[e("div",de,[e("div",ue,[e("div",me,[e("span",{class:g(["inline-block w-2 h-2 rounded-full",s.isPresent?"bg-green-500":"bg-gray-400"]),title:s.isPresent?"出席":"缺席"},null,10,be),e("h3",ge,i(s.name),1)]),e("p",pe,"座號 "+i(s.id),1),e("label",xe,[e("input",{type:"checkbox",checked:s.isPresent,onClick:t[1]||(t[1]=m(()=>{},["stop"])),onChange:m(u=>j(s.id),["stop"]),class:"toggle toggle-success toggle-sm"},null,40,ve),e("span",{class:g(["text-sm font-medium",s.isPresent?"text-green-600":"text-gray-400"])},i(s.isPresent?"出席":"缺席"),3)])]),e("div",he,[e("div",fe,[t[8]||(t[8]=e("span",{class:"text-xs text-base-content/60 mb-1"},"總分",-1)),e("span",{class:g(["font-extrabold text-xl md:text-2xl lg:text-3xl text-primary px-2 py-2",l(h)[s.id]])},i(s.totalScore),3)]),e("div",_e,[e("button",{onClick:m(u=>M(s.id,1),["stop"]),class:"btn btn-md font-bold text-base px-4 py-1 rounded-full bg-gradient-to-r from-green-400 to-emerald-500 text-white border-none shadow hover:scale-105 hover:from-green-500 hover:to-emerald-600",title:"+1分"}," +1 ",8,we),e("button",{onClick:m(u=>M(s.id,-1),["stop"]),class:"btn btn-md font-bold text-base px-4 py-1 rounded-full bg-gradient-to-r from-rose-400 to-red-500 text-white border-none shadow hover:scale-105 hover:from-rose-500 hover:to-red-600",title:"-1分"}," -1 ",8,ke)])])])]),e("div",ye,[e("div",Ce,[e("div",{tabindex:"0",role:"button",class:"btn btn-ghost btn-xs btn-circle",onClick:t[2]||(t[2]=m(()=>{},["stop"]))},[b(a,{name:"MoreVertical",class:"w-4 h-4"})]),e("ul",Se,[e("li",null,[l($)?(c(),r("a",{key:0,onClick:m(u=>l($)(s.id),["stop"]),class:"flex items-center gap-2"},[b(a,{name:"Edit",class:"w-3 h-3"}),t[9]||(t[9]=e("span",null,"編輯學生",-1))],8,$e)):z("",!0)]),e("li",null,[e("a",{onClick:m(u=>q(s),["stop"]),class:"flex items-center gap-2"},[b(a,{name:"ScrollText",class:"w-3 h-3"}),t[10]||(t[10]=e("span",null,"評分記錄",-1))],8,Te)]),e("li",null,[e("a",{onClick:m(u=>j(s.id),["stop"]),class:"flex items-center gap-2"},[b(a,{name:s.isPresent?"UserMinus":"UserCheck",class:"w-3 h-3"},null,8,["name"]),e("span",null,i(s.isPresent?"標記缺席":"標記出席"),1)],8,Pe)]),t[12]||(t[12]=e("div",{class:"divider my-1"},null,-1)),e("li",null,[e("a",{onClick:m(u=>W(s),["stop"]),class:"text-error flex items-center gap-2"},[b(a,{name:"Trash2",class:"w-3 h-3"}),t[11]||(t[11]=e("span",null,"刪除學生",-1))],8,Me)])])])])],10,re))),128)),e("dialog",{ref_key:"historyModal",ref:w,class:"modal"},[e("div",De,[e("h3",Ne,i(l(p)?.name)+" 的評分記錄",1),l(p)&&l(p).scores.length>0?(c(),r("div",je,[(c(!0),r(k,null,y(l(p).scores.slice().reverse(),s=>(c(),r("div",{key:s.id,class:"flex justify-between items-center p-3 bg-base-200 rounded-lg"},[e("div",null,[e("div",ze,[e("span",{class:g(["badge",s.value>0?"badge-success":"badge-error"])},i(s.value>0?"+":"")+i(s.value),3),e("span",Ee,i(s.reason||"快速評分"),1)])]),e("div",Le,[e("div",Ve,i(A(s.timestamp)),1)])]))),128))])):(c(),r("div",Ue,"尚無評分記錄")),e("div",{class:"modal-action"},[e("button",{onClick:N,class:"btn btn-ghost"},"關閉")])]),e("form",{method:"dialog",class:"modal-backdrop"},[e("button",{onClick:N},"close")])],512)],2)])):(c(),r("div",Be,[...t[13]||(t[13]=[e("p",null,"正在載入班級資料...",-1),e("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}}}),Ae=X(Fe,[["__scopeId","data-v-b75ceaaa"]]);export{Ae as default};
