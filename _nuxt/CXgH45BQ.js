import{f as B,g as D,y as E,C as F,r as v,c as i,l as n,o as a,a as e,F as x,n as f,x as p,t as l,p as g,b,L as I,j as N,I as U}from"#entry";const q={key:0,class:"space-y-6"},H={class:"card bg-base-100 shadow-sm"},O={class:"card-body"},Q={class:"flex flex-wrap gap-4 items-center"},R={class:"form-control"},W={class:"flex flex-wrap gap-2"},A=["onClick","title"],G=["onClick"],J={class:"card-body p-4"},K={class:"flex justify-between items-start mb-3"},X={class:"font-semibold text-base"},Y={class:"text-sm text-base-content/70"},Z={class:"dropdown dropdown-end"},ee={tabindex:"0",class:"dropdown-content menu bg-base-100 rounded-box z-[1] w-48 p-2 shadow"},se=["onClick"],te=["onClick"],oe=["onClick"],ne=["onClick"],le={class:"space-y-2 mb-3"},ie={class:"flex justify-between items-center group"},ae={class:"font-bold text-lg text-primary"},re={class:"flex justify-between items-center"},ce={class:"flex items-center gap-2 select-none"},de=["checked","onChange"],ue={class:"flex gap-1"},ge=["onClick"],me=["onClick"],pe={class:"modal-box w-11/12 max-w-2xl"},be={class:"text-lg font-bold mb-4"},he={key:0,class:"space-y-3 max-h-96 overflow-y-auto"},ve={class:"flex items-center gap-2"},_e={class:"text-sm"},xe={class:"text-right"},fe={class:"text-sm text-base-content/70"},ke={key:1,class:"text-center py-8 text-base-content/70"},ye={key:1,class:"text-center p-8"},Se=B({__name:"index",setup(we){const h=D(),P=E(),{currentClass:r}=F(h),k=U("editStudent"),_=v(),y=v(1),d=v([]),m=v(null),M=[3,2,1,-1,-2,-3],T=o=>{const t=d.value.indexOf(o);t>-1?d.value.splice(t,1):d.value.push(o)},w=(o,t)=>{C(o,t,"快速評分")},j=o=>{d.value.length>0?d.value.forEach(t=>C(t,o,"批量快速評分")):y.value=o},C=(o,t,c)=>{r.value&&h.addScoreToStudent(r.value.id,o,t,c)},L=o=>{r.value&&confirm(`確定要刪除學生「${o.name}」嗎？此操作無法復原。`)&&(h.removeStudentFromClass(r.value.id,o.id),P.showSuccess("學生已刪除"))},V=o=>{m.value=o,_.value?.showModal()},S=()=>{_.value?.close(),m.value=null},$=o=>{if(!r.value)return;const t=r.value.students.find(c=>c.id===o);t&&h.updateStudent(r.value.id,o,{isPresent:!t.isPresent})},z=o=>new Date(o).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return(o,t)=>{const c=I;return n(r)?(a(),i("div",q,[e("div",H,[e("div",O,[e("div",Q,[e("div",R,[t[1]||(t[1]=e("label",{class:"label"},[e("span",{class:"label-text"},"快速加分")],-1)),e("div",W,[(a(),i(x,null,f(M,s=>e("button",{key:s,onClick:u=>j(s),class:p(["px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 border focus:outline-none focus:ring-2 focus:ring-primary/40",s===n(y)?s>0?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow":"bg-gradient-to-r from-rose-500 to-red-500 text-white shadow":s>0?"bg-green-50 dark:bg-green-900/20 text-green-600 border-green-200 dark:border-green-700 hover:bg-green-100 dark:hover:bg-green-900/40":"bg-rose-50 dark:bg-rose-900/20 text-rose-600 border-rose-200 dark:border-rose-700 hover:bg-rose-100 dark:hover:bg-rose-900/40"]),title:n(d).length?"立即對選取學生套用":"設定批量評分預設分數"},l(s>0?"+":"")+l(s),11,A)),64))])])])])]),e("div",{class:p(["grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 transition-all",n(d).length?"pb-32":""])},[(a(!0),i(x,null,f(n(r).students,s=>(a(),i("div",{key:s.id,class:p(["card bg-base-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",{"ring-2 ring-primary":n(d).includes(s.id)}]),onClick:u=>T(s.id)},[e("div",J,[e("div",K,[e("div",null,[e("h3",X,l(s.name),1),e("p",Y,"座號 "+l(s.id),1)]),e("div",Z,[e("div",{tabindex:"0",role:"button",class:"btn btn-ghost btn-xs btn-circle",onClick:t[0]||(t[0]=g(()=>{},["stop"]))},[b(c,{name:"MoreVertical",class:"w-3 h-3"})]),e("ul",ee,[e("li",null,[n(k)?(a(),i("a",{key:0,onClick:g(u=>n(k)(s.id),["stop"]),class:"flex items-center gap-2"},[b(c,{name:"Edit",class:"w-3 h-3"}),t[2]||(t[2]=e("span",null,"編輯學生",-1))],8,se)):N("",!0)]),e("li",null,[e("a",{onClick:g(u=>V(s),["stop"]),class:"flex items-center gap-2"},[b(c,{name:"ScrollText",class:"w-3 h-3"}),t[3]||(t[3]=e("span",null,"評分記錄",-1))],8,te)]),e("li",null,[e("a",{onClick:g(u=>$(s.id),["stop"]),class:"flex items-center gap-2"},[b(c,{name:s.isPresent?"UserMinus":"UserCheck",class:"w-3 h-3"},null,8,["name"]),e("span",null,l(s.isPresent?"標記缺席":"標記出席"),1)],8,oe)]),t[5]||(t[5]=e("div",{class:"divider my-1"},null,-1)),e("li",null,[e("a",{onClick:g(u=>L(s),["stop"]),class:"text-error flex items-center gap-2"},[b(c,{name:"Trash2",class:"w-3 h-3"}),t[4]||(t[4]=e("span",null,"刪除學生",-1))],8,ne)])])])]),e("div",le,[e("div",ie,[t[6]||(t[6]=e("span",{class:"text-sm text-base-content/70 flex items-center gap-1"},"總分",-1)),e("span",ae,l(s.totalScore),1)])]),e("div",re,[e("label",ce,[e("input",{type:"checkbox",checked:s.isPresent,onChange:g(u=>$(s.id),["stop"]),class:"toggle toggle-success toggle-sm"},null,40,de),e("span",{class:p(["text-xs font-medium",s.isPresent?"text-green-600":"text-gray-400"])},l(s.isPresent?"出席":"缺席"),3)]),e("div",ue,[e("button",{onClick:g(u=>w(s.id,1),["stop"]),class:"btn btn-xs btn-success",title:"+1分"}," +1 ",8,ge),e("button",{onClick:g(u=>w(s.id,-1),["stop"]),class:"btn btn-xs btn-error",title:"-1分"}," -1 ",8,me)])])])],10,G))),128))],2),e("dialog",{ref_key:"historyModal",ref:_,class:"modal"},[e("div",pe,[e("h3",be,l(n(m)?.name)+" 的評分記錄",1),n(m)&&n(m).scores.length>0?(a(),i("div",he,[(a(!0),i(x,null,f(n(m).scores.slice().reverse(),s=>(a(),i("div",{key:s.id,class:"flex justify-between items-center p-3 bg-base-200 rounded-lg"},[e("div",null,[e("div",ve,[e("span",{class:p(["badge",s.value>0?"badge-success":"badge-error"])},l(s.value>0?"+":"")+l(s.value),3),e("span",_e,l(s.reason||"快速評分"),1)])]),e("div",xe,[e("div",fe,l(z(s.timestamp)),1)])]))),128))])):(a(),i("div",ke,"尚無評分記錄")),e("div",{class:"modal-action"},[e("button",{onClick:S,class:"btn btn-ghost"},"關閉")])]),e("form",{method:"dialog",class:"modal-backdrop"},[e("button",{onClick:S},"close")])],512)])):(a(),i("div",ye,[...t[7]||(t[7]=[e("p",null,"正在載入班級資料...",-1),e("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}}});export{Se as default};
