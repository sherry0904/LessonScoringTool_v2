import{f as Y,g as Z,C as tt,i as j,r as g,h as st,L as et,A as ot,c as u,l as a,o as b,a as t,j as nt,b as H,d as z,n as lt,F as R,p as D,y as L,t as v,q as w,k as N,v as B,m as at}from"#entry";const it={key:0,class:"space-y-6"},dt={class:"card bg-base-100 shadow-sm"},rt={class:"card-body"},ct={class:"flex justify-between items-center"},ut={key:0,class:"mt-4"},bt={class:"tabs tabs-boxed"},vt=["onClick"],mt={key:1,class:"text-center py-8 text-base-content/70"},pt={key:0,class:"space-y-4"},gt={class:"stats stats-horizontal shadow"},_t={class:"stat"},ht={class:"stat-value text-error"},ft={class:"stat"},xt={class:"stat-value text-success"},kt={class:"stat"},wt={class:"stat-value text-warning"},yt={class:"stat"},Ct={class:"stat-value text-info"},St={class:"card bg-base-100 shadow-sm"},$t={class:"card-body"},Mt={class:"flex flex-wrap gap-4 items-center"},Tt={class:"form-control"},jt={class:"btn-group"},Ht=["disabled"],Lt=["disabled"],Vt=["disabled"],zt={class:"grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},Rt=["onClick"],Dt={class:"card-body p-4"},Nt={class:"flex justify-between items-start mb-3"},Bt={class:"font-semibold text-base"},Ft={class:"text-sm text-base-content/70"},It={class:"dropdown dropdown-end"},Ot={tabindex:"0",class:"dropdown-content menu bg-base-100 rounded-box z-[1] w-48 p-2 shadow"},At=["onClick"],Ut={class:"mb-3"},Wt={class:"grid grid-cols-2 gap-1"},qt=["onClick"],Et=["onClick"],Pt={class:"modal-box"},Gt={class:"form-control"},Jt={class:"modal-box w-11/12 max-w-2xl"},Kt={class:"text-lg font-bold mb-4"},Qt={class:"form-control mb-4"},Xt={key:1,class:"text-center p-8"},ts=Y({__name:"homework",setup(Yt){const C=Z(),F=tt(),I=j(()=>F.params.id),l=j(()=>C.classes.find(e=>e.id===I.value)),S=g(),_=g(),r=g(null),c=g([]),y=g(""),m=g(""),h=st({title:""}),i=j(()=>!r.value||!l.value?null:l.value.homeworks.find(e=>e.id===r.value)||null),f=["pending","submitted","needs_correction","completed"],O={pending:"未繳交",submitted:"已繳交",needs_correction:"待訂正",completed:"已完成"},p=e=>i.value&&i.value.studentStatus[e]||"pending",x=e=>O[e]||"未知",A=e=>({pending:"badge-error",submitted:"badge-success",needs_correction:"badge-warning",completed:"badge-info"})[e]||"badge-neutral",k=e=>i.value?Object.values(i.value.studentStatus).filter(s=>s===e).length:0,U=e=>{const n=(f.indexOf(e)+1)%f.length;return f[n]},W=e=>{const s=c.value.indexOf(e);s>-1?c.value.splice(s,1):c.value.push(e)},$=(e,s)=>{!i.value||!l.value||C.updateHomeworkStatus(l.value.id,i.value.id,e,s)},q=e=>{$(e,"pending")},M=e=>{!i.value||c.value.length===0||(c.value.forEach(s=>{$(s,e)}),c.value=[])},E=()=>{h.title="",S.value?.showModal()},T=()=>{S.value?.close()},P=()=>{if(!h.title.trim()||!l.value)return;const e=C.addHomework(l.value.id,h.title);e&&(r.value=e.id),T()},G=()=>{if(!i.value||!l.value)return;const e=l.value.students.filter(n=>{const o=p(n.id);return o==="pending"||o==="needs_correction"}),s=[`作業：${i.value.title}`,`匯出時間：${new Date().toLocaleString("zh-TW")}`,"","未完成學生名單：",...e.map(n=>`${n.id} ${n.name} - ${x(p(n.id))}`),"",`總計：${e.length} 位學生`].join(`
`);y.value="未完成作業名單",m.value=s,_.value?.showModal()},J=()=>{if(!i.value||!l.value)return;const e=f.reduce((n,o)=>(n[o]=k(o),n),{}),s=["作業狀態報告",`作業：${i.value.title}`,`匯出時間：${new Date().toLocaleString("zh-TW")}`,"","狀態統計：",...f.map(n=>`${x(n)}：${e[n]} 人`),"","詳細名單：",...l.value.students.map(n=>`${n.id} ${n.name} - ${x(p(n.id))}`)].join(`
`);y.value="作業狀態報告",m.value=s,_.value?.showModal()},K=e=>{if(!l.value)return;const s=l.value.students.find(d=>d.id===e);if(!s||!i.value)return;const n=l.value.homeworks.filter(d=>{const V=d.studentStatus[e]||"pending";return V==="pending"||V==="needs_correction"}),o=["個人作業報告",`學生：${s.name} (座號 ${s.id})`,`匯出時間：${new Date().toLocaleString("zh-TW")}`,"","未完成作業：",...n.map(d=>`• ${d.title} - ${x(d.studentStatus[e]||"pending")}`),"",`總計：${n.length} 項作業需要完成`].join(`
`);y.value=`${s.name} 的作業報告`,m.value=o,_.value?.showModal()},Q=async()=>{try{await navigator.clipboard.writeText(m.value),alert("已複製到剪貼簿！")}catch(e){console.error("複製失敗:",e),alert("複製失敗，請手動選取文字複製。")}},X=()=>{_.value?.close()};return et(()=>{l.value&&l.value.homeworks.length>0&&!r.value&&(r.value=l.value.homeworks[0].id)}),ot(()=>l.value?.homeworks,e=>{e&&e.length>0&&!r.value?r.value=e[0].id:e&&e.length===0&&(r.value=null)}),(e,s)=>{const n=lt;return a(l)?(b(),u("div",it,[t("div",dt,[t("div",rt,[t("div",ct,[s[7]||(s[7]=t("h3",{class:"card-title"},"作業管理",-1)),t("button",{onClick:E,class:"btn btn-primary gap-2"},[H(n,{name:"Plus",class:"w-4 h-4"}),s[6]||(s[6]=z(" 新增作業 ",-1))])]),a(l).homeworks.length>0?(b(),u("div",ut,[t("div",bt,[(b(!0),u(R,null,D(a(l).homeworks,o=>(b(),u("button",{key:o.id,class:L(["tab",{"tab-active":a(r)===o.id}]),onClick:d=>r.value=o.id},v(o.title),11,vt))),128))])])):(b(),u("div",mt," 還沒有作業，點擊上方按鈕新增第一個作業 "))])]),a(i)?(b(),u("div",pt,[t("div",gt,[t("div",_t,[s[8]||(s[8]=t("div",{class:"stat-title"},"未繳交",-1)),t("div",ht,v(k("pending")),1)]),t("div",ft,[s[9]||(s[9]=t("div",{class:"stat-title"},"已繳交",-1)),t("div",xt,v(k("submitted")),1)]),t("div",kt,[s[10]||(s[10]=t("div",{class:"stat-title"},"待訂正",-1)),t("div",wt,v(k("needs_correction")),1)]),t("div",yt,[s[11]||(s[11]=t("div",{class:"stat-title"},"已完成",-1)),t("div",Ct,v(k("completed")),1)])]),t("div",St,[t("div",$t,[t("div",Mt,[t("div",Tt,[s[12]||(s[12]=t("label",{class:"label"},[t("span",{class:"label-text"},"快速操作")],-1)),t("div",jt,[t("button",{onClick:s[0]||(s[0]=o=>M("submitted")),class:"btn btn-success btn-sm",disabled:a(c).length===0}," 批量標記已繳交 ",8,Ht),t("button",{onClick:s[1]||(s[1]=o=>M("needs_correction")),class:"btn btn-warning btn-sm",disabled:a(c).length===0}," 批量標記待訂正 ",8,Lt),t("button",{onClick:s[2]||(s[2]=o=>M("completed")),class:"btn btn-info btn-sm",disabled:a(c).length===0}," 批量標記已完成 ",8,Vt)])]),t("div",{class:"form-control"},[s[13]||(s[13]=t("label",{class:"label"},[t("span",{class:"label-text"},"匯出功能")],-1)),t("div",{class:"btn-group"},[t("button",{onClick:G,class:"btn btn-outline btn-sm"}," 匯出未完成名單 "),t("button",{onClick:J,class:"btn btn-outline btn-sm"}," 匯出狀態報告 ")])])])])]),t("div",zt,[(b(!0),u(R,null,D(a(l).students,o=>(b(),u("div",{key:o.id,class:L(["card bg-base-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",{"ring-2 ring-primary":a(c).includes(o.id)}]),onClick:d=>W(o.id)},[t("div",Dt,[t("div",Nt,[t("div",null,[t("h3",Bt,v(o.name),1),t("p",Ft,"座號 "+v(o.id),1)]),t("div",It,[t("div",{tabindex:"0",role:"button",class:"btn btn-ghost btn-xs btn-circle",onClick:s[3]||(s[3]=w(()=>{},["stop"]))},[H(n,{name:"MoreVertical",class:"w-3 h-3"})]),t("ul",Ot,[t("li",null,[t("a",{onClick:w(d=>K(o.id),["stop"])},[H(n,{name:"FileText",class:"w-3 h-3"}),s[14]||(s[14]=z(" 個人報告 ",-1))],8,At)])])])]),t("div",Ut,[t("div",{class:L(["badge w-full",A(p(o.id))])},v(x(p(o.id))),3)]),t("div",Wt,[t("button",{onClick:w(d=>$(o.id,U(p(o.id))),["stop"]),class:"btn btn-xs btn-primary"}," 切換狀態 ",8,qt),t("button",{onClick:w(d=>q(o.id),["stop"]),class:"btn btn-xs btn-ghost"}," 重設 ",8,Et)])])],10,Rt))),128))])])):nt("",!0),t("dialog",{ref_key:"addHomeworkModal",ref:S,class:"modal"},[t("div",Pt,[s[17]||(s[17]=t("h3",{class:"text-lg font-bold mb-4"},"新增作業",-1)),t("form",{onSubmit:w(P,["prevent"]),class:"space-y-4"},[t("div",Gt,[s[15]||(s[15]=t("label",{class:"label mr-2"},[t("span",{class:"label-text"},"作業名稱")],-1)),N(t("input",{"onUpdate:modelValue":s[4]||(s[4]=o=>a(h).title=o),type:"text",placeholder:"例如：數學習作 P.30-32",class:"input input-bordered",required:""},null,512),[[B,a(h).title]])]),t("div",{class:"modal-action"},[t("button",{type:"button",onClick:T,class:"btn btn-ghost"}," 取消 "),s[16]||(s[16]=t("button",{type:"submit",class:"btn btn-primary"},"新增",-1))])],32)]),t("form",{method:"dialog",class:"modal-backdrop"},[t("button",{onClick:T},"close")])],512),t("dialog",{ref_key:"reportModal",ref:_,class:"modal"},[t("div",Jt,[t("h3",Kt,v(a(y)),1),t("div",Qt,[s[18]||(s[18]=t("label",{class:"label"},[t("span",{class:"label-text"},"報告內容")],-1)),N(t("textarea",{"onUpdate:modelValue":s[5]||(s[5]=o=>at(m)?m.value=o:null),class:"textarea textarea-bordered h-64",readonly:""},null,512),[[B,a(m)]])]),t("div",{class:"modal-action"},[t("button",{onClick:Q,class:"btn btn-success"}," 複製到剪貼簿 "),t("button",{onClick:X,class:"btn btn-ghost"},"關閉")])])],512)])):(b(),u("div",Xt,[...s[19]||(s[19]=[t("p",null,"正在載入班級資料...",-1),t("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}}});export{ts as default};
