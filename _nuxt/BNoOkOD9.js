import{f as lt,g as at,C as it,i as g,r as h,h as dt,L as ct,A as rt,c as v,l as a,o as b,a as t,j as E,b as y,d as F,n as ut,F as R,p as N,y as z,t as d,q as S,k as A,v as B,m as vt}from"#entry";const bt={key:0,class:"space-y-6"},mt={class:"card bg-base-100 shadow-sm"},pt={class:"card-body"},_t={class:"flex justify-between items-center"},ht={key:0,class:"mt-4"},gt={class:"tabs tabs-boxed"},xt=["onClick"],ft={key:1,class:"text-center py-8 text-base-content/70"},kt={key:0,class:"flex items-center gap-2 mb-4"},wt={class:"text-2xl font-bold"},Ct={key:1,class:"space-y-4"},yt={class:"stats stats-horizontal shadow"},St={class:"stat"},$t={class:"stat-value text-error"},Tt={class:"stat"},Mt={class:"stat-value text-success"},Ht={class:"stat"},jt={class:"stat-value text-warning"},Lt={class:"stat"},Vt={class:"stat-value text-info"},zt={class:"card bg-base-100 shadow-sm"},Dt={class:"card-body"},Et={class:"flex flex-wrap gap-4 items-center"},Ft={class:"form-control"},Rt={class:"btn-group"},Nt=["disabled"],At=["disabled"],Bt=["disabled"],It={class:"grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},Ot=["onClick"],Ut={class:"card-body p-4"},Wt={class:"flex justify-between items-start mb-3"},qt={class:"font-semibold text-base"},Pt={class:"text-sm text-base-content/70"},Gt={class:"dropdown dropdown-end"},Jt={tabindex:"0",class:"dropdown-content menu bg-base-100 rounded-box z-[1] w-48 p-2 shadow"},Kt=["onClick"],Qt={class:"mb-3"},Xt={class:"font-medium text-sm"},Yt={class:"grid grid-cols-2 gap-1"},Zt=["onClick"],te=["onClick"],ee={class:"modal-box"},se={class:"text-lg font-bold mb-4"},oe={class:"form-control"},ne={class:"modal-action"},le={type:"submit",class:"btn btn-primary"},ae={class:"modal-box w-11/12 max-w-2xl"},ie={class:"text-lg font-bold mb-4"},de={class:"form-control mb-4"},ce={key:1,class:"text-center p-8"},ve=lt({__name:"homework",setup(re){const $=at(),I=it(),O=g(()=>I.params.id),l=g(()=>$.classes.find(s=>s.id===O.value)),T=h(),x=h(),r=h(null),u=h([]),M=h(""),_=h(""),f=h(null),p=dt({title:""}),i=g(()=>!r.value||!l.value?null:l.value.homeworks.find(s=>s.id===r.value)||null),j=g(()=>f.value!==null),U=g(()=>j.value?"編輯作業":"新增作業"),W=g(()=>j.value?"更新":"新增"),k=["pending","submitted","needs_correction","completed"],q={pending:{text:"未繳交",icon:"Clock"},submitted:{text:"已繳交",icon:"CheckCircle"},needs_correction:{text:"待訂正",icon:"AlertTriangle"},completed:{text:"已完成",icon:"Award"}},m=s=>i.value&&i.value.studentStatus[s]||"pending",w=s=>q[s]||{text:"未知",icon:"HelpCircle"},C=s=>i.value?Object.values(i.value.studentStatus).filter(e=>e===s).length:0,P=s=>{const n=(k.indexOf(s)+1)%k.length;return k[n]},G=s=>{const e=u.value.indexOf(s);e>-1?u.value.splice(e,1):u.value.push(s)},L=(s,e)=>{!i.value||!l.value||$.updateHomeworkStatus(l.value.id,i.value.id,s,e)},J=s=>{L(s,"pending")},V=s=>{!i.value||u.value.length===0||(u.value.forEach(e=>{L(e,s)}),u.value=[])},K=()=>{f.value=null,p.title="",T.value?.showModal()},Q=s=>{const e=l.value?.homeworks.find(n=>n.id===s);e&&(f.value=s,p.title=e.title,T.value?.showModal())},H=()=>{T.value?.close()},X=()=>{if(!p.title.trim()||!l.value)return;const s=$.addHomework(l.value.id,p.title);s&&(r.value=s.id),H()},Y=()=>{!f.value||!p.title.trim()||!l.value||($.updateHomeworkTitle(l.value.id,f.value,p.title),H())},Z=()=>{j.value?Y():X()},tt=()=>{if(!i.value||!l.value)return;const s=l.value.students.filter(n=>{const o=m(n.id);return o==="pending"||o==="needs_correction"}),e=[`作業：${i.value.title}`,`匯出時間：${new Date().toLocaleString("zh-TW")}`,"","未完成學生名單：",...s.map(n=>`${n.id} ${n.name} - ${getStatusText(m(n.id))}`),"",`總計：${s.length} 位學生`].join(`
`);M.value="未完成作業名單",_.value=e,x.value?.showModal()},et=()=>{if(!i.value||!l.value)return;const s=k.reduce((n,o)=>(n[o]=C(o),n),{}),e=["作業狀態報告",`作業：${i.value.title}`,`匯出時間：${new Date().toLocaleString("zh-TW")}`,"","狀態統計：",...k.map(n=>`${getStatusText(n)}：${s[n]} 人`),"","詳細名單：",...l.value.students.map(n=>`${n.id} ${n.name} - ${getStatusText(m(n.id))}`)].join(`
`);M.value="作業狀態報告",_.value=e,x.value?.showModal()},st=s=>{if(!l.value)return;const e=l.value.students.find(c=>c.id===s);if(!e||!i.value)return;const n=l.value.homeworks.filter(c=>{const D=c.studentStatus[s]||"pending";return D==="pending"||D==="needs_correction"}),o=["個人作業報告",`學生：${e.name} (座號 ${e.id})`,`匯出時間：${new Date().toLocaleString("zh-TW")}`,"","未完成作業：",...n.map(c=>`• ${c.title} - ${getStatusText(c.studentStatus[s]||"pending")}`),"",`總計：${n.length} 項作業需要完成`].join(`
`);M.value=`${e.name} 的作業報告`,_.value=o,x.value?.showModal()},ot=async()=>{try{await navigator.clipboard.writeText(_.value),alert("已複製到剪貼簿！")}catch(s){console.error("複製失敗:",s),alert("複製失敗，請手動選取文字複製。")}},nt=()=>{x.value?.close()};return ct(()=>{l.value&&l.value.homeworks.length>0&&!r.value&&(r.value=l.value.homeworks[0].id)}),rt(()=>l.value?.homeworks,s=>{s&&s.length>0&&!r.value?r.value=s[0].id:s&&s.length===0&&(r.value=null)}),(s,e)=>{const n=ut;return a(l)?(b(),v("div",bt,[t("div",mt,[t("div",pt,[t("div",_t,[e[8]||(e[8]=t("h3",{class:"card-title"},"作業管理",-1)),t("button",{onClick:K,class:"btn btn-primary gap-2"},[y(n,{name:"Plus",class:"w-4 h-4"}),e[7]||(e[7]=F(" 新增作業 ",-1))])]),a(l).homeworks.length>0?(b(),v("div",ht,[t("div",gt,[(b(!0),v(R,null,N(a(l).homeworks,o=>(b(),v("button",{key:o.id,class:z(["tab",{"tab-active":a(r)===o.id}]),onClick:c=>r.value=o.id},d(o.title),11,xt))),128))])])):(b(),v("div",ft," 還沒有作業，點擊上方按鈕新增第一個作業 "))])]),a(i)?(b(),v("div",kt,[t("h2",wt,d(a(i).title),1),t("button",{onClick:e[0]||(e[0]=o=>Q(a(i).id)),class:"btn btn-ghost btn-sm btn-circle",title:"編輯作業名稱"},[y(n,{name:"Edit",class:"w-4 h-4"})])])):E("",!0),a(i)?(b(),v("div",Ct,[t("div",yt,[t("div",St,[e[9]||(e[9]=t("div",{class:"stat-title"},"未繳交",-1)),t("div",$t,d(C("pending")),1)]),t("div",Tt,[e[10]||(e[10]=t("div",{class:"stat-title"},"已繳交",-1)),t("div",Mt,d(C("submitted")),1)]),t("div",Ht,[e[11]||(e[11]=t("div",{class:"stat-title"},"待訂正",-1)),t("div",jt,d(C("needs_correction")),1)]),t("div",Lt,[e[12]||(e[12]=t("div",{class:"stat-title"},"已完成",-1)),t("div",Vt,d(C("completed")),1)])]),t("div",zt,[t("div",Dt,[t("div",Et,[t("div",Ft,[e[13]||(e[13]=t("label",{class:"label"},[t("span",{class:"label-text"},"快速操作")],-1)),t("div",Rt,[t("button",{onClick:e[1]||(e[1]=o=>V("submitted")),class:"btn btn-success btn-sm mr-2",disabled:a(u).length===0}," 批量標記已繳交 ",8,Nt),t("button",{onClick:e[2]||(e[2]=o=>V("needs_correction")),class:"btn btn-warning btn-sm mr-2",disabled:a(u).length===0}," 批量標記待訂正 ",8,At),t("button",{onClick:e[3]||(e[3]=o=>V("completed")),class:"btn btn-info btn-sm",disabled:a(u).length===0}," 批量標記已完成 ",8,Bt)])]),t("div",{class:"form-control"},[e[14]||(e[14]=t("label",{class:"label"},[t("span",{class:"label-text"},"匯出功能")],-1)),t("div",{class:"btn-group"},[t("button",{onClick:tt,class:"btn btn-outline btn-sm"}," 匯出未完成名單 "),t("button",{onClick:et,class:"btn btn-outline btn-sm"}," 匯出狀態報告 ")])])])])]),t("div",It,[(b(!0),v(R,null,N(a(l).students,o=>(b(),v("div",{key:o.id,class:z(["card bg-base-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",{"ring-2 ring-primary":a(u).includes(o.id)}]),onClick:c=>G(o.id)},[t("div",Ut,[t("div",Wt,[t("div",null,[t("h3",qt,d(o.name),1),t("p",Pt,"座號 "+d(o.id),1)]),t("div",Gt,[t("div",{tabindex:"0",role:"button",class:"btn btn-ghost btn-xs btn-circle",onClick:e[4]||(e[4]=S(()=>{},["stop"]))},[y(n,{name:"MoreVertical",class:"w-3 h-3"})]),t("ul",Jt,[t("li",null,[t("a",{onClick:S(c=>st(o.id),["stop"])},[y(n,{name:"FileText",class:"w-3 h-3"}),e[15]||(e[15]=F(" 個人報告 ",-1))],8,Kt)])])])]),t("div",Qt,[t("div",{class:z(["flex items-center justify-center w-full px-4 py-2 rounded-full border",w(m(o.id)).bgColor,"bg-opacity-75",w(m(o.id)).borderColor,w(m(o.id)).textColor,"shadow-sm hover:shadow-md transition-all duration-200 hover:scale-105"])},[y(n,{name:w(m(o.id)).icon,class:"w-4 h-4 mr-2"},null,8,["name"]),t("span",Xt,d(w(m(o.id)).text),1)],2)]),t("div",Yt,[t("button",{onClick:S(c=>L(o.id,P(m(o.id))),["stop"]),class:"btn btn-xs btn-primary"}," 切換狀態 ",8,Zt),t("button",{onClick:S(c=>J(o.id),["stop"]),class:"btn btn-xs btn-ghost"}," 重設 ",8,te)])])],10,Ot))),128))])])):E("",!0),t("dialog",{ref_key:"homeworkModal",ref:T,class:"modal"},[t("div",ee,[t("h3",se,d(a(U)),1),t("form",{onSubmit:S(Z,["prevent"]),class:"space-y-4"},[t("div",oe,[e[16]||(e[16]=t("label",{class:"label mr-2"},[t("span",{class:"label-text"},"作業名稱")],-1)),A(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>a(p).title=o),type:"text",placeholder:"例如：數學習作 P.30-32",class:"input input-bordered",required:""},null,512),[[B,a(p).title]])]),t("div",ne,[t("button",{type:"button",onClick:H,class:"btn btn-ghost"}," 取消 "),t("button",le,d(a(W)),1)])],32)]),t("form",{method:"dialog",class:"modal-backdrop"},[t("button",{onClick:H},"close")])],512),t("dialog",{ref_key:"reportModal",ref:x,class:"modal"},[t("div",ae,[t("h3",ie,d(a(M)),1),t("div",de,[e[17]||(e[17]=t("label",{class:"label"},[t("span",{class:"label-text"},"報告內容")],-1)),A(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=o=>vt(_)?_.value=o:null),class:"textarea textarea-bordered h-64",readonly:""},null,512),[[B,a(_)]])]),t("div",{class:"modal-action"},[t("button",{onClick:ot,class:"btn btn-success"}," 複製到剪貼簿 "),t("button",{onClick:nt,class:"btn btn-ghost"},"關閉")])])],512)])):(b(),v("div",ce,[...e[18]||(e[18]=[t("p",null,"正在載入班級資料...",-1),t("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}}});export{ve as default};
