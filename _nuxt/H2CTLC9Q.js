import{f as te,c as d,o as u,a as e,b as m,L as I,A as D,t as p,k as C,y as le,_ as we,d as h,V as ws,F as O,p as ce,n as pe,W as ys,w as Be,X as Ss,Y as xs,Z as Cs,D as ge,T as yt,$ as St,j as x,a0 as He,H as $s,z as ee,a1 as Qe,r as k,C as Is,g as xt,h as ks,s as Gs,K as ft,a2 as qe,a3 as ht,a4 as Ts,a5 as _s,a6 as Ms,l as A,x as wt,U as As,a7 as Ds,a8 as Ps,u as Es}from"#entry";const q={minGroups:2,maxGroups:10,defaultGroupCount:4,defaultColors:["#3b82f6","#ef4444","#10b981","#f59e0b","#8b5cf6","#ec4899","#06b6d4","#84cc16"]};q.minGroups,q.maxGroups,`${q.minGroups}${q.maxGroups}`;const Bs={class:"relative"},Us={key:0,class:"flex flex-col gap-2"},js={class:"flex items-center justify-between"},Rs={class:"flex items-center gap-1.5 font-medium"},Ns={class:"flex items-center gap-2"},Ls={class:"invincible-progress flex-1"},Os={class:"invincible-progress-track"},Fs={key:0,class:"badge badge-sm border-none bg-amber-200 text-amber-700"},zs={class:"flex items-center gap-1 text-xs text-amber-600"},Vs={key:1,class:"flex items-center gap-2 sm:gap-2.5"},Ws={class:"flex items-center gap-1 shrink-0"},qs={class:"flex-1 min-w-[40px]"},Hs={class:"h-2 w-full bg-gray-200 rounded-full overflow-hidden"},Qs={key:0,class:"badge badge-xs border-none bg-amber-200 text-amber-700 shrink-0"},Ys=te({__name:"GroupRewardStatus",props:{group:{},formattedTimer:{},totalStars:{},starProgress:{},invincibleProgress:{},queueCount:{},starGainClass:{},countdownCritical:{type:Boolean}},setup(R){return(t,o)=>(u(),d("div",Bs,[e("div",{class:D(["rounded-lg transition-colors overflow-hidden",[t.group.isInvincible?"border border-amber-200 bg-amber-50/70 text-amber-700 invincible-activate px-3 py-2":"text-base-content/70 px-1.5 py-1 sm:px-2 sm:py-1.5"]])},[t.group.isInvincible?(u(),d("div",Us,[e("div",js,[e("div",Rs,[m(I,{name:"Zap",class:"w-4 h-4 text-amber-500 invincible-pulse"}),o[0]||(o[0]=e("span",null,"ÁÑ°Êïµ",-1))]),e("span",{class:D(["font-semibold text-amber-600",t.countdownCritical?"countdown-critical":""])},p(t.formattedTimer),3)]),e("div",Ns,[e("div",Ls,[e("div",Os,[e("div",{class:"invincible-progress-fill",style:le({width:`${t.invincibleProgress*100}%`})},null,4)])]),t.queueCount>0?(u(),d("span",Fs," +"+p(t.queueCount)+" Ê¨° ",1)):C("",!0)]),e("div",zs,[m(I,{name:"Star",class:"w-3.5 h-3.5 text-yellow-400"}),e("span",null,p(t.totalStars)+" È°ÜÊòü",1)])])):(u(),d("div",Vs,[e("div",Ws,[m(I,{name:"Star",class:"w-4 h-4 text-yellow-400 shrink-0"}),e("span",{class:D(["text-base font-bold tabular-nums text-amber-600",t.starGainClass])},p(t.totalStars),3)]),e("div",qs,[e("div",Hs,[e("div",{class:D(["h-full bg-gradient-to-r from-yellow-400 to-amber-500 transition-all duration-300",{"progress-flash":t.starProgress>=1}]),style:le({width:`${t.starProgress*100}%`})},null,6)])]),t.queueCount>0?(u(),d("span",Qs,"+"+p(t.queueCount),1)):C("",!0)]))],2)]))}}),Ks=Object.assign(we(Ys,[["__scopeId","data-v-3ac73ce0"]]),{__name:"GroupingGroupRewardStatus"}),Xs={class:"flex items-center gap-2 mt-2"},Zs=["disabled"],Js=["disabled"],en=te({__name:"GroupActionButtons",props:{positiveLabel:{},negativeLabel:{},disabled:{type:Boolean}},emits:["add-positive","add-negative"],setup(R){return(t,o)=>(u(),d("div",Xs,[e("button",{class:"btn btn-md flex-1 font-bold text-base px-4 py-1 rounded-full text-white border-none shadow transition-transform hover:scale-105 bg-gradient-to-r from-green-400 to-emerald-500 hover:from-green-500 hover:to-emerald-600 disabled:opacity-50 disabled:hover:scale-100",disabled:t.disabled,onClick:o[0]||(o[0]=a=>t.$emit("add-positive"))},p(t.positiveLabel),9,Zs),e("button",{class:"btn btn-md flex-1 font-bold text-base px-4 py-1 rounded-full text-white border-none shadow transition-transform hover:scale-105 bg-gradient-to-r from-rose-400 to-red-500 hover:from-rose-500 hover:to-red-600 disabled:opacity-50 disabled:hover:scale-100",disabled:t.disabled,onClick:o[1]||(o[1]=a=>t.$emit("add-negative"))},p(t.negativeLabel),9,Js)]))}}),tn=Object.assign(en,{__name:"GroupingGroupActionButtons"}),sn={class:"card bg-base-100 shadow-sm"},nn={class:"card-body p-4"},on={key:0,class:"flex flex-col gap-3"},ln={key:0,class:"flex flex-wrap items-center gap-2"},an={class:"badge badge-info gap-2"},rn={class:"form-control mr-2"},un=["value","min","max"],dn={class:"ml-auto flex gap-2"},cn=["disabled"],pn={key:1,class:"flex flex-col lg:flex-row items-start lg:items-center gap-2 lg:gap-3"},vn={class:"flex items-center gap-2 text-sm text-base-content/70 flex-wrap"},mn={class:"badge badge-outline gap-1 shrink-0",title:"Â¶ÇÈúÄË™øÊï¥Ë´ãÈªûÊìä„ÄåÁ∑®ËºØÁµÑÂà•„Äç"},bn=["value"],gn={class:"ml-0 lg:ml-auto flex items-center gap-2 w-full lg:w-auto flex-wrap lg:flex-nowrap justify-end"},fn=["disabled","title"],hn=["disabled"],wn={key:1,class:"flex flex-wrap gap-x-4 gap-y-2 items-center justify-between"},yn={class:"flex items-center gap-3 flex-wrap"},Sn={class:"flex items-center gap-2 text-info font-semibold"},xn=["value"],Cn={class:"flex items-center gap-2"},$n=["disabled","title"],In=["disabled"],kn=te({__name:"GroupingControlPanel",props:{groupingActive:{type:Boolean},isGroupEditMode:{type:Boolean},groupCountInput:{},groupCountMin:{},groupCountMax:{},localGroupsLength:{},activityName:{},hasStudentsInGroups:{type:Boolean},rewardEnabled:{type:Boolean},groupsCollapsed:{type:Boolean}},emits:["update:groupCountInput","commitGroupCount","buildGroupsForCount","randomAssignGroups","resetAllGroups","openRewardInfoModal","saveGroupEdits","cancelGroupEdits","update:activityName","expandAllGroups","collapseAllGroups","toggleGroupsCollapsed","startGroupEditing","startGrouping","exportActivityReport","showGroupScoreboard","endGrouping"],setup(R){return(t,o)=>(u(),d("div",sn,[e("div",nn,[t.groupingActive?(u(),d("div",wn,[e("div",yn,[e("span",Sn,[m(I,{name:"CircleDot",class:"w-5 h-5 animate-pulse"}),o[30]||(o[30]=e("span",null,"ÂàÜÁµÑÈÄ≤Ë°å‰∏≠",-1))]),e("input",{value:t.activityName,type:"text",placeholder:"Ë´ãËº∏ÂÖ•Ê¥ªÂãïÂêçÁ®±...",class:"input input-sm input-bordered w-52",onInput:o[13]||(o[13]=a=>t.$emit("update:activityName",a.target.value))},null,40,xn)]),e("div",Cn,[t.rewardEnabled?(u(),d("button",{key:0,onClick:o[14]||(o[14]=a=>t.$emit("openRewardInfoModal")),class:"btn btn-sm btn-info gap-1",type:"button"},[m(I,{name:"Sparkles",class:"w-4 h-4"}),o[31]||(o[31]=h("ÁçéÂãµË™™Êòé ",-1))])):C("",!0),e("button",{onClick:o[15]||(o[15]=a=>t.$emit("toggleGroupsCollapsed")),class:"btn btn-sm btn-outline gap-1",disabled:t.localGroupsLength===0,title:t.groupsCollapsed?"Â±ïÈñãÊâÄÊúâÁµÑÂì°":"Êî∂ÂêàÊâÄÊúâÁµÑÂì°"},[m(I,{name:t.groupsCollapsed?"ChevronDown":"ChevronUp",class:"w-4 h-4"},null,8,["name"]),h(" "+p(t.groupsCollapsed?"Â±ïÈñãÁµÑÂì°":"Êî∂ÂêàÁµÑÂì°"),1)],8,$n),e("button",{onClick:o[16]||(o[16]=a=>t.$emit("exportActivityReport",!1)),class:"btn btn-sm btn-info gap-1",disabled:!t.activityName.trim(),title:"ÂåØÂá∫Ê¥ªÂãïÂ†±Âëä"},[m(I,{name:"Download",class:"w-4 h-4"}),o[32]||(o[32]=h(" ÂåØÂá∫ ",-1))],8,In),e("button",{onClick:o[17]||(o[17]=a=>t.$emit("showGroupScoreboard")),class:"btn btn-sm btn-warning gap-1",title:"È°ØÁ§∫Á©çÂàÜÂÑÄË°®Êùø"},[m(I,{name:"Trophy",class:"w-4 h-4"}),o[33]||(o[33]=h(" ÂÑÄË°®Êùø ",-1))]),e("button",{onClick:o[18]||(o[18]=a=>t.$emit("endGrouping")),class:"btn btn-sm btn-error gap-1"},[m(I,{name:"Square",class:"w-4 h-4"}),o[34]||(o[34]=h(" ÁµêÊùüÂàÜÁµÑ ",-1))])])])):(u(),d("div",on,[t.isGroupEditMode?(u(),d("div",ln,[e("span",an,[m(I,{name:"Pencil",class:"w-3 h-3"}),o[19]||(o[19]=h("Á∑®ËºØÊ®°Âºè‰∏≠ ",-1))]),e("div",rn,[o[20]||(o[20]=e("label",{class:"label py-1 mr-1"},[e("span",{class:"label-text"},"ÁµÑÊï∏")],-1)),e("input",{value:t.groupCountInput,type:"number",min:t.groupCountMin,max:t.groupCountMax,class:"input input-bordered w-20",onInput:o[0]||(o[0]=a=>t.$emit("update:groupCountInput",a.target.value)),onBlur:o[1]||(o[1]=a=>t.$emit("commitGroupCount")),onKeyup:o[2]||(o[2]=ws(a=>t.$emit("commitGroupCount"),["enter"]))},null,40,un)]),e("button",{onClick:o[3]||(o[3]=a=>t.$emit("buildGroupsForCount")),class:"btn btn-outline"},[m(I,{name:"PlusCircle",class:"w-4 h-4 mr-2"}),o[21]||(o[21]=h("Âª∫Á´ãÁµÑÂà• ",-1))]),e("button",{onClick:o[4]||(o[4]=a=>t.$emit("randomAssignGroups")),class:"btn btn-primary"},[m(I,{name:"Shuffle",class:"w-4 h-4 mr-2"}),o[22]||(o[22]=h("‰∏ÄÈçµÈö®Ê©üÂàÜÁµÑ ",-1))]),e("button",{onClick:o[5]||(o[5]=a=>t.$emit("resetAllGroups")),class:"btn btn-ghost"},[m(I,{name:"Undo2",class:"w-4 h-4 mr-2"}),o[23]||(o[23]=h("‰∏ÄÈçµÈÇÑÂéü ",-1))]),e("div",dn,[e("button",{onClick:o[6]||(o[6]=a=>t.$emit("saveGroupEdits")),class:"btn btn-success",disabled:t.localGroupsLength===0},[m(I,{name:"Save",class:"w-4 h-4 mr-2"}),o[24]||(o[24]=h("ÂÑ≤Â≠òÁµÑÂà•Á∑®ËºØ ",-1))],8,cn),e("button",{onClick:o[7]||(o[7]=a=>t.$emit("cancelGroupEdits")),class:"btn btn-ghost"}," ÂèñÊ∂à ")])])):(u(),d("div",pn,[e("div",vn,[e("span",mn,[m(I,{name:"Lock",class:"w-4 h-4"}),o[25]||(o[25]=h("ÈéñÂÆö ",-1))]),o[26]||(o[26]=e("span",{class:"shrink-0"},"Ê¥ªÂãïÂêçÁ®± (ÈÅ∏Â°´)",-1)),e("input",{value:t.activityName,type:"text",placeholder:"‰æãÂ¶ÇÔºöÁ¨¨‰∫åÊ¨°ÂàÜÁµÑË®éË´ñ",class:"input input-bordered input-sm lg:input-md w-full lg:w-60",onInput:o[8]||(o[8]=a=>t.$emit("update:activityName",a.target.value))},null,40,bn)]),e("div",gn,[t.rewardEnabled?(u(),d("button",{key:0,onClick:o[9]||(o[9]=a=>t.$emit("openRewardInfoModal")),class:"btn btn-sm btn-info gap-1",type:"button"},[m(I,{name:"Sparkles",class:"w-4 h-4"}),o[27]||(o[27]=h(" ÁçéÂãµË™™Êòé ",-1))])):C("",!0),e("button",{onClick:o[10]||(o[10]=a=>t.$emit("toggleGroupsCollapsed")),class:"btn btn-sm btn-outline gap-1",disabled:t.localGroupsLength===0,title:t.groupsCollapsed?"Â±ïÈñãÊâÄÊúâÁµÑÂì°":"Êî∂ÂêàÊâÄÊúâÁµÑÂì°"},[m(I,{name:t.groupsCollapsed?"ChevronDown":"ChevronUp",class:"w-4 h-4"},null,8,["name"]),h(" "+p(t.groupsCollapsed?"Â±ïÈñãÁµÑÂì°":"Êî∂ÂêàÁµÑÂì°"),1)],8,fn),e("button",{onClick:o[11]||(o[11]=a=>t.$emit("startGroupEditing")),class:"btn btn-outline"},[m(I,{name:"SquarePen",class:"w-4 h-4 mr-2"}),o[28]||(o[28]=h("Á∑®ËºØÁµÑÂà• ",-1))]),e("button",{onClick:o[12]||(o[12]=a=>t.$emit("startGrouping")),class:"btn btn-success gap-2",disabled:t.localGroupsLength===0||!t.hasStudentsInGroups},[m(I,{name:"Play",class:"w-4 h-4"}),o[29]||(o[29]=h("ÈñãÂßãÂàÜÁµÑÊ¥ªÂãï ",-1))],8,hn)])]))]))])]))}}),Gn=Object.assign(kn,{__name:"GroupingControlPanel"}),Tn={class:"card bg-base-100 shadow-sm h-full flex flex-col"},_n={class:"card-body flex flex-col h-full p-4"},Mn={class:"flex items-center justify-between mb-4"},An={key:0,class:"card-title text-base flex items-center whitespace-nowrap"},Dn={class:"badge badge-neutral ml-2"},Pn=["title"],En={class:"sticky top-0 bg-base-100 pb-2 z-10"},Bn={class:"input input-bordered input-sm flex items-center gap-2"},Un=["value"],jn={class:"mt-3 flex items-center justify-between text-xs text-base-content/70"},Rn=["disabled"],Nn=["draggable","onDragstart"],Ln={class:"flex items-start gap-3 flex-1"},On=["checked","onClick"],Fn={class:"font-medium"},zn={class:"text-sm text-base-content/70"},Vn={class:"text-sm font-semibold text-primary"},Wn={key:0,class:"text-center text-base-content/50 py-8"},qn={key:1,class:"flex justify-center items-center h-full"},Hn={class:"flex items-center justify-between mb-4"},Qn={key:0,class:"card-title text-base flex items-center whitespace-nowrap"},Yn=["title"],Kn={key:0,class:"flex-1 overflow-y-auto"},Xn={class:"flex items-center gap-3 min-w-0 flex-1"},Zn={class:"flex flex-col flex-1 min-w-0"},Jn={class:"font-semibold text-sm truncate"},eo={class:"flex items-center gap-2 shrink-0"},to={key:0,class:"badge badge-sm gap-1 bg-amber-100 text-amber-600 border border-amber-200"},so={class:"font-semibold text-xs"},no={key:1,class:"text-right"},oo={class:"text-lg font-bold text-primary"},lo={key:1,class:"flex justify-center items-center h-full"},ao=te({__name:"GroupingSidebar",props:{collapsed:{type:Boolean},groupingActive:{type:Boolean},ungroupedSearch:{},ungroupedCount:{},filteredUngroupedStudents:{},selectedStudentIds:{},canModifyGroups:{type:Boolean},leaderboardGroups:{},groupStarCounts:{},showRewardStars:{type:Boolean},showGroupTotalScores:{type:Boolean}},emits:["toggle-collapse","update:ungroupedSearch","clear-selection","drag-start","drag-end","toggle-student-selection","unassigned-drop"],setup(R){return(t,o)=>(u(),d("aside",{class:D(["transition-all duration-300 flex-shrink-0",t.collapsed?"w-20":"w-80"])},[e("div",Tn,[e("div",_n,[t.groupingActive?(u(),d(O,{key:1},[e("div",Hn,[t.collapsed?C("",!0):(u(),d("h3",Qn,[m(I,{name:"Trophy",class:"w-5 h-5 mr-2"}),o[10]||(o[10]=h(" Âç≥ÊôÇÁ©çÂàÜÊ¶ú ",-1))])),e("button",{onClick:o[8]||(o[8]=a=>t.$emit("toggle-collapse",!t.collapsed)),class:"btn btn-ghost btn-sm btn-circle ml-auto",title:t.collapsed?"Â±ïÈñã":"Êî∂Âêà"},[m(I,{name:t.collapsed?"ChevronsRight":"ChevronsLeft",class:"w-4 h-4"},null,8,["name"])],8,Yn)]),t.collapsed?C("",!0):(u(),d("div",Kn,[m(ys,{name:"leaderboard",tag:"div",class:"space-y-2"},{default:Be(()=>[(u(!0),d(O,null,pe(t.leaderboardGroups,(a,w)=>(u(),d("div",{key:a.id,class:D(["p-3 rounded-lg flex items-center justify-between gap-3 transition-all",w===0?"bg-amber-100 border-2 border-amber-400":"bg-base-200"])},[e("div",Xn,[e("div",{class:D(["text-lg font-bold w-6 text-center shrink-0",{"text-amber-500":w===0,"text-slate-400":w>2}])},p(w+1),3),e("div",{class:"w-4 h-4 rounded-full shrink-0",style:le({backgroundColor:a.color})},null,4),e("div",Zn,[e("div",Jn,p(a.name),1)])]),e("div",eo,[t.showGroupTotalScores&&t.showRewardStars?(u(),d("div",to,[m(I,{name:"Star",class:"w-3.5 h-3.5"}),e("span",so,p(t.groupStarCounts[a.id]??0),1)])):C("",!0),t.showGroupTotalScores?(u(),d("div",no,[e("div",oo,p(a.totalScore),1)])):C("",!0)])],2))),128))]),_:1})])),t.collapsed?(u(),d("div",lo,[m(I,{name:"Trophy",class:"w-8 h-8 text-base-content/30"})])):C("",!0)],64)):(u(),d(O,{key:0},[e("div",Mn,[t.collapsed?C("",!0):(u(),d("h3",An,[m(I,{name:"Users",class:"w-5 h-5 mr-2"}),o[9]||(o[9]=h(" Êú™ÂàÜÁµÑÂ≠∏Áîü ",-1)),e("span",Dn,p(t.ungroupedCount)+" ‰∫∫",1)])),e("button",{onClick:o[0]||(o[0]=a=>t.$emit("toggle-collapse",!t.collapsed)),class:"btn btn-ghost btn-sm btn-circle ml-auto",title:t.collapsed?"Â±ïÈñã":"Êî∂Âêà"},[m(I,{name:t.collapsed?"ChevronsRight":"ChevronsLeft",class:"w-4 h-4"},null,8,["name"])],8,Pn)]),t.collapsed?C("",!0):(u(),d("div",{key:0,class:"flex-1 overflow-y-auto space-y-3 p-1",onDrop:o[5]||(o[5]=a=>t.$emit("unassigned-drop",a)),onDragover:o[6]||(o[6]=ce(()=>{},["prevent"])),onDragenter:o[7]||(o[7]=ce(()=>{},["prevent"]))},[e("div",En,[e("label",Bn,[m(I,{name:"Search",class:"w-4 h-4 text-base-content/60"}),e("input",{value:t.ungroupedSearch,type:"text",class:"grow",placeholder:"ÊêúÂ∞ãÂßìÂêçÊàñÂ∫ßËôü",onInput:o[1]||(o[1]=a=>t.$emit("update:ungroupedSearch",a.target.value))},null,40,Un),t.ungroupedSearch?(u(),d("button",{key:0,type:"button",class:"btn btn-xs btn-ghost",onClick:o[2]||(o[2]=a=>t.$emit("update:ungroupedSearch",""))}," Ê∏ÖÈô§ ")):C("",!0)]),e("div",jn,[e("span",null,"Â∑≤ÈÅ∏ "+p(t.selectedStudentIds.length)+" ‰∫∫",1),e("button",{type:"button",class:"btn btn-ghost btn-xs",disabled:t.selectedStudentIds.length===0,onClick:o[3]||(o[3]=a=>t.$emit("clear-selection"))}," Ê∏ÖÈô§ÈÅ∏Âèñ ",8,Rn)])]),(u(!0),d(O,null,pe(t.filteredUngroupedStudents,a=>(u(),d("div",{key:a.id,class:D(["p-3 bg-base-200 rounded-lg cursor-move hover:bg-base-300 transition-colors","flex justify-between items-center gap-3",t.selectedStudentIds.includes(a.id)&&t.canModifyGroups?"ring-2 ring-primary ring-offset-2":"","mt-2"]),draggable:t.canModifyGroups,onDragstart:w=>t.$emit("drag-start",a.id,"unassigned",w),onDragend:o[4]||(o[4]=w=>t.$emit("drag-end",w))},[e("div",Ln,[t.canModifyGroups?(u(),d("input",{key:0,type:"checkbox",class:"checkbox checkbox-sm mt-1",checked:t.selectedStudentIds.includes(a.id),onClick:ce(w=>t.$emit("toggle-student-selection",a.id),["stop"])},null,8,On)):C("",!0),e("div",Fn,p(a.name),1),e("div",zn," Â∫ßËôü "+p(a.id),1)]),e("div",Vn,p(a.totalScore)+"ÂàÜ ",1)],42,Nn))),128)),t.filteredUngroupedStudents.length===0?(u(),d("div",Wn," ÊâÄÊúâÂ≠∏ÁîüÈÉΩÂ∑≤ÂàÜÁµÑ ")):C("",!0)],32)),t.collapsed?(u(),d("div",qn,[m(I,{name:"Users",class:"w-8 h-8 text-base-content/30"})])):C("",!0)],64))])])],2))}}),io=Object.assign(ao,{__name:"GroupingSidebar"}),ro={key:0,class:"invincible-burst-layer"},uo={key:1,class:"invincible-rings-layer"},co={key:0,class:"milestone-floating"},po={class:"milestone-message"},vo=te({__name:"GroupCard",props:{compact:{type:Boolean},isInvincible:{type:Boolean},invincibleBurst:{type:Boolean},invincibleHighlight:{type:Boolean},milestoneMessage:{}},setup(R){return(t,o)=>(u(),d("div",Ss(t.$attrs,{class:["card bg-base-100 shadow-sm transition-all duration-300 relative",t.isInvincible?"invincible-glow":"",t.invincibleHighlight?"invincible-activate-scale":""]}),[t.invincibleBurst?(u(),d("div",ro,[...o[0]||(o[0]=[xs('<span class="burst-star" data-v-c5107c19>‚≠ê</span><span class="burst-star" data-v-c5107c19>‚≠ê</span><span class="burst-star" data-v-c5107c19>‚≠ê</span><span class="burst-star" data-v-c5107c19>‚≠ê</span><span class="burst-star" data-v-c5107c19>‚≠ê</span><span class="burst-star" data-v-c5107c19>‚≠ê</span>',6)])])):C("",!0),t.invincibleHighlight?(u(),d("div",uo)):C("",!0),e("div",{class:D(["card-body flex flex-col gap-2 relative overflow-visible",t.compact?"p-2":"p-3"])},[t.milestoneMessage?(u(),d("div",co,[e("span",po,p(t.milestoneMessage),1)])):C("",!0),Cs(t.$slots,"default",{},void 0)],2)],16))}}),mo=Object.assign(we(vo,[["__scopeId","data-v-c5107c19"]]),{__name:"GroupingGroupCard"}),bo=["draggable","onDragstart","onDragover","onDrop"],go={key:0,class:"px-3 py-2 flex flex-col gap-1"},fo={class:"text-xs text-base-content/70"},ho={class:"font-medium text-sm"},wo={key:1,class:"p-2 flex flex-col gap-2"},yo={class:"flex justify-between items-center"},So={class:"font-medium text-sm flex items-center"},xo={key:0,class:"ml-2 px-2 py-0.5 rounded bg-gray-300 text-xs text-gray-600"},Co={class:"text-xs text-base-content/70"},$o={class:"flex justify-end items-center gap-2"},Io={key:0,class:"flex items-center gap-1 text-xs"},ko={class:"opacity-60"},Go={key:1,class:"flex gap-1"},To=["onClick"],_o=["onClick"],Mo=te({__name:"GroupMembersList",props:{groupId:{},members:{},isEditMode:{type:Boolean},canModify:{type:Boolean},groupingActive:{type:Boolean},showIndividualScores:{type:Boolean},allowIndividualScoring:{type:Boolean},baseScores:{},sessionScores:{},studentScoreAnimation:{},dropIndicator:{}},emits:["drag-start","drag-end","member-drag-over","member-drop","add-individual-score"],setup(R){const t=R,o=(a,w)=>["rounded transition-all",t.canModify?"cursor-move border border-base-200 bg-base-100":a.isPresent?"bg-base-200":"bg-gray-200 text-gray-400 opacity-60",t.dropIndicator?.groupId===t.groupId&&t.dropIndicator.index===w?"ring-2 ring-primary ring-offset-2":"",!t.canModify&&a.isPresent?"hover:bg-base-300":""];return(a,w)=>(u(),d("div",{class:D(["flex-1",a.isEditMode?"grid grid-cols-1 md:grid-cols-2 gap-2":"flex flex-col gap-2"])},[(u(!0),d(O,null,pe(a.members,($,b)=>(u(),d("div",{key:$.id,class:D(o($,b)),draggable:a.canModify,onDragstart:P=>a.$emit("drag-start",$.id,a.groupId,P),onDragend:w[0]||(w[0]=P=>a.$emit("drag-end")),onDragover:ce(P=>a.$emit("member-drag-over",a.groupId,b,P),["prevent"]),onDrop:ce(P=>a.$emit("member-drop",a.groupId,b),["stop"])},[a.isEditMode?(u(),d("div",go,[e("div",fo,"Â∫ßËôü "+p($.id),1),e("div",ho,p($.name),1)])):(u(),d("div",wo,[e("div",yo,[e("div",So,[h(p($.name)+" ",1),$.isPresent?C("",!0):(u(),d("span",xo," ‰ªäÊó•Áº∫Â∏≠ "))]),e("div",Co,"Â∫ßËôü "+p($.id),1)]),e("div",$o,[a.groupingActive?(u(),d(O,{key:0},[a.showIndividualScores?(u(),d("div",Io,[e("span",ko,p(a.baseScores[$.id]??""),1),w[1]||(w[1]=e("span",{class:"opacity-60"},"ÂàÜ",-1)),m(I,{name:"ArrowRight",class:"w-3 h-3 text-success"}),e("span",{class:D(["text-success font-bold",a.studentScoreAnimation?.[$.id]??""])},p((a.baseScores[$.id]??0)+(a.sessionScores[$.id]??0)),3),w[2]||(w[2]=e("span",{class:"text-success"},"ÂàÜ",-1))])):C("",!0),a.allowIndividualScoring?(u(),d("div",Go,[e("button",{class:"btn btn-xs btn-circle btn-outline btn-success",title:"ÂÄã‰∫∫Âä†ÂàÜ",onClick:P=>a.$emit("add-individual-score",$.id,1)}," + ",8,To),e("button",{class:"btn btn-xs btn-circle btn-outline btn-error",title:"ÂÄã‰∫∫Êâ£ÂàÜ",onClick:P=>a.$emit("add-individual-score",$.id,-1)}," - ",8,_o)])):C("",!0)],64)):(u(),d(O,{key:1},[h(p($.totalScore)+"ÂàÜ ",1)],64))])]))],42,bo))),128))],2))}}),Ao=Object.assign(Mo,{__name:"GroupingGroupMembersList"}),Do={key:0,class:"celebration-overlay",role:"status","aria-live":"assertive"},Po={class:"celebration-content"},Eo={class:"headline"},Bo={class:"details"},Uo={class:"particle-layer"},jo=te({__name:"InvincibleCelebration",props:{visible:{type:Boolean},groupName:{},duration:{},pointsPerClick:{}},emits:["close"],setup(R){return(t,o)=>(u(),ge(yt,{to:"body"},[m(St,{name:"celebration-fade"},{default:Be(()=>[t.visible?(u(),d("div",Do,[o[7]||(o[7]=e("div",{class:"celebration-backdrop"},null,-1)),e("div",Po,[o[4]||(o[4]=e("div",{class:"glow-ring"},null,-1)),o[5]||(o[5]=e("div",{class:"star-stack"},[e("span",{class:"star-icon"},"‚òÖ"),e("span",{class:"star-shadow"},"‚òÖ")],-1)),o[6]||(o[6]=e("p",{class:"subtitle"},"Invincible Mode Activated",-1)),e("h2",Eo,p(t.groupName)+" ÈÄ≤ÂÖ•ÁÑ°ÊïµÊòüÊòüÔºÅ",1),e("p",Bo,[o[1]||(o[1]=h(" Êé•‰∏ã‰æÜ ",-1)),e("strong",null,p(t.duration),1),o[2]||(o[2]=h(" ÁßíÊØèÊ¨°Âä†ÂàÜ = ",-1)),e("strong",null,"+"+p(t.pointsPerClick),1),o[3]||(o[3]=h(" ÂàÜ ",-1))]),e("button",{class:"dismiss-btn",type:"button",onClick:o[0]||(o[0]=a=>t.$emit("close"))}," Êî∂Âà∞ÔºÅ ")]),e("div",Uo,[(u(),d(O,null,pe(14,a=>e("span",{key:a,class:D(["particle",`particle-${a}`])},null,2)),64))])])):C("",!0)]),_:1})]))}}),Ro=Object.assign(we(jo,[["__scopeId","data-v-3651f807"]]),{__name:"GroupingInvincibleCelebration"}),No={class:"h-full px-3 sm:px-6 flex items-center justify-between gap-2 sm:gap-4"},Lo={class:"flex items-center gap-2 sm:gap-3"},Oo={class:"text-xl sm:text-2xl font-black text-white tabular-nums"},Fo={class:"text-base sm:text-lg font-semibold text-white/90"},zo={class:"flex-1 max-w-md h-2 bg-white/30 rounded-full overflow-hidden"},Vo={class:"flex items-center gap-1 sm:gap-2 text-white/90"},Wo={class:"text-xs sm:text-sm font-semibold whitespace-nowrap"},qo={class:"text-white font-bold"},Ho={class:"flex items-center gap-2 sm:gap-4"},Qo={class:"flex items-center gap-1"},Yo={class:"flex-1 max-w-xs h-3 bg-white/30 rounded-full overflow-hidden"},Ko={class:"flex items-center gap-2 sm:gap-4"},Xo={class:"px-2 sm:px-4 py-1 bg-white/20 rounded-full"},Zo={class:"text-xs sm:text-sm font-bold text-white whitespace-nowrap"},Jo={class:"text-base sm:text-xl"},el={class:"text-xs sm:text-sm font-semibold text-white whitespace-nowrap hidden sm:inline"},tl=te({__name:"ClassTotalBottomBar",props:{currentTotal:{},pointsPerInvincible:{},triggerCount:{},isInvincible:{type:Boolean},invincibleSecondsRemaining:{},invinciblePoints:{},invincibleDurationSeconds:{}},setup(R){const t=R,o=x(()=>(t.triggerCount+1)*t.pointsPerInvincible),a=x(()=>{const g=t.currentTotal%t.pointsPerInvincible/t.pointsPerInvincible*100;return Math.min(100,Math.max(0,g))}),w=x(()=>Math.max(0,o.value-t.currentTotal)),$=x(()=>t.invincibleSecondsRemaining?He(t.invincibleSecondsRemaining):"00:00"),b=x(()=>t.isInvincible&&(t.invincibleSecondsRemaining??0)<=10),P=x(()=>{if(!t.isInvincible||!t.invincibleDurationSeconds||t.invincibleDurationSeconds<=0)return 0;const S=t.invincibleDurationSeconds,z=(t.invincibleSecondsRemaining??0)/S*100;return Math.min(100,Math.max(0,z))});return(S,g)=>(u(),d("div",{class:D(["fixed bottom-0 left-16 right-0 z-40 transition-all duration-300",[S.isInvincible?"h-14 bg-gradient-to-r from-red-500/95 via-orange-500/95 to-yellow-400/95 border-t-2 border-yellow-300":"h-12 sm:h-14 bg-gradient-to-r from-yellow-400/90 via-orange-400/90 to-orange-500/90 border-t-2 border-yellow-500/50",S.isInvincible&&"animate-pulse-glow"]]),style:{"backdrop-filter":"blur(8px)"}},[e("div",No,[S.isInvincible?(u(),d(O,{key:1},[e("div",Ho,[g[7]||(g[7]=e("div",{class:"flex items-center gap-1 sm:gap-2"},[e("span",{class:"text-lg sm:text-xl animate-spin-slow"},"üåü"),e("span",{class:"font-bold text-white text-sm sm:text-base"},"ÁÑ°ÊïµÊ®°Âºè")],-1)),e("div",Qo,[e("span",{class:D(["text-xl sm:text-2xl font-black text-white tabular-nums",{"text-red-200 animate-pulse":b.value}])},p($.value),3)])]),e("div",Yo,[e("div",{class:"h-full bg-white transition-all duration-300 ease-linear",style:le({width:P.value+"%"})},null,4)]),e("div",Ko,[e("div",Xo,[e("span",Zo,[g[8]||(g[8]=h(" ÊØèÊ¨° ",-1)),e("span",Jo,"+"+p(S.invinciblePoints),1),g[9]||(g[9]=h(" ÂàÜ ",-1))])]),e("span",el,p(S.currentTotal)+"/"+p(o.value),1)])],64)):(u(),d(O,{key:0},[e("div",Lo,[g[0]||(g[0]=e("span",{class:"text-base sm:text-lg"},"üìä",-1)),g[1]||(g[1]=e("span",{class:"font-bold text-white text-sm sm:text-base hidden sm:inline"},"ÂÖ®Áè≠",-1)),e("span",Oo,p(S.currentTotal),1),g[2]||(g[2]=e("span",{class:"text-white/70 text-sm sm:text-base"},"/",-1)),e("span",Fo,p(o.value),1),g[3]||(g[3]=e("span",{class:"text-white/70 text-sm sm:text-base"},"ÂàÜ",-1))]),e("div",zo,[e("div",{class:"h-full bg-white transition-all duration-500 ease-out",style:le({width:a.value+"%"})},null,4)]),e("div",Vo,[g[6]||(g[6]=e("span",{class:"text-xs sm:text-sm"},"üí°",-1)),e("span",Wo,[g[4]||(g[4]=h(" ÈÇÑÂ∑Æ ",-1)),e("span",qo,p(w.value),1),g[5]||(g[5]=h(" ÂàÜ ",-1))])])],64))])],2))}}),sl=Object.assign(we(tl,[["__scopeId","data-v-99ed59b7"]]),{__name:"GroupingClassTotalBottomBar"}),nl={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-yellow-400 via-orange-500 to-red-500 overflow-hidden"},ol={class:"absolute inset-0 pointer-events-none z-0"},ll={class:"absolute inset-0 pointer-events-none z-0"},al={class:"relative z-10 text-center px-4"},il={class:"text-2xl sm:text-4xl font-bold text-white/90 mb-4 sm:mb-8 animate-fade-in-up"},rl={key:0,class:"text-base sm:text-xl text-white/80 animate-fade-in-delayed"},ul={class:"font-black text-white tabular-nums mx-1"},dl=3200,cl=te({__name:"ClassInvincibleBurstCelebration",props:{visible:{type:Boolean},achievedScore:{},duration:{},showCountdown:{type:Boolean},countdownSeconds:{}},emits:["close"],setup(R,{emit:t}){const o=R,a=t,w=x(()=>window.innerWidth<1024),$=x(()=>w.value?10:20),b=x(()=>w.value?15:30),P=x(()=>typeof o.countdownSeconds=="number"&&o.countdownSeconds>0?He(o.countdownSeconds):null),S=x(()=>{const E=o.duration||0;return E>0?`ÁÑ°ÊïµÊ®°ÂºèÊåÅÁ∫å ${E} Áßí`:""});let g=null;const z=()=>{g&&(clearTimeout(g),g=null)},ve=()=>{z(),g=setTimeout(()=>{a("close")},dl)},ye=()=>{a("close")},Se=E=>{const T=360/$.value*E,M=45+Math.random()*20;return{left:"50%",top:"50%",transform:`translate(-50%, -50%) rotate(${T}deg) translateY(-${M}vh)`,animationDelay:`${Math.random()*.3}s`}},xe=E=>{const T=Math.PI*2*E/30,M=35+Math.random()*15,be=50+Math.cos(T)*M,f=50+Math.sin(T)*M;return{left:`${Math.max(0,Math.min(100,be))}%`,top:`${Math.max(0,Math.min(100,f))}%`,animationDelay:`${Math.random()*.5}s`,fontSize:`${1+Math.random()*2}rem`}},Ce=()=>{try{const E=new Audio("/super-star.mp3");E.volume=.65,E.play().catch(()=>{})}catch{}};let Q=!1;const me=()=>{o.visible&&!Q?(Ce(),Q=!0):o.visible||(Q=!1)};return $s(()=>{o.visible&&(me(),ve())}),ee(()=>o.visible,E=>{E?(me(),ve()):(z(),Q=!1)},{immediate:!0}),Qe(()=>{z(),Q=!1}),(E,T)=>(u(),ge(yt,{to:"body"},[m(St,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 scale-50 translate-y-full","enter-to-class":"opacity-100 scale-100 translate-y-0","leave-active-class":"transition-all duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:Be(()=>[E.visible?(u(),d("div",nl,[e("button",{type:"button",class:"absolute top-4 right-4 sm:top-6 sm:right-6 text-white/70 hover:text-white transition-colors","aria-label":"ÈóúÈñâÊÖ∂Á•ùÁï´Èù¢",onClick:ye},[m(I,{name:"X",class:"w-6 h-6"})]),e("div",ol,[(u(!0),d(O,null,pe($.value,M=>(u(),d("div",{key:M,class:"firework-particle",style:le(Se(M))},null,4))),128))]),e("div",ll,[(u(!0),d(O,null,pe(b.value,M=>(u(),d("div",{key:"star-"+M,class:"star-burst",style:le(xe(M))}," ‚≠ê ",4))),128))]),e("div",al,[T[1]||(T[1]=e("h1",{class:"text-5xl sm:text-7xl font-black text-white mb-4 sm:mb-6 drop-shadow-2xl animate-bounce-in"}," üåüüåüüåü ",-1)),T[2]||(T[2]=e("h2",{class:"text-4xl sm:text-6xl font-black text-white mb-3 sm:mb-4 drop-shadow-2xl animate-scale-pulse"}," ÂÖ®Áè≠ÁÑ°ÊïµÊòüÊòü ",-1)),e("div",il," ÈÅîÊàê "+p(E.achievedScore)+" ÂàÜÔºÅ ",1),E.showCountdown&&(P.value||S.value)?(u(),d("div",rl,[P.value?(u(),d(O,{key:0},[T[0]||(T[0]=h(" ÁÑ°ÊïµÊ®°ÂºèÂâ©È§ò ",-1)),e("span",ul,p(P.value),1)],64)):(u(),d(O,{key:1},[h(p(S.value),1)],64))])):C("",!0)])])):C("",!0)]),_:1})]))}}),pl=Object.assign(we(cl,[["__scopeId","data-v-ff91ad11"]]),{__name:"GroupingClassInvincibleBurstCelebration"}),vl=({activeRewardSettings:R,timers:t,uiNotifier:o})=>{const a=k({}),w=k({}),$=k({}),b=k({}),P=k({}),S=k({}),g=new Map,z=new Map,ve=i=>{g.has(i)&&(clearTimeout(g.get(i)),g.delete(i)),b.value[i]=null},ye=(i,v)=>{b.value[i]={message:v},g.has(i)&&clearTimeout(g.get(i)),g.set(i,setTimeout(()=>{b.value[i]=null,g.delete(i)},1800))},Se=i=>{const v="animate-star-pop";a.value[i]=v,setTimeout(()=>{a.value[i]===v&&(a.value[i]=null)},600)},xe=i=>{const v="animate-invincible-burst";a.value[i.id]=v,setTimeout(()=>{a.value[i.id]===v&&(a.value[i.id]=null)},800),w.value[i.id]=!0,setTimeout(()=>{w.value[i.id]=!1},900),$.value[i.id]=!0,z.has(i.id)&&clearTimeout(z.get(i.id)),z.set(i.id,setTimeout(()=>{$.value[i.id]=!1,z.delete(i.id)},1e3));const U=R.value;if(o.triggerInvincibleCelebration)o.triggerInvincibleCelebration({group:i,settings:U??null});else{const K=U?.enabled?`üéâ ${i.name} ÈÄ≤ÂÖ•ÁÑ°ÊïµÊòüÊòüÊ®°ÂºèÔºÅÊé•‰∏ã‰æÜ ${U.invincibleDurationSeconds} ÁßíÊØèÊ¨° +${U.invinciblePointsPerClick} ÂàÜÔºåÂø´ÊääÊè°Ê©üÊúÉÔºÅ`:`üéâ ${i.name} ÈÄ≤ÂÖ•ÁÑ°ÊïµÊòüÊòüÊ®°ÂºèÔºÅ`;o.showToast(K,"success",6e3)}},Ce=i=>typeof i.totalCollectedStars=="number"?i.totalCollectedStars:i.stars||0,Q=i=>{const v=R.value;if(!v?.enabled||!v.starsToInvincible)return 0;const U=i.stars||0;return Math.max(0,Math.min(1,U/v.starsToInvincible))},me=i=>Array.isArray(i.milestoneMessages)&&i.milestoneMessages.length>0?[...i.milestoneMessages].sort((v,U)=>v.threshold-U.threshold):Is(i.starsToInvincible),E=i=>{const v=R.value;if(!v?.enabled||!v.starsToInvincible)return null;const U=i.stars||0;if(U<=0)return null;const K=me(v);let se=null;return K.forEach(F=>{U>=F.threshold&&(se=F)}),se?.message??null},T=i=>{const v=t.value[i];return typeof v=="number"&&v<=10},M=i=>(i.totalCollectedStars==null&&(i.totalCollectedStars=i.stars||0),i.invincibleStarQueue==null&&(i.invincibleStarQueue=0),i.invincibleUntil==null&&(i.invincibleUntil=null),i.isInvincible==null&&(i.isInvincible=!1),i.isInvincible&&i.invincibleUntil&&i.invincibleUntil<=Date.now()&&(i.isInvincible=!1,i.invincibleUntil=null),i),be=(i,v,U={})=>{const K=i.stars||0,se=P.value[i.id];if(typeof se!="number"&&K>0&&!U.skipMilestoneAnimation){const N=E(i);N&&(S.value[i.id]=N)}if(typeof se=="number"&&K>se){if(Se(i.id),!i.isInvincible)try{const H=new Audio("/star.mp3");H.volume=.7,H.play()}catch{}const N=E(i);N&&N!==S.value[i.id]&&!U.skipMilestoneAnimation&&(ye(i.id,N),S.value[i.id]=N)}!(v?.isInvincible??!1)&&i.isInvincible&&!U.skipMilestoneAnimation&&xe(i),v&&(v.stars||0)>K&&(S.value[i.id]=null,ve(i.id)),P.value[i.id]=K},f=i=>{Object.keys(a.value).forEach(v=>{i.has(v)||delete a.value[v]}),Object.keys(w.value).forEach(v=>{i.has(v)||delete w.value[v]}),Object.keys($.value).forEach(v=>{i.has(v)||delete $.value[v]}),Object.keys(b.value).forEach(v=>{i.has(v)||(ve(v),delete b.value[v])}),Object.keys(P.value).forEach(v=>{i.has(v)||delete P.value[v]}),Object.keys(S.value).forEach(v=>{i.has(v)||delete S.value[v]})},$e=()=>{g.forEach(i=>clearTimeout(i)),g.clear(),z.forEach(i=>clearTimeout(i)),z.clear()};return Qe(()=>{$e()}),ee(R,()=>{S.value={},Object.keys(b.value).forEach(i=>{b.value[i]=null})},{immediate:!0}),{starGainAnimation:a,invincibleBurstActive:w,invincibleHighlight:$,milestoneBubbles:b,getTotalStarsForDisplay:Ce,getStarProgress:Q,isCountdownCritical:T,trackGroupUpdate:be,prepareGroupData:M,cleanupForRemovedGroups:f,cleanupRewards:$e}},ml={class:"space-y-6 relative"},bl={key:0,class:"flex justify-between items-center gap-3"},gl={class:"flex items-center gap-3 truncate"},fl={class:"flex items-center gap-2 text-base font-semibold truncate"},hl={class:"truncate"},wl={class:"badge badge-ghost badge-sm"},yl={class:"dropdown dropdown-end"},Sl={tabindex:"0",role:"button",class:"btn btn-ghost btn-xs btn-circle"},xl={tabindex:"0",class:"dropdown-content menu bg-base-100 rounded-box z-[1] w-48 p-2 shadow"},Cl=["onClick"],$l=["onClick"],Il={class:"flex justify-between items-start"},kl={class:"flex items-center gap-2 text-base font-semibold"},Gl=["onDrop","onDragover","onDragenter"],Tl={key:0,class:"flex justify-end"},_l=["disabled","onClick"],Ml={class:"modal-box max-w-md space-y-4"},Al={class:"text-lg font-bold flex items-center gap-2"},Dl={key:0,class:"space-y-3 text-sm leading-relaxed"},Pl={class:"font-semibold"},El={class:"space-y-2"},Bl={class:"flex items-start gap-2"},Ul={class:"flex items-start gap-2"},jl={class:"font-semibold"},Rl={class:"space-y-2"},Nl={class:"flex items-start gap-2"},Ll={class:"flex items-start gap-2"},Ol={class:"flex items-start gap-2"},Fl={key:1,class:"text-sm text-base-content/70"},zl={class:"modal-box w-11/12 max-w-4xl py-6 sm:py-8 max-h-[90vh] overflow-y-auto my-4 sm:my-6"},Vl={class:"text-lg font-bold mb-4 flex items-center"},Wl={class:"space-y-4"},ql={class:"flex items-center gap-4 min-w-0 flex-1"},Hl={class:"text-2xl font-bold w-8 shrink-0"},Ql={class:"flex-1 min-w-0"},Yl={class:"font-semibold truncate"},Kl={class:"text-sm text-base-content/70"},Xl={key:0,class:"flex items-center gap-2 shrink-0"},Zl={key:0,class:"badge badge-sm gap-1 bg-amber-100 text-amber-600 border border-amber-200"},Jl={class:"text-xs font-semibold"},ea={class:"text-right"},ta={class:"modal-action"},sa={key:0,class:"w-full"},na={class:"flex justify-between items-center flex-wrap gap-y-2 gap-x-4"},oa={class:"flex gap-2 flex-wrap"},la=["disabled"],aa={key:1,class:"w-full flex justify-end"},ia=1e3,ra=te({__name:"GroupingTab",props:{classInfo:{}},setup(R){const t=R,o=xt(),a=ks(),w=Gs(),{exportToExcel:$}=As(),b=globalThis.Math,P=n=>{if(!n)return"‚Äî";const s=n instanceof Date?n:typeof n=="number"?new Date(n):new Date(n);return Number.isNaN(s.getTime())?"‚Äî":s.toLocaleString("zh-TW")},{groupingSettings:S,groupingViewCollapsed:g,userPreferences:z}=ft(a),{groupingBaseScores:ve,groupingSessionScores:ye,groupingActivityNames:Se,groupingSessionGroupScores:xe,groupingSessionIndividualScores:Ce}=ft(o),Q=k(),me=k(),E=n=>{const s=b.floor(Number(n));return!Number.isFinite(s)||s<2?2:b.min(s,10)},T=k(E(t.classInfo.groupCount)),M=k(String(T.value)),be=k(!1),f=k([]),$e=k(!1),i=k(!1),v=k({}),U=k({}),K=k(null),se=k(""),F=k([]),N=k({groupId:null,index:null}),H=k({studentIds:[],sourceGroupId:null}),V=k(!1),Ie=k(!0),ue=k({}),B=x(()=>t.classInfo.rewardSettingsMode==="disabled"?null:t.classInfo.rewardSettingsMode==="template"&&w.getTemplateById(t.classInfo.appliedRewardTemplateId)?.settings||null),Ue=x(()=>B.value?.enabled===!0&&B.value?.mode==="group-based"),X=x(()=>B.value?.mode==="class-total"),Ye=x(()=>B.value?ht(B.value):qe.classTotalMode.pointsPerInvincible),Ke=x(()=>B.value?Ts(B.value):qe.classTotalMode.invincibleDurationSeconds),Ct=x(()=>B.value?_s(B.value):qe.classTotalMode.invinciblePointsPerClick),Z=k(0),je=k(0),ke=n=>{const s=n??Date.now();if(!t.classInfo.groupingActive||!X.value){Z.value=0;return}const r=t.classInfo.classInvincibleUntil;r&&r>s?Z.value=b.max(0,b.ceil((r-s)/1e3)):Z.value=0},Xe=x(()=>X.value?o.calculateClassTotalScore(t.classInfo.id):0),Ge=k({visible:!1,achievedScore:0,duration:0}),ne=x(()=>{const n=B.value;if(!n)return{enabled:!1};const s=!!n.enabled,r=n.mode,l=n.invincibleDurationSeconds,c=n.invinciblePointsPerClick;if(r==="class-total"){const y=ht(n);return{enabled:s,mode:r,classTotalTargetPoints:y,invincibleDurationSeconds:l,invinciblePointsPerClick:c}}return{enabled:s,mode:r,pointsPerStar:n.pointsPerStar,starsToInvincible:n.starsToInvincible,invincibleDurationSeconds:l,invinciblePointsPerClick:c}});ee(()=>t.classInfo.id,n=>{n&&a.hydrateGroupingViewCollapsed(n,!!t.classInfo.groupingActive)},{immediate:!0}),ee(()=>!!B.value?.enabled,n=>{S.value.compactMode!==n&&(S.value.compactMode=n,a.persistGroupingSettings())},{immediate:!0}),ee(X,n=>{if(!n){Z.value=0;return}ke()},{immediate:!0}),ee(()=>t.classInfo.classInvincibleUntil,()=>{ke();const n=Date.now(),s=t.classInfo.classInvincibleUntil;s&&s>n?je.value=b.max(0,b.ceil((s-n)/1e3)):je.value=0});const Ze=Ds(),fe=k({visible:!1,groupName:"",duration:0,pointsPerClick:0});let ae=null,ie=null,de=null,re=null;const Re=()=>{fe.value.visible=!1,ae&&(clearTimeout(ae),ae=null)},Je=()=>{Ge.value.visible=!1,ie&&(clearTimeout(ie),ie=null)},et=()=>{if(!z.value.enableSounds)return;const n=Ze.app.baseURL||"/";de||(de=new Audio(`${n}super-star.mp3`),de.volume=.65),de.currentTime=0,de.play().catch(()=>{})};let Te=null;const $t=()=>{if(!z.value.enableSounds)return;const n=Ze.app.baseURL||"/";Te||(Te=new Audio(`${n}star.mp3`),Te.volume=.5),Te.currentTime=0,Te.play().catch(()=>{})},tt=()=>{if(!t.classInfo.groupingActive)return;const n=Date.now();ke(n);let s=!1;t.classInfo.groups&&t.classInfo.groups.forEach(r=>{r.isInvincible&&r.invincibleUntil&&r.invincibleUntil-n<=500&&(s=!0)}),s&&o.checkInvincibleStatus(),t.classInfo.groups&&t.classInfo.groups.forEach(r=>{if(r.isInvincible&&r.invincibleUntil){const l=r.invincibleUntil-n;l<=0?delete ue.value[r.id]:l<1e3?ue.value[r.id]=1:ue.value[r.id]=b.ceil(l/1e3)}else delete ue.value[r.id]})},It=(n,s)=>{fe.value={visible:!0,groupName:n.name,duration:b.max(s?.invincibleDurationSeconds??0,0),pointsPerClick:b.max(s?.invinciblePointsPerClick??1,1)},ae&&clearTimeout(ae),et(),ae=setTimeout(()=>{Re()},ia)},kt=n=>{Ge.value={visible:!0,achievedScore:n,duration:b.max(Ke.value,0)},Z.value=b.max(Ke.value,0),ke(),ie&&clearTimeout(ie),et(),ie=setTimeout(()=>{Je()},1e3)},{starGainAnimation:Gt,invincibleBurstActive:Tt,invincibleHighlight:_t,milestoneBubbles:Mt,getTotalStarsForDisplay:Ne,getStarProgress:At,isCountdownCritical:Dt,trackGroupUpdate:Pt,prepareGroupData:Le,cleanupForRemovedGroups:Et,cleanupRewards:Bt}=vl({activeRewardSettings:B,timers:ue,uiNotifier:{showToast:a.showToast,triggerInvincibleCelebration:({group:n,settings:s})=>It(n,s)}}),_e=x({get:()=>Se.value[t.classInfo.id]||"",set:n=>{o.setGroupingActivityName(t.classInfo.id,n)}}),st=x(()=>ve.value[t.classInfo.id]||{}),nt=x(()=>ye.value[t.classInfo.id]||{}),ot=x(()=>{const n={};return f.value.forEach(s=>{n[s.id]=Ne(s)}),n}),De=x(()=>t.classInfo.students.filter(n=>n.isPresent&&!f.value.some(s=>s.members.some(r=>r.id===n.id)))),Ut=x(()=>{const n=se.value.trim().toLowerCase();return n?De.value.filter(s=>s.name.toLowerCase().includes(n)||String(s.id).toLowerCase().includes(n)):De.value}),jt=x(()=>De.value.length),Y=x(()=>V.value&&!t.classInfo.groupingActive),Oe=x(()=>[...f.value].sort((n,s)=>s.totalScore-n.totalScore)),lt=x(()=>{const n=Oe.value,s=S.value.leaderboardDisplayCount;return s==="all"?n:n.slice(0,s)}),at=x(()=>f.value.some(n=>n.members.length>0)),Rt=()=>{me.value?.showModal()},Nt=n=>{const s=B.value?.invincibleDurationSeconds;if(!s||s<=0)return 1;const r=ue.value[n];if(typeof r=="number")return b.max(0,b.min(1,r/s));const l=f.value.find(c=>c.id===n);if(l?.invincibleUntil){const c=b.max(0,(l.invincibleUntil-Date.now())/1e3);return b.max(0,b.min(1,c/s))}return 1},Lt=(n,s)=>{const r=f.value.find(l=>l.id===n);return r?r.isInvincible&&B.value?.enabled&&B.value.invinciblePointsPerClick||1:s},Ot=()=>{a.setGroupingViewCollapsed(!1,t.classInfo.id)},Ft=()=>{f.value.length!==0&&a.setGroupingViewCollapsed(!0,t.classInfo.id)},oe=n=>n.members.map(s=>t.classInfo.students.find(l=>l.id===s.id)||s),Fe=n=>{const s=f.value.find(r=>r.id===n);return s?oe(s):[]},zt=n=>oe(n).every(s=>!s.isPresent),Vt=n=>{const s=B.value;let r=1;return n.isInvincible&&s?.enabled&&(r=s.invinciblePointsPerClick||1),`+${r}`},J=()=>{const n=f.value.map(s=>({...s,members:s.members.map(r=>({...r}))}));be.value=!0,o.updateGroups(t.classInfo.id,n)},it=n=>{const s=Array.isArray(n)?n:[],r=f.value.length===0;s.forEach(c=>{Le(c);const y=f.value.find(j=>j.id===c.id);Pt(c,y,{skipMilestoneAnimation:r})}),f.value=s.map(c=>({...Le({...c}),members:c.members?.map(y=>({...y}))||[],createdAt:c.createdAt?new Date(c.createdAt):new Date})),f.value.length===0&&a.setGroupingViewCollapsed(!1,t.classInfo.id);const l=new Set(f.value.map(c=>c.id));Object.keys(v.value).forEach(c=>{l.has(c)||delete v.value[c]}),Et(l),V.value||(Ie.value=!0)},Wt=(n,s=!0,r)=>{const l={id:`group_${Date.now()}_${b.random().toString(36).substr(2,9)}`,name:n.trim(),members:[],totalScore:0,averageScore:0,createdAt:new Date,color:Pe(),stars:0,isInvincible:!1,invincibleUntil:null,invincibleStarQueue:0,totalCollectedStars:0};return f.value.push(Le(l)),s&&J(),l},Pe=n=>{const s=typeof n=="number"?n%q.defaultColors.length:f.value.length%q.defaultColors.length;return q.defaultColors[s]},rt=()=>E(T.value),qt=()=>{const n=Number(M.value);if(!Number.isFinite(n)||n<q.minGroups||n>q.maxGroups){alert(`ÁµÑÊï∏ÂøÖÈ†à‰ªãÊñº ${q.minGroups} Âà∞ ${q.maxGroups} ‰πãÈñì„ÄÇ`);return}if(!t.classInfo?.students?.length||(ze(),!confirm("ÈÄôÂ∞áÈáçÊñ∞ÂàÜÈÖçÊâÄÊúâÂ≠∏ÁîüÔºå‰∏¶Â∞áÊâÄÊúâÁµÑÂà•ÁöÑÁ∏ΩÂàÜÊ≠∏Èõ∂„ÄÇÁ¢∫ÂÆöË¶ÅÁπºÁ∫åÂóéÔºü")))return;const r=f.value.map((G,L)=>({id:G.id||`group_${Date.now()}_${L}`,name:G.name?.trim()||`Á¨¨ ${L+1} ÁµÑ`,color:G.color||Pe(L),totalScore:0,averageScore:0,createdAt:G.createdAt?new Date(G.createdAt):new Date,stars:0,invincibleStarQueue:0,isInvincible:!1,invincibleUntil:null,totalCollectedStars:0})),c=(r.length?r:Array.from({length:rt()},(G,L)=>({id:`group_${Date.now()}_${b.random().toString(36).substr(2,9)}`,name:`Á¨¨ ${L+1} ÁµÑ`,color:Pe(L),totalScore:0,averageScore:0,createdAt:new Date,stars:0,invincibleStarQueue:0,isInvincible:!1,invincibleUntil:null,totalCollectedStars:0}))).map((G,L)=>({...G,members:[],color:G.color||Pe(L)}));f.value=c,v.value={};const y=t.classInfo.students.filter(G=>G.isPresent);if(f.value.length===0){alert("Êú™Âª∫Á´ã‰ªª‰ΩïÁµÑÂà•ÔºåË´ãÂÖàË®≠ÂÆöÊúâÊïàÁöÑÁµÑÊï∏");return}if(y.length===0){alert("ÁõÆÂâçÊ≤íÊúâÂá∫Â∏≠Â≠∏ÁîüÂèØ‰æõÂàÜÁµÑ");return}[...y].sort(()=>b.random()-.5).forEach((G,L)=>{const Ae=L%f.value.length;f.value[Ae].members.push({...G})}),V.value||J()},ut=(n,s=!0)=>{const r=f.value.length;let l=!1;if(n>r)for(let c=r;c<n;c++)Wt(`Á¨¨ ${c+1} ÁµÑ`,!1),l=!0;else n<r&&(l=f.value.splice(n).length>0);return l&&s&&J(),l},ze=()=>{if(String(M.value).trim()===""){M.value=String(T.value);return}const n=Number(M.value);if(!Number.isFinite(n)){M.value=String(T.value);return}const s=b.min(b.max(b.floor(n),q.minGroups),q.maxGroups);s!==T.value&&(T.value=s,ut(s,!1)&&!V.value&&J(),o.updateGroupCount(t.classInfo.id,s)),M.value=String(T.value)},Ht=()=>{ze();const n=rt();ut(n,!V.value)},Qt=()=>{confirm("ÈÄôÊúÉÂ∞áÊâÄÊúâÂ≠∏ÁîüÁßªÂõûÊú™ÂàÜÁµÑÁãÄÊÖãÔºå‰ΩÜÊúÉ‰øùÁïôÁèæÊúâÁµÑÂà•„ÄÇÁ¢∫ÂÆöÂóéÔºü")&&(f.value=f.value.map(n=>({...n,members:[]})),V.value||J(),he())},Yt=n=>{Y.value&&(F.value.includes(n)?F.value=F.value.filter(s=>s!==n):F.value=[...F.value,n])},he=()=>{F.value=[]},Ve=n=>{const s=K.value;if(!s)return;const r=s.getBoundingClientRect(),l=80,c=20;n.clientY<r.top+l?s.scrollTop-=c:n.clientY>r.bottom-l&&(s.scrollTop+=c)},dt=(n,s,r)=>{if(!Y.value){r.preventDefault();return}const l=new Set(F.value),c=s==="unassigned"&&l.size>0&&l.has(n)?Array.from(l):[n];H.value={studentIds:c,sourceGroupId:s},N.value={groupId:null,index:null},r.dataTransfer?.setData("text/plain",c.join(","))},ct=()=>{N.value={groupId:null,index:null}},Kt=n=>{Y.value&&Ve(n)},pt=(n,s)=>{Y.value&&(Ve(s),N.value={groupId:n,index:Fe(n).length})},Xt=(n,s,r)=>{Y.value&&(Ve(r),N.value={groupId:n,index:s})},Me=(n=!1)=>{(n||H.value.sourceGroupId==="unassigned")&&he(),H.value={studentIds:[],sourceGroupId:null},N.value={groupId:null,index:null}},Zt=n=>{if(!Y.value||!H.value.studentIds.length)return;const s=N.value.groupId===n&&N.value.index!==null?N.value.index:Fe(n).length;We(H.value.studentIds,n,s),Me()},Jt=(n,s)=>{if(!Y.value||!H.value.studentIds.length)return;const r=Fe(n),l=new Set(H.value.studentIds),c=r.slice(0,s).filter(j=>l.has(j.id)).length,y=b.max(s-c,0);We(H.value.studentIds,n,y),Me()},es=()=>{Y.value&&H.value.studentIds.length&&(ts(H.value.studentIds),Me(!0))},We=(n,s,r)=>{if(!n.length)return;const l=n.map(y=>t.classInfo.students.find(j=>j.id===y)).filter(y=>!!y).map(y=>({...y}));if(!l.length)return;const c=f.value.map(y=>{const j=y.members.filter(Ae=>!n.includes(Ae.id));if(y.id!==s)return{...y,members:j};const G=[...j],L=typeof r=="number"?b.min(b.max(r,0),G.length):G.length;return G.splice(L,0,...l),{...y,members:G}});f.value=c,V.value||V.value||J()},ts=(n,s=!0)=>{n.length&&(f.value=f.value.map(r=>({...r,members:r.members.filter(l=>!n.includes(l.id))})),s&&!V.value&&J())},ss=n=>{if(!Y.value){alert("Ë´ãÂÖàÈÄ≤ÂÖ•Á∑®ËºØÊ®°ÂºèÂæåÂÜç‰ΩøÁî®Âø´ÈÄüÊåáÊ¥æ");return}if(F.value.length===0){alert("Ë´ãÂÖàÂú®Êú™ÂàÜÁµÑÂ≠∏ÁîüÂàóË°®‰∏≠ÈÅ∏ÂèñÂ≠∏Áîü");return}We([...F.value],n),he()},ns=()=>{if(t.classInfo.groupingActive){alert("ÂàÜÁµÑÊ¥ªÂãïÈÄ≤Ë°å‰∏≠ÔºåË´ãÂÖàÁµêÊùüÂæåÂÜçÁ∑®ËºØÁµÑÂà•„ÄÇ");return}V.value=!0,Ie.value=!1,a.setGroupingViewCollapsed(!1),he()},os=()=>{J(),V.value=!1,Ie.value=!0,Me(!0)},ls=()=>{it(t.classInfo.groups),V.value=!1,Ie.value=!0,Me(!0)},vt=(n,s)=>{if(!t.classInfo.groupingActive)return;const r=s>0?"animate-score-bounce-green":"animate-score-bounce-red";v.value[n]=r,setTimeout(()=>{v.value[n]===r&&(v.value[n]=null)},500);let l=0;if(X.value&&s>0&&(l=t.classInfo.classTotalInvincibleCount||0),o.addScoreToGroup(t.classInfo.id,n,s),X.value&&s>0&&Z.value>0&&$t(),X.value&&s>0){const c=t.classInfo.classTotalInvincibleCount||0;if(c>l){const y=Ye.value,j=c*y;kt(j)}}},as=n=>{const s=f.value.find(l=>l.id===n);if(!s)return;const r=prompt("Ë´ãËº∏ÂÖ•Êñ∞ÁöÑÁµÑÂêçÔºö",s.name);r&&r.trim()&&(s.name=r.trim(),J())},is=n=>{if(confirm("Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§ÁµÑÂà•ÂóéÔºüÁµÑÂÖßÂ≠∏ÁîüÂ∞áÁßªËá≥Êú™ÂàÜÁµÑ„ÄÇ")){const s=f.value.findIndex(r=>r.id===n);s>-1&&(f.value.splice(s,1),J())}},rs=(n,s)=>{if(!t.classInfo.groupingActive)return;const r=s>0?"animate-score-bounce-green":"animate-score-bounce-red";U.value[n]=r,setTimeout(()=>{U.value[n]===r&&(U.value[n]=null)},500),o.addIndividualScoreInGroup(t.classInfo.id,n,s)},us=()=>{if(!at.value){alert("Ë´ãÂÖàÂ∞áÂ≠∏ÁîüÂàÜÁµÑÔºåÊâçËÉΩÈñãÂßãÂàÜÁµÑÊ¥ªÂãïÔºÅ");return}const n=f.value.filter(s=>oe(s).length===0);if(n.length>0){const s=n.map(l=>l.name||"Êú™ÂëΩÂêçÁµÑ").join("„ÄÅ ");if(!confirm(`‰ª•‰∏ãÁµÑÂà•ÁõÆÂâçÊ≤íÊúâÊàêÂì°Ôºö${s}„ÄÇ
‰ªçË¶ÅÈñãÂßãÂàÜÁµÑÊ¥ªÂãïÂóéÔºü`))return}o.startClassGrouping(t.classInfo.id),a.setGroupingViewCollapsed(!0,t.classInfo.id)},ds=()=>{i.value=!0,Q.value?.showModal()},cs=()=>{confirm("Á¢∫Ë™çË¶ÅÈáçË®≠ÂêÑÁµÑÂàÜÊï∏ÂóéÔºüÈÄôÂ∞áÊ∏ÖÈô§ÊâÄÊúâÁµÑÂà•ÁöÑÁ∏ΩÂàÜ„ÄÇ")&&(f.value.forEach(n=>{n.totalScore=0}),J(),o.endClassGrouping(t.classInfo.id),Ee(),a.setGroupingViewCollapsed(!1,t.classInfo.id))},ps=()=>{i.value=!1,Q.value?.showModal()},Ee=()=>{Q.value?.close(),i.value=!1},mt=(n=!1)=>{const s=new Date,r=s.toISOString().split("T")[0],l=X,c=B.value?.invinciblePointsPerClick??0;n&&o.updateClass(t.classInfo.id,{groupingEndedAt:s});let y,j;l&&B.value?.enabled?(y=Oe.value.map((_,W)=>({ÊéíË°å:W+1,ÁµÑÂà•:_.name,‰∫∫Êï∏:oe(_).length,Á∏ΩÂàÜ:_.totalScore})),j=[{wch:8},{wch:25},{wch:8},{wch:10}]):(y=Oe.value.map((_,W)=>({ÊéíË°å:W+1,ÁµÑÂà•:_.name,‰∫∫Êï∏:oe(_).length,Á∏ΩÂàÜ:_.totalScore,...B.value?.enabled&&{ÊòüÊòüÊï∏:Ne(_)}})),j=[{wch:8},{wch:25},{wch:8},{wch:10}],B.value?.enabled&&j.push({wch:10}));const G=o.classes.find(_=>_.id===t.classInfo.id)||t.classInfo,L=[["Ê¥ªÂãïÂêçÁ®±:",_e.value||"Êú™ÂëΩÂêç"],["Áè≠Á¥ö:",G.name],["ÂåØÂá∫Êó•Êúü:",s.toLocaleString("zh-TW")],["Ê¥ªÂãïÈñãÂßãÊôÇÈñì:",P(G.groupingStartedAt??null)],["Ê¥ªÂãïÁµêÊùüÊôÇÈñì:",P(G.groupingEndedAt??null)]];l&&B.value?.enabled?(L.push(["ÂÖ®Áè≠Á¥ØÁ©çÂàÜÊï∏:",Xe.value]),L.push(["ÁÑ°ÊïµÊ®°ÂºèÊØèÊ¨°Âä†ÂàÜ:",c]),L.push(["ÁÑ°ÊïµÊ®°ÂºèËß∏ÁôºÊ¨°Êï∏:",G.classTotalInvincibleCount??0]),L.push([])):L.push([]);const Ae={sheetName:"ÂàÜÁµÑÊëòË¶Å",header:L,data:y,columnWidths:j},vs={sheetName:"Â≠∏ÁîüÂæóÂàÜÊòéÁ¥∞",data:f.value.flatMap(_=>oe(_).map(W=>{const gs=st.value[W.id]??0,gt=nt.value[W.id]??0,fs=xe.value[t.classInfo.id]?.[W.id]??0,hs=Ce.value[t.classInfo.id]?.[W.id]??0;return{ÁµÑÂà•:_.name,Â∫ßËôü:W.id,ÂßìÂêç:W.name,Âá∫Â∏≠ÊÉÖÊ≥Å:W.isPresent?"Âá∫Â∏≠":"Áº∫Â∏≠",Â∞èÁµÑÂúòÈ´îÂä†ÂàÜ:fs,Â∞èÁµÑÂÄã‰∫∫Âä†ÂàÜ:hs,Êú¨Ê¨°Ê¥ªÂãïÁ∏ΩÂæóÂàÜ:gt,Ê¥ªÂãïÂæåÁ∏ΩÂàÜ:gs+gt}})),columnWidths:[{wch:25},{wch:10},{wch:15},{wch:12},{wch:15},{wch:15},{wch:15},{wch:15}]},bt=[...Array.isArray(G.invincibleEvents)?G.invincibleEvents:[]].map(_=>({..._,timestamp:_.timestamp instanceof Date?_.timestamp:new Date(_.timestamp)})).sort((_,W)=>_.timestamp.getTime()-W.timestamp.getTime()),ms={sheetName:"ÁÑ°ÊïµÊ®°ÂºèÁ¥ÄÈåÑ",data:bt.length>0?bt.map((_,W)=>({Â∫èËôü:W+1,ÁµÑÂà•:_.groupName,Ëß∏ÁôºÊôÇÈñì:P(_.timestamp),ÁÑ°ÊïµÂä†ÂàÜ:_.points})):[{Â∫èËôü:"‚Äî",ÁµÑÂà•:"‚Äî",Ëß∏ÁôºÊôÇÈñì:"ÁõÆÂâçÂ∞öÁÑ°ÁÑ°ÊïµÊ®°ÂºèÂä†ÂàÜÁ¥ÄÈåÑ",ÁÑ°ÊïµÂä†ÂàÜ:"‚Äî"}],columnWidths:[{wch:8},{wch:20},{wch:26},{wch:12}]},bs=`${r}-${_e.value||"ÂàÜÁµÑÊ¥ªÂãïÂ†±Âëä"}-${t.classInfo.name}`;$([Ae,vs,ms],bs)};return ee(()=>t.classInfo.groups,n=>{it(n),be.value&&(be.value=!1)},{deep:!0,immediate:!0}),ee(()=>t.classInfo.groupCount,n=>{const s=E(n);T.value!==s&&(T.value=s),M.value=String(s)},{immediate:!0}),ee(()=>T.value,(n,s)=>{n!==s&&(M.value=String(n))}),ee(()=>De.value.map(n=>n.id),n=>{const s=new Set(n);F.value=F.value.filter(r=>s.has(r))}),ee(()=>t.classInfo.groupingActive,n=>{n?(V.value=!1,Ie.value=!0,he(),ke(),tt(),re&&clearInterval(re),re=Ms(tt,250)):(Z.value=0,re&&(clearInterval(re),re=null),ue.value={})},{immediate:!0}),Qe(()=>{re&&(clearInterval(re),re=null),ae&&(clearTimeout(ae),ae=null),ie&&(clearTimeout(ie),ie=null),de&&(de.pause(),de=null),Re(),Z.value=0,Bt()}),(n,s)=>{const r=I;return u(),d("div",ml,[X.value?C("",!0):(u(),ge(Ro,{key:0,visible:fe.value.visible,"group-name":fe.value.groupName,duration:fe.value.duration,"points-per-click":fe.value.pointsPerClick,onClose:Re},null,8,["visible","group-name","duration","points-per-click"])),X.value?(u(),ge(pl,{key:1,visible:Ge.value.visible,"achieved-score":Ge.value.achievedScore,duration:Ge.value.duration,"show-countdown":!0,"countdown-seconds":Z.value,onClose:Je},null,8,["visible","achieved-score","duration","countdown-seconds"])):C("",!0),m(Gn,{"grouping-active":n.classInfo.groupingActive,"is-group-edit-mode":V.value,"group-count-input":M.value,"group-count-min":A(q).minGroups,"group-count-max":A(q).maxGroups,"local-groups-length":f.value.length,"activity-name":_e.value,"has-students-in-groups":at.value,"reward-enabled":ne.value.enabled,"groups-collapsed":A(g),"onUpdate:groupCountInput":s[0]||(s[0]=l=>M.value=l),onCommitGroupCount:ze,onBuildGroupsForCount:Ht,onRandomAssignGroups:qt,onResetAllGroups:Qt,onOpenRewardInfoModal:Rt,onSaveGroupEdits:os,onCancelGroupEdits:ls,"onUpdate:activityName":s[1]||(s[1]=l=>_e.value=l),onExpandAllGroups:Ot,onCollapseAllGroups:Ft,onToggleGroupsCollapsed:s[2]||(s[2]=()=>A(a).setGroupingViewCollapsed(!A(g),t.classInfo.id)),onStartGroupEditing:ns,onStartGrouping:us,onExportActivityReport:s[3]||(s[3]=l=>mt(l)),onShowGroupScoreboard:ps,onEndGrouping:ds},null,8,["grouping-active","is-group-edit-mode","group-count-input","group-count-min","group-count-max","local-groups-length","activity-name","has-students-in-groups","reward-enabled","groups-collapsed"]),e("div",{class:D(["flex gap-6 h-[calc(100vh-220px)]",X.value&&"pb-10"])},[m(io,{collapsed:$e.value,"grouping-active":n.classInfo.groupingActive,"ungrouped-search":se.value,"ungrouped-count":jt.value,"filtered-ungrouped-students":Ut.value,"selected-student-ids":F.value,"can-modify-groups":Y.value,"leaderboard-groups":lt.value,"group-star-counts":ot.value,"show-reward-stars":Ue.value,"show-group-total-scores":A(S).showGroupTotalScores,onToggleCollapse:s[4]||(s[4]=l=>$e.value=l),"onUpdate:ungroupedSearch":s[5]||(s[5]=l=>se.value=l),onClearSelection:he,onToggleStudentSelection:Yt,onDragStart:s[6]||(s[6]=(l,c,y)=>dt(l,c,y)),onDragEnd:ct,onUnassignedDrop:es},null,8,["collapsed","grouping-active","ungrouped-search","ungrouped-count","filtered-ungrouped-students","selected-student-ids","can-modify-groups","leaderboard-groups","group-star-counts","show-reward-stars","show-group-total-scores"]),e("main",{ref_key:"groupsContainer",ref:K,class:"flex-1 content-start",onDragover:ce(Kt,["prevent"])},[e("div",{class:D(["p-1",n.classInfo.groupingActive?A(S).compactMode?"grid grid-cols-4 content-start gap-2":"grid grid-cols-4 content-start gap-3":"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4"])},[(u(!0),d(O,null,pe(f.value,l=>(u(),ge(mo,{key:l.id,compact:n.classInfo.groupingActive&&A(S).compactMode,"is-invincible":l.isInvincible,"invincible-burst":!!A(Tt)[l.id],"invincible-highlight":!!A(_t)[l.id],"milestone-message":A(Mt)[l.id]?.message??null,class:"relative"},{default:Be(()=>[n.classInfo.groupingActive?(u(),d("div",{key:1,class:D(["flex flex-col",A(S).compactMode?"gap-1":"gap-1.5"])},[e("div",Il,[e("h3",kl,[e("div",{class:"w-3 h-3 rounded-full shrink-0 mt-1",style:le({backgroundColor:l.color})},null,4),e("span",null,p(l.name),1)]),e("div",{class:D(["flex items-center gap-1 text-primary font-semibold text-lg",v.value[l.id]])},[e("span",null,p(l.totalScore),1)],2)]),m(tn,{"positive-label":Vt(l),"negative-label":"-1",disabled:zt(l),onAddPositive:c=>vt(l.id,Lt(l.id,1)),onAddNegative:c=>vt(l.id,-1)},null,8,["positive-label","disabled","onAddPositive","onAddNegative"]),Ue.value?(u(),ge(Ks,{key:0,group:l,"formatted-timer":A(He)(ue.value[l.id]||0),"total-stars":A(Ne)(l),"star-progress":A(At)(l),"invincible-progress":Nt(l.id),"queue-count":l.invincibleStarQueue||0,"star-gain-class":A(Gt)[l.id]??null,"countdown-critical":A(Dt)(l.id)},null,8,["group","formatted-timer","total-stars","star-progress","invincible-progress","queue-count","star-gain-class","countdown-critical"])):C("",!0)],2)):(u(),d("div",bl,[e("div",gl,[e("h3",fl,[e("div",{class:"w-4 h-4 rounded-full shrink-0",style:le({backgroundColor:l.color})},null,4),e("span",hl,p(l.name),1),e("span",wl,p(oe(l).length),1)]),e("div",{class:D(["flex items-center gap-1 text-primary font-semibold whitespace-nowrap",v.value[l.id]])},[e("span",null,p(l.totalScore),1)],2)]),e("div",yl,[e("div",Sl,[m(r,{name:"MoreVertical",class:"w-4 h-4"})]),e("ul",xl,[e("li",null,[e("a",{onClick:c=>as(l.id)},[m(r,{name:"Edit",class:"w-4 h-4"}),s[11]||(s[11]=h(" Á∑®ËºØÁµÑÂêç ",-1))],8,Cl)]),e("li",null,[e("a",{onClick:c=>is(l.id),class:"text-error"},[m(r,{name:"Trash2",class:"w-4 h-4"}),s[12]||(s[12]=h(" Âà™Èô§ÁµÑÂà• ",-1))],8,$l)])])])])),A(g)?C("",!0):(u(),d("div",{key:2,class:D(["flex-1 min-h-32 rounded-xl border border-dashed border-base-300 bg-base-100/60 p-2 flex flex-col gap-2 relative mt-2 overflow-visible",N.value.groupId===l.id&&N.value.index===oe(l).length?"ring-2 ring-primary/60 ring-offset-2":""]),onDrop:c=>Zt(l.id),onDragover:ce(c=>pt(l.id,c),["prevent"]),onDragenter:ce(c=>pt(l.id,c),["prevent"])},[Y.value?(u(),d("div",Tl,[e("button",{type:"button",class:"btn btn-ghost btn-xs",disabled:F.value.length===0,onClick:c=>ss(l.id)}," Âø´ÈÄüÊåáÊ¥æ ",8,_l)])):C("",!0),m(Ao,{"group-id":l.id,members:oe(l),"is-edit-mode":V.value,"can-modify":Y.value,"grouping-active":n.classInfo.groupingActive,"show-individual-scores":A(S).showStudentIndividualScores,"allow-individual-scoring":A(S).allowIndividualScoring,"base-scores":st.value,"session-scores":nt.value,"student-score-animation":U.value,"drop-indicator":N.value,onDragStart:s[7]||(s[7]=(c,y,j)=>dt(c,y,j)),onDragEnd:ct,onMemberDragOver:s[8]||(s[8]=(c,y,j)=>Xt(c,y,j)),onMemberDrop:s[9]||(s[9]=(c,y)=>Jt(c,y)),onAddIndividualScore:rs},null,8,["group-id","members","is-edit-mode","can-modify","grouping-active","show-individual-scores","allow-individual-scoring","base-scores","session-scores","student-score-animation","drop-indicator"])],42,Gl))]),_:2},1032,["compact","is-invincible","invincible-burst","invincible-highlight","milestone-message"]))),128))],2)],544)],2),X.value&&n.classInfo.groupingActive?(u(),ge(sl,{key:2,"current-total":Xe.value,"points-per-invincible":Ye.value,"trigger-count":n.classInfo.classTotalInvincibleCount||0,"is-invincible":Z.value>0,"invincible-seconds-remaining":Z.value,"invincible-points":Ct.value,"invincible-duration-seconds":je.value},null,8,["current-total","points-per-invincible","trigger-count","is-invincible","invincible-seconds-remaining","invincible-points","invincible-duration-seconds"])):C("",!0),e("dialog",{ref_key:"rewardInfoModal",ref:me,class:"modal"},[e("div",Ml,[e("h3",Al,[m(r,{name:"Sparkles",class:"w-5 h-5 text-warning"}),s[13]||(s[13]=h(" ÁçéÂãµÊ©üÂà∂Ë™™Êòé ",-1))]),ne.value.enabled?(u(),d("div",Dl,[ne.value.mode==="class-total"?(u(),d(O,{key:0},[e("p",null,[s[14]||(s[14]=h(" ÂÖ®Áè≠Á¥ØÁ©çÈÅîÂà∞ ",-1)),e("span",Pl,p(ne.value.classTotalTargetPoints),1),s[15]||(s[15]=h(" ÂàÜÂç≥ÂèØÂïüÂãïÁÑ°ÊïµÊòüÊòüÊ®°Âºè„ÄÇ ",-1))]),e("ul",El,[e("li",Bl,[m(r,{name:"Timer",class:"w-4 h-4 mt-0.5 text-info"}),e("span",null,"ÁÑ°ÊïµÁãÄÊÖãÂ∞áÊåÅÁ∫å "+p(A(wt)(ne.value.invincibleDurationSeconds))+"„ÄÇ",1)]),e("li",Ul,[m(r,{name:"Target",class:"w-4 h-4 mt-0.5 text-success"}),e("span",null,"ÁÑ°ÊïµÊúüÈñìÊØèÊ¨°Âä†ÂàÜ = +"+p(ne.value.invinciblePointsPerClick)+" ÂàÜ„ÄÇ",1)])]),s[16]||(s[16]=e("p",{class:"text-xs text-base-content/60"}," Áï∂ÂÖ®Áè≠ÈÅîÊàêÁõÆÊ®ôÂïüÂãïÁÑ°ÊïµÊòüÊòüÊ®°ÂºèÔºåÁ≥ªÁµ±ÊúÉË∑≥Âá∫ÊèêÈÜíÔºåË´ãÊääÊè°ÈªÉÈáëÊôÇÊÆµÔºÅ ",-1))],64)):(u(),d(O,{key:1},[e("p",null,[s[17]||(s[17]=h(" ÊØèÁ¥ØÁ©ç ",-1)),e("span",jl,p(ne.value.pointsPerStar),1),s[18]||(s[18]=h(" ÂàÜÂèØÁç≤Âæó ",-1)),s[19]||(s[19]=e("span",{class:"font-semibold"},"1 È°ÜÊòü",-1)),s[20]||(s[20]=h("„ÄÇ ",-1))]),e("ul",Rl,[e("li",Nl,[m(r,{name:"Star",class:"w-4 h-4 mt-0.5 text-yellow-400"}),e("span",null,"ÈõÜÊªø "+p(ne.value.starsToInvincible)+" È°ÜÊòüÂç≥ÂèØÂïüÂãïÁÑ°ÊïµÊòüÊòüÊ®°Âºè„ÄÇ",1)]),e("li",Ll,[m(r,{name:"Timer",class:"w-4 h-4 mt-0.5 text-info"}),e("span",null,"ÁÑ°ÊïµÁãÄÊÖãÂ∞áÊåÅÁ∫å "+p(A(wt)(ne.value.invincibleDurationSeconds))+"„ÄÇ",1)]),e("li",Ol,[m(r,{name:"Target",class:"w-4 h-4 mt-0.5 text-success"}),e("span",null,"ÁÑ°ÊïµÊúüÈñìÊØèÊ¨°Âä†ÂàÜ = +"+p(ne.value.invinciblePointsPerClick)+" ÂàÜ„ÄÇ",1)])]),s[21]||(s[21]=e("p",{class:"text-xs text-base-content/60"}," Áï∂‰ªª‰ΩïÂ∞èÁµÑÂïüÂãïÁÑ°ÊïµÊòüÊòüÊ®°ÂºèÔºåÁ≥ªÁµ±ÊúÉË∑≥Âá∫ÊèêÈÜíÔºåË´ãÊääÊè°ÈªÉÈáëÊôÇÊÆµÔºÅ ",-1))],64))])):(u(),d("div",Fl," ÁõÆÂâçÊ≠§Áè≠Á¥öÂ∞öÊú™ÂïüÁî®ÁçéÂãµÊ©üÂà∂ÔºåÈªûÊìäÂè≥‰∏äËßí„ÄåÁçéÂãµË®≠ÂÆö„ÄçÂèØÈÄ≤Ë°åË™øÊï¥„ÄÇ ")),s[22]||(s[22]=e("div",{class:"modal-action"},[e("form",{method:"dialog"},[e("button",{type:"submit",class:"btn btn-ghost"},"ÈóúÈñâ")])],-1))])],512),e("dialog",{ref_key:"scoreboardModal",ref:Q,class:"modal"},[e("div",zl,[e("h3",Vl,[m(r,{name:"Trophy",class:"w-5 h-5 mr-2"}),s[23]||(s[23]=h(" Â∞èÁµÑÁ©çÂàÜÂÑÄË°®Êùø ",-1))]),e("div",Wl,[(u(!0),d(O,null,pe(lt.value,(l,c)=>(u(),d("div",{key:l.id,class:D(["flex items-center justify-between gap-4 p-4 rounded-lg",c===0?"bg-warning/20":c===1?"bg-info/20":c===2?"bg-accent/20":"bg-base-200"])},[e("div",ql,[e("div",Hl,p(c+1),1),e("div",{class:"w-6 h-6 rounded-full shrink-0",style:le({backgroundColor:l.color})},null,4),e("div",Ql,[e("div",Yl,p(l.name),1),e("div",Kl,p(oe(l).length)+" ‰ΩçÂ≠∏Áîü ",1)])]),A(S).showGroupTotalScores?(u(),d("div",Xl,[Ue.value?(u(),d("div",Zl,[m(r,{name:"Star",class:"w-4 h-4"}),e("span",Jl,p(ot.value[l.id]??0),1)])):C("",!0),e("div",ea,[e("div",{class:D(["text-2xl font-bold text-primary",v.value[l.id]])},p(l.totalScore),3)])])):C("",!0)],2))),128))]),e("div",ta,[i.value?(u(),d("div",sa,[e("div",na,[e("div",oa,[e("button",{onClick:s[10]||(s[10]=()=>mt(!0)),class:"btn btn-info",disabled:!_e.value.trim()},[m(r,{name:"Download",class:"w-4 h-4 mr-2"}),s[24]||(s[24]=h(" ÂåØÂá∫Ê¥ªÂãïÂ†±Ë°® ",-1))],8,la),e("button",{onClick:cs,class:"btn btn-warning"}," ÁµêÊùü‰∏¶ÈáçË®≠ÂàÜÊï∏ ")]),e("button",{onClick:Ee,class:"btn btn-ghost"}," ÂèñÊ∂à ")]),s[25]||(s[25]=e("p",{class:"text-xs text-base-content/60 mt-3 w-full"}," ÊèêÈÜíÔºöË®≠ÁΩÆÊ¥ªÂãïÂêçÁ®±ÊñπÂèØÂåØÂá∫Ê¥ªÂãïÂ†±ÂëäÔºåÊ¥ªÂãïÁµêÊùüÂæåÂ∞±‰∏çÂèØÂÜçÂåØÂá∫Ê≠§Ê¨°ÂàÜÁµÑÊ¥ªÂãïÁöÑÂ†±Âëä„ÄÇ ",-1))])):(u(),d("div",aa,[e("button",{onClick:Ee,class:"btn"},"ÈóúÈñâ")]))])]),e("form",{method:"dialog",class:"modal-backdrop"},[e("button",{onClick:Ee},"close")])],512)])}}}),ua=Object.assign(we(ra,[["__scopeId","data-v-d38c714c"]]),{__name:"GroupingTab"}),da={key:0,class:"p-4 sm:p-6"},ca={key:1,class:"text-center p-8"},fa=te({__name:"grouping",setup(R){const t=xt(),o=Ps(),a=x(()=>o.params.id),w=x(()=>t.classes.find($=>$.id===a.value));return Es(()=>({title:`${w.value?.name||"Áè≠Á¥öÂàÜÁµÑ"} - ÂàÜÁµÑÊ®°Âºè`})),($,b)=>w.value?(u(),d("div",da,[m(ua,{"class-info":w.value},null,8,["class-info"])])):(u(),d("div",ca,[...b[0]||(b[0]=[e("p",null,"Ê≠£Âú®ËºâÂÖ•Áè≠Á¥öË≥áÊñô...",-1),e("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}});export{fa as default};
