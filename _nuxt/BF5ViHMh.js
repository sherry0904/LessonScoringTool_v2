import{f as K,g as P,i as w,M as Q,r as S,c as x,l as r,o as h,a as t,t as u,b as C,L as k,F as j,n as D,x as T,p as y,d as X,J as Y,k as Z,v as tt,m as et,G as st}from"#entry";const ot={key:0,class:"space-y-6"},nt={class:"flex items-center gap-2 mb-4"},lt={class:"text-2xl font-bold"},at={class:"stats stats-horizontal shadow"},it={class:"stat-title"},rt={class:"card bg-base-100 shadow-sm"},dt={class:"card-body"},ct={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ut={class:"form-control md:col-span-2"},bt={class:"flex gap-2 flex-wrap"},pt=["disabled"],mt=["disabled"],vt=["disabled"],gt=["disabled"],xt={class:"grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},ht=["onClick"],ft={class:"card-body p-4"},_t={class:"flex justify-between items-start mb-3"},wt={class:"font-semibold text-base"},St={class:"text-sm text-base-content/70"},Ct={class:"dropdown dropdown-end"},kt={tabindex:"0",class:"dropdown-content menu bg-base-100 rounded-box z-[1] w-48 p-2 shadow"},yt=["onClick"],$t={class:"mb-3"},Tt={class:"font-medium text-sm"},Mt={class:"grid grid-cols-2 gap-1"},zt=["onClick"],Lt=["onClick"],Rt={class:"modal-box w-11/12 max-w-2xl"},jt={class:"text-lg font-bold mb-4"},Dt={class:"form-control mb-4"},Et={key:1,class:"text-center p-8"},It=K({__name:"[hwid]",setup(Ft){const M=P(),z=Q();st();const E=w(()=>z.params.id),F=w(()=>z.params.hwid),n=w(()=>M.classes.find(o=>o.id===E.value)),l=w(()=>n.value?.homeworks.find(o=>o.id===F.value)||null),b=["pending","submitted","needs_correction","completed"],H={pending:{text:"未繳交",icon:"Clock",bgStyle:"rgba(239, 68, 68, 0.5)",textStyle:"#1a1a1d",borderColor:"border-error"},submitted:{text:"已繳交",icon:"CheckCircle",bgStyle:"rgba(34, 197, 94, 0.5)",textStyle:"#1a1a1d",borderColor:"border-success"},needs_correction:{text:"待訂正",icon:"AlertTriangle",bgStyle:"rgba(250, 204, 21, 0.5)",textStyle:"#1a1a1d",borderColor:"border-warning"},completed:{text:"已完成",icon:"Award",bgStyle:"rgba(59, 130, 246, 0.5)",textStyle:"#1a1a1d",borderColor:"border-info"}},a=S([]),f=S(""),c=S(""),v=S(),d=o=>l.value&&l.value.studentStatus[o]||"pending",p=o=>H[o]||{text:"未知",icon:"HelpCircle",bgStyle:"var(--color-neutral, rgba(120, 120, 120, 0.75))",textStyle:"#fff",borderColor:"border-base-300"},I=o=>({pending:"text-error",submitted:"text-success",needs_correction:"text-warning",completed:"text-info"})[o]||"text-base-content",g=o=>p(o).text,L=o=>l.value?Object.values(l.value.studentStatus).filter(s=>s===o).length:0,V=o=>{const e=(b.indexOf(o)+1)%b.length;return b[e]},A=o=>{const s=a.value.indexOf(o);s>-1?a.value.splice(s,1):a.value.push(o)},$=(o,s)=>{!l.value||!n.value||M.updateHomeworkStatus(n.value.id,l.value.id,o,s)},N=o=>{$(o,"pending")},_=o=>{!l.value||a.value.length===0||(a.value.forEach(s=>{$(s,o)}),a.value=[])},O=()=>{if(!l.value||!n.value)return;const o=n.value.students.filter(e=>{const i=d(e.id);return i==="pending"||i==="needs_correction"}),s=[`作業：${l.value.title}`,`匯出時間：${new Date().toLocaleString("zh-TW")}`,"","未完成學生名單：",...o.map(e=>`${e.id} ${e.name} - ${g(d(e.id))}`),"",`總計：${o.length} 位學生`].join(`
`);f.value="未完成作業名單",c.value=s,v.value?.showModal()},B=()=>{if(!l.value||!n.value)return;const o=b.reduce((e,i)=>(e[i]=L(i),e),{}),s=["作業狀態報告",`作業：${l.value.title}`,`匯出時間：${new Date().toLocaleString("zh-TW")}`,"","狀態統計：",...b.map(e=>`${g(e)}：${o[e]} 人`),"","詳細名單：",...n.value.students.map(e=>`${e.id} ${e.name} - ${g(d(e.id))}`)].join(`
`);f.value="作業狀態報告",c.value=s,v.value?.showModal()},W=o=>{if(!n.value)return;const s=n.value.students.find(m=>m.id===o);if(!s||!l.value)return;const e=n.value.homeworks.filter(m=>{const R=m.studentStatus[o]||"pending";return R==="pending"||R==="needs_correction"}),i=["個人作業報告",`學生：${s.name} (座號 ${s.id})`,`匯出時間：${new Date().toLocaleString("zh-TW")}`,"","未完成作業：",...e.map(m=>`• ${m.title} - ${g(m.studentStatus[o]||"pending")}`),"",`總計：${e.length} 項作業需要完成`].join(`
`);f.value=`${s.name} 的作業報告`,c.value=i,v.value?.showModal()},U=async()=>{try{await navigator.clipboard.writeText(c.value),alert("已複製到剪貼簿！")}catch(o){console.error("複製失敗:",o),alert("複製失敗，請手動選取文字複製。")}},G=()=>{v.value?.close()},J=()=>{n.value&&(a.value=n.value.students.map(o=>o.id))},q=()=>{a.value=[]};return(o,s)=>r(n)&&r(l)?(h(),x("div",ot,[t("div",nt,[t("h2",lt,u(r(l).title),1),t("button",{onClick:s[0]||(s[0]=(...e)=>o.showHomeworkModalForEdit&&o.showHomeworkModalForEdit(...e)),class:"btn btn-ghost btn-sm btn-circle"},[C(k,{name:"Edit",class:"w-4 h-4"})])]),t("div",at,[(h(),x(j,null,D(b,e=>t("div",{class:"stat",key:e},[t("div",it,u(g(e)),1),t("div",{class:T(["stat-value",[I(e)]])},u(L(e)),3)])),64))]),t("div",rt,[t("div",dt,[t("div",ct,[t("div",ut,[s[7]||(s[7]=t("label",{class:"label mb-2"},[t("span",{class:"label-text"},"快速操作")],-1)),t("div",bt,[t("button",{onClick:s[1]||(s[1]=e=>_("pending")),class:"btn btn-error btn-sm",disabled:r(a).length===0}," 批量標記未繳交 ",8,pt),t("button",{onClick:s[2]||(s[2]=e=>_("submitted")),class:"btn btn-success btn-sm",disabled:r(a).length===0}," 批量標記已繳交 ",8,mt),t("button",{onClick:s[3]||(s[3]=e=>_("needs_correction")),class:"btn btn-warning btn-sm",disabled:r(a).length===0}," 批量標記待訂正 ",8,vt),t("button",{onClick:s[4]||(s[4]=e=>_("completed")),class:"btn btn-info btn-sm",disabled:r(a).length===0}," 批量標記已完成 ",8,gt),t("button",{onClick:J,class:"btn btn-sm btn-outline"}," 一鍵全選 "),t("button",{onClick:q,class:"btn btn-sm btn-outline"}," 取消全選 ")])]),t("div",{class:"form-control md:col-span-1"},[s[8]||(s[8]=t("label",{class:"label mb-2"},[t("span",{class:"label-text"},"匯出功能")],-1)),t("div",{class:"flex gap-2 flex-wrap"},[t("button",{onClick:O,class:"btn btn-outline btn-sm"}," 匯出未完成名單 "),t("button",{onClick:B,class:"btn btn-outline btn-sm"}," 匯出狀態報告 ")])])])])]),t("div",xt,[(h(!0),x(j,null,D(r(n).students,e=>(h(),x("div",{key:e.id,class:T(["card bg-base-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",{"ring-2 ring-primary":r(a).includes(e.id)}]),onClick:i=>A(e.id)},[t("div",ft,[t("div",_t,[t("div",null,[t("h3",wt,u(e.name),1),t("p",St,"座號 "+u(e.id),1)]),t("div",Ct,[t("div",{tabindex:"0",role:"button",class:"btn btn-ghost btn-xs btn-circle",onClick:s[5]||(s[5]=y(()=>{},["stop"]))},[C(k,{name:"MoreVertical",class:"w-3 h-3"})]),t("ul",kt,[t("li",null,[t("a",{onClick:y(i=>W(e.id),["stop"])},[C(k,{name:"FileText",class:"w-3 h-3"}),s[9]||(s[9]=X(" 個人報告 ",-1))],8,yt)])])])]),t("div",$t,[t("div",{class:T(["flex items-center justify-center w-full px-4 py-2 rounded-full border",p(d(e.id)).borderColor,"shadow-sm hover:shadow-md transition-all duration-200 hover:scale-105"]),style:Y({backgroundColor:p(d(e.id)).bgStyle,color:p(d(e.id)).textStyle})},[C(k,{name:p(d(e.id)).icon,class:"w-4 h-4 mr-2"},null,8,["name"]),t("span",Tt,u(p(d(e.id)).text),1)],6)]),t("div",Mt,[t("button",{onClick:y(i=>$(e.id,V(d(e.id))),["stop"]),class:"btn btn-xs btn-primary"}," 切換狀態 ",8,zt),t("button",{onClick:y(i=>N(e.id),["stop"]),class:"btn btn-xs btn-ghost"}," 重設 ",8,Lt)])])],10,ht))),128))]),t("dialog",{ref_key:"reportModal",ref:v,class:"modal"},[t("div",Rt,[t("h3",jt,u(r(f)),1),t("div",Dt,[s[10]||(s[10]=t("label",{class:"label"},[t("span",{class:"label-text"},"報告內容")],-1)),Z(t("textarea",{"onUpdate:modelValue":s[6]||(s[6]=e=>et(c)?c.value=e:null),class:"textarea textarea-bordered h-64",readonly:""},null,512),[[tt,r(c)]])]),t("div",{class:"modal-action"},[t("button",{onClick:U,class:"btn btn-success"}," 複製到剪貼簿 "),t("button",{onClick:G,class:"btn btn-ghost"},"關閉")])])],512)])):(h(),x("div",Et,[...s[11]||(s[11]=[t("p",null,"正在載入資料...",-1),t("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}});export{It as default};
