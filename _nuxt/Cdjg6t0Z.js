import{f as R,g as K,r as b,h as X,i as y,u as U,c as m,o as p,a as t,j as L,b as l,d as v,L as Y,t as c,k as i,l as D,v as S,m as Z,F as tt,n as st,p as j,q as et}from"#entry";const nt={class:"p-6 max-w-7xl mx-auto"},at={class:"mb-8"},ot={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},lt={class:"flex flex-col items-end gap-1"},it={class:"flex flex-wrap gap-2 justify-end"},rt={class:"dropdown dropdown-end"},dt={tabindex:"0",class:"btn btn-outline gap-2"},ct={tabindex:"0",class:"dropdown-content menu p-2 shadow bg-base-200 rounded-box w-52"},ut={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-6"},mt={class:"stats shadow"},pt={class:"stat"},bt={class:"stat-figure text-primary"},vt={class:"stat-value text-primary"},ft={class:"stats shadow"},ht={class:"stat"},gt={class:"stat-figure text-secondary"},xt={class:"stat-value text-secondary"},_t={class:"stats shadow"},wt={class:"stat"},yt={class:"stat-figure text-accent"},Ct={class:"stat-value text-accent"},kt={class:"stats shadow"},Dt={class:"stat"},St={class:"stat-figure text-success"},jt={class:"stat-value text-success"},Mt={key:0,class:"space-y-6"},At={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3"},$t={class:"relative sm:w-72"},Nt={class:"grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},Lt=["onClick"],Ut={class:"w-16 h-16 bg-gradient-to-br from-primary to-secondary rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"},Vt={class:"text-xl font-bold text-base-content mb-2 group-hover:text-primary transition-colors"},Bt={class:"space-y-2 text-sm text-base-content/70"},Ft={class:"flex items-center gap-2"},Tt={class:"flex items-center gap-2"},Ot={class:"flex items-center gap-2"},Pt={class:"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1"},qt=["onClick"],Et=["onClick"],Gt={class:"mt-6 pt-4 border-t border-base-300"},Jt=["onClick"],Wt={key:1,class:"text-center py-20"},zt={class:"bg-gradient-to-br from-base-200 to-base-300 rounded-3xl p-12 max-w-md mx-auto"},Ht={class:"w-24 h-24 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-full flex items-center justify-center mx-auto mb-6"},It={key:2,class:"fixed bottom-6 right-6"},Qt={class:"modal-box w-11/12 max-w-2xl"},Rt={class:"text-lg font-bold mb-6"},Kt={class:"form-control"},Xt={class:"form-control"},Yt={class:"modal-action mt-8 pt-4 border-t border-base-200"},Zt={class:"flex justify-between w-full"},ts={class:"flex gap-3"},ss={type:"submit",class:"btn btn-primary"},es={class:"modal-box"},ns={class:"py-4"},as=R({__name:"ClassesDashboard",setup(V){const o=K(),h=b(),f=b(),M=b(),d=b(null),g=b(null),_=b(""),x=b(""),r=X({name:"",students:""}),C=y(()=>o?.classes?x.value?o.classes.filter(n=>n.name.toLowerCase().includes(x.value.toLowerCase())):o.classes:[]),B=y(()=>o?.classes?o.classes.reduce((n,s)=>n+(s.students?.length||0),0):0),F=y(()=>o?.classes?o.classes.filter(n=>n.students&&n.students.length>0).length:0),T=y(()=>{if(!o?.classes)return 0;const n=new Date;return n.setDate(n.getDate()-7),o.classes.filter(s=>new Date(s.updatedAt)>n).length}),k=()=>{d.value=null,r.name="",r.students="",h.value?.showModal()},O=n=>{const s=o.classes.find(e=>e.id===n);s&&(d.value=n,r.name=s.name,r.students=s.students.map(e=>`${e.id} ${e.name}`).join(`
`),h.value?.showModal())},P=(n,s)=>{g.value=n,_.value=s,f.value?.showModal()},q=()=>{if(!r.name.trim()||!r.students.trim()){alert("班級名稱和學生名單不能為空！");return}if(d.value){const n=o.classes.find(s=>s.id===d.value);if(n){const e=I(r.students).map(a=>{const u=n.students.find(Q=>Q.id===a.id);return u?{...u,name:a.name}:a});o.updateClass(d.value,{name:r.name,students:e})}}else o.createClass(r.name,r.students);w()},E=()=>{if(d.value){const n=o.classes.find(s=>s.id===d.value);n&&(g.value=d.value,_.value=n.name,w(),f.value?.showModal())}},G=()=>{g.value&&o.deleteClass(g.value),A()},w=()=>{h.value?.close(),d.value=null},A=()=>{f.value?.close(),g.value=null,_.value=""},$=n=>{o.selectClass(n),et(`/class/${n}`)},J=()=>{confirm("將匯出完整備份 (含全域作業、班級、分組資料)。匯入時會以全域作業為主同步各班作業設定，請妥善保管檔案。")&&o.exportAllClasses()},W=()=>{o.exportDashboardSummary()},z=()=>{M.value?.click()},H=async n=>{const s=n.target,e=s.files?.[0];if(e){if(!e.name.endsWith(".json")){alert("檔案格式錯誤！請選擇 .json 格式的備份檔案。");return}const a=await o.importAllClasses(e);alert(a?"資料匯入成功！":"資料匯入失敗，請檢查檔案格式或內容。"),s.value=""}},I=n=>{const s=n.trim();if(/^\d+$/.test(s)){const e=parseInt(s);return Array.from({length:e},(a,u)=>({id:String(u+1),name:`${u+1}號`,scores:[],totalScore:0,averageScore:0,group:null,grade:null,createdAt:new Date,isPresent:!0}))}return s.split(`
`).map(e=>{const a=e.trim().split(/\s+/);return a.length>=1&&a[0]?{id:a[0],name:a.slice(1).join(" ")||`${a[0]}號`,scores:[],totalScore:0,averageScore:0,group:null,grade:null,createdAt:new Date,isPresent:!0}:null}).filter(Boolean)},N=n=>new Date(n).toLocaleDateString("zh-TW",{month:"short",day:"numeric"});return U({title:"班級總覽 - 班級分組計分工具"}),(n,s)=>{const e=Y;return p(),m("div",nt,[t("div",at,[t("div",ot,[s[9]||(s[9]=t("div",null,[t("h1",{class:"text-4xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent"}," 班級管理 "),t("p",{class:"text-base-content/70 text-lg mt-2"}," 管理您的所有班級，開始精彩的教學旅程 ")],-1)),t("div",lt,[t("div",it,[t("button",{onClick:z,class:"btn btn-outline gap-2"},[l(e,{name:"Upload",class:"w-4 h-4"}),s[3]||(s[3]=v(" 還原備份 (JSON) ",-1))]),t("div",rt,[t("label",dt,[l(e,{name:"Download",class:"w-4 h-4"}),s[4]||(s[4]=v(" 匯出資料 ",-1)),l(e,{name:"ChevronDown",class:"w-4 h-4"})]),t("ul",ct,[t("li",null,[t("a",{onClick:W},[l(e,{name:"FileSpreadsheet",class:"w-4 h-4"}),s[5]||(s[5]=v(" 匯出總覽報告 (Excel) ",-1))])]),t("li",null,[t("a",{onClick:J},[l(e,{name:"Archive",class:"w-4 h-4"}),s[6]||(s[6]=v(" 建立完整備份 (JSON) ",-1))])])])]),t("button",{onClick:k,class:"btn btn-primary gap-2"},[l(e,{name:"Plus",class:"w-4 h-4"}),s[7]||(s[7]=v(" 新增班級 ",-1))])]),s[8]||(s[8]=t("p",{class:"text-xs text-base-content/60 text-right"}," 備份檔會包含全域作業、班級資料與分組設定；匯入時將以全域作業為主，同步移除各班中不存在的作業設定。 ",-1))])]),t("div",ut,[t("div",mt,[t("div",pt,[t("div",bt,[l(e,{name:"GraduationCap",class:"w-8 h-8"})]),s[10]||(s[10]=t("div",{class:"stat-title"},"總班級數",-1)),t("div",vt,c(i(o)?.totalClasses||0),1)])]),t("div",ft,[t("div",ht,[t("div",gt,[l(e,{name:"Users",class:"w-8 h-8"})]),s[11]||(s[11]=t("div",{class:"stat-title"},"總學生數",-1)),t("div",xt,c(i(B)),1)])]),t("div",_t,[t("div",wt,[t("div",yt,[l(e,{name:"BookOpen",class:"w-8 h-8"})]),s[12]||(s[12]=t("div",{class:"stat-title"},"活躍班級",-1)),t("div",Ct,c(i(F)),1)])]),t("div",kt,[t("div",Dt,[t("div",St,[l(e,{name:"TrendingUp",class:"w-8 h-8"})]),s[13]||(s[13]=t("div",{class:"stat-title"},"本週活動",-1)),t("div",jt,c(i(T)),1)])])])]),i(C)&&i(C).length>0?(p(),m("div",Mt,[t("div",At,[s[14]||(s[14]=t("h2",{class:"text-2xl font-semibold text-base-content"},"您的班級",-1)),t("div",$t,[D(t("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>Z(x)?x.value=a:null),type:"text",placeholder:"搜尋班級...",class:"input input-bordered pl-10 w-full"},null,512),[[S,i(x)]]),l(e,{name:"Search",class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-base-content/50"})])]),t("div",Nt,[(p(!0),m(tt,null,st(i(C),a=>(p(),m("div",{key:a.id,class:"group relative bg-gradient-to-br from-base-100 to-base-200 rounded-2xl p-6 shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2 border border-base-300"},[t("div",{onClick:u=>$(a.id),class:"cursor-pointer"},[t("div",Ut,[l(e,{name:"GraduationCap",class:"w-8 h-8 text-white"})]),t("h3",Vt,c(a.name),1),t("div",Bt,[t("div",Ft,[l(e,{name:"Users",class:"w-4 h-4"}),t("span",null,c((a.students||[]).length)+" 位學生",1)]),t("div",Tt,[l(e,{name:"Calendar",class:"w-4 h-4"}),t("span",null,c(N(a.createdAt)),1)]),t("div",Ot,[l(e,{name:"Clock",class:"w-4 h-4"}),t("span",null,c(N(a.updatedAt)),1)])])],8,Lt),t("div",Pt,[t("button",{onClick:j(u=>O(a.id),["stop"]),class:"btn btn-sm btn-ghost btn-circle bg-base-100/80 hover:bg-info hover:text-info-content",title:"編輯班級"},[l(e,{name:"Edit",class:"w-4 h-4"})],8,qt),t("button",{onClick:j(u=>P(a.id,a.name),["stop"]),class:"btn btn-sm btn-ghost btn-circle bg-base-100/80 hover:bg-error hover:text-error-content",title:"刪除班級"},[l(e,{name:"Trash2",class:"w-4 h-4"})],8,Et)]),t("div",Gt,[t("button",{onClick:u=>$(a.id),class:"w-full btn btn-primary btn-sm group-hover:btn-accent transition-all"},[l(e,{name:"LogIn",class:"w-4 h-4 mr-2"}),s[15]||(s[15]=v(" 進入班級 ",-1))],8,Jt)])]))),128))])])):(p(),m("div",Wt,[t("div",zt,[t("div",Ht,[l(e,{name:"GraduationCap",class:"w-12 h-12 text-primary"})]),s[17]||(s[17]=t("h3",{class:"text-2xl font-bold text-base-content mb-3"},"開始您的教學旅程",-1)),s[18]||(s[18]=t("p",{class:"text-base-content/70 mb-8 text-lg"}," 創建您的第一個班級，開啟現代化的班級管理體驗 ",-1)),t("button",{onClick:k,class:"btn btn-primary btn-lg gap-3 hover:scale-105 transition-transform"},[l(e,{name:"Plus",class:"w-5 h-5"}),s[16]||(s[16]=v(" 建立第一個班級 ",-1))])])])),(i(o)?.totalClasses||0)>0?(p(),m("div",It,[t("button",{onClick:k,class:"btn btn-primary btn-lg btn-circle shadow-lg",title:"新增班級"},[l(e,{name:"Plus",class:"w-6 h-6"})])])):L("",!0),t("dialog",{ref_key:"classModal",ref:h,class:"modal"},[t("div",Qt,[t("h3",Rt,c(i(d)?"編輯班級":"新增班級"),1),t("form",{onSubmit:j(q,["prevent"]),class:"space-y-6"},[t("div",Kt,[s[19]||(s[19]=t("label",{class:"label mb-2"},[t("span",{class:"label-text font-medium"},"班級名稱")],-1)),D(t("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>i(r).name=a),type:"text",placeholder:"例如：一年一班",class:"input input-bordered w-full",required:""},null,512),[[S,i(r).name]])]),t("div",Xt,[s[20]||(s[20]=t("label",{class:"label"},[t("span",{class:"label-text font-medium"},"學生名單"),t("span",{class:"label-text-alt"},"可輸入人數或名單")],-1)),D(t("textarea",{"onUpdate:modelValue":s[2]||(s[2]=a=>i(r).students=a),class:"textarea textarea-bordered h-32 w-full mt-2",placeholder:"輸入班級總人數 (例如 28)或  1 王小明  2 陳大華...",required:""},null,512),[[S,i(r).students]]),s[21]||(s[21]=t("div",{class:"label mt-2"},[t("span",{class:"label-text-alt text-gray-500"}," 可以輸入純數字表示學生人數，或每行一個學生（格式：座號 姓名） ")],-1))]),t("div",Yt,[t("div",Zt,[t("div",null,[i(d)?(p(),m("button",{key:0,type:"button",onClick:E,class:"btn btn-error"}," 刪除班級 ")):L("",!0)]),t("div",ts,[t("button",{type:"button",onClick:w,class:"btn btn-ghost"}," 取消 "),t("button",ss,c(i(d)?"更新":"建立"),1)])])])],32)]),t("form",{method:"dialog",class:"modal-backdrop"},[t("button",{onClick:w},"close")])],512),t("dialog",{ref_key:"deleteModal",ref:f,class:"modal"},[t("div",es,[s[22]||(s[22]=t("h3",{class:"text-lg font-bold"},"確認刪除",-1)),t("p",ns,"您確定要刪除班級「"+c(i(_))+"」嗎？此操作無法復原。",1),t("div",{class:"modal-action"},[t("button",{onClick:A,class:"btn btn-ghost"},"取消"),t("button",{onClick:G,class:"btn btn-error"},"刪除")])])],512),t("input",{ref_key:"fileInput",ref:M,type:"file",accept:".json",style:{display:"none"},onChange:H},null,544)])}}}),os=Object.assign(as,{__name:"ClassesDashboard"}),is={__name:"index",setup(V){return U({title:"班級分組計分工具 - 現代化班級管理系統"}),(o,h)=>{const f=os;return p(),m("div",null,[l(f)])}}};export{is as default};
