import{f as Z,g as X,G as q,j as c,V as J,r as I,y as P,H as K,c as n,o as r,b as S,k as H,N as Q,l as W,F as g,a as t,m as A,L as O,v as ee,A as L,n as N,t as m,x as Y,O as te}from"#entry";const se={key:0,class:"space-y-6 p-4 sm:p-6"},ae={key:0,class:"space-y-4"},le={class:"glass-card p-4 rounded-xl"},oe={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3"},ne={class:"flex flex-col gap-2 md:flex-row md:items-center"},re={class:"input input-bordered flex items-center gap-2 md:flex-1"},ue={class:"flex flex-col gap-2 md:flex-row md:items-center"},de=["value"],ie={class:"flex flex-col gap-2 md:flex-row md:items-center md:col-span-2 lg:col-span-1"},ce=["value"],me={class:"overflow-x-auto glass-card p-4 rounded-xl"},ve={class:"table w-full"},be={class:"font-semibold"},ge=["value","onChange"],pe=["value","onChange"],fe={class:"text-right"},xe=["onClick"],he={key:0,class:"py-10 text-center text-base-content/70"},De={key:0,class:"flex flex-col sm:flex-row items-center justify-between gap-3"},we={class:"text-sm text-base-content/70"},ke={class:"join"},_e=["disabled"],Ie=["onClick"],Ne=["disabled"],Ce={key:1,class:"text-center py-12 text-base-content/70 glass-card rounded-xl"},ye={key:1,class:"text-center p-8"},f=10,He=Z({__name:"homework",setup(Te){const x=X(),C=q(),V=J(),j=te(),h=c(()=>V.params.id),y=c(()=>x.classes.find(a=>a.id===h.value)),E=c(()=>y.value?C.homeworkList.filter(a=>!a.isArchived&&!a.hiddenFromClassIds.includes(h.value)):[]),D=I(""),M=[{value:"all",label:"全部狀態"},{value:"未指定日期",label:"未指定日期"},{value:"待開始",label:"待開始"},{value:"進行中",label:"進行中"},{value:"今日截止",label:"今日截止"},{value:"已逾期",label:"已逾期"}],$=[{value:"releaseDateAsc",label:"開始日期（最早優先）"},{value:"releaseDateDesc",label:"開始日期（最晚優先）"},{value:"dueDateAsc",label:"截止日期（最早優先）"},{value:"dueDateDesc",label:"截止日期（最晚優先）"},{value:"nameAsc",label:"名稱（A → Z）"},{value:"nameDesc",label:"名稱（Z → A）"}],p=I("all"),w=I("releaseDateAsc"),v=c(()=>{const a=D.value.trim().toLowerCase(),e=(l,i)=>{const d=_(l)?.[i];return d?new Date(d).getTime():null},u=E.value.filter(l=>{const i=a?l.name.toLowerCase().includes(a):!0,d=T(l.id).text,b=p.value==="all"||d===p.value;return i&&b}),s=(l,i)=>{switch(w.value){case"releaseDateAsc":{const d=e(l.id,"releaseDate")??Number.POSITIVE_INFINITY,b=e(i.id,"releaseDate")??Number.POSITIVE_INFINITY;return d-b}case"releaseDateDesc":{const d=e(l.id,"releaseDate")??Number.NEGATIVE_INFINITY;return(e(i.id,"releaseDate")??Number.NEGATIVE_INFINITY)-d}case"dueDateAsc":{const d=e(l.id,"dueDate")??Number.POSITIVE_INFINITY,b=e(i.id,"dueDate")??Number.POSITIVE_INFINITY;return d-b}case"dueDateDesc":{const d=e(l.id,"dueDate")??Number.NEGATIVE_INFINITY;return(e(i.id,"dueDate")??Number.NEGATIVE_INFINITY)-d}case"nameDesc":return i.name.localeCompare(l.name,"zh-Hant");case"nameAsc":default:return l.name.localeCompare(i.name,"zh-Hant")}};return u.sort(s)}),o=I(1),k=c(()=>{const a=Math.ceil(v.value.length/f);return a>0?a:1}),z=c(()=>Array.from({length:k.value},(a,e)=>e+1)),G=c(()=>{const a=(o.value-1)*f;return v.value.slice(a,a+f)}),B=c(()=>v.value.length===0?0:(o.value-1)*f+1),U=c(()=>{const a=o.value*f;return Math.min(a,v.value.length)});P([D,p,w],()=>{o.value=1}),P(k,a=>{o.value>a&&(o.value=a)});function _(a){return y.value?.homeworkSettings?.find(e=>e.homeworkId===a)}function T(a){const e=_(a),u=new Date,s=e?.releaseDate?new Date(e.releaseDate):null,l=e?.dueDate?new Date(e.dueDate):null;return u.setHours(0,0,0,0),s&&s.setHours(0,0,0,0),l&&l.setHours(0,0,0,0),!s||!l?{text:"未指定日期",badgeClass:"badge-ghost"}:u<s?{text:"待開始",badgeClass:"badge-info"}:u>l?{text:"已逾期",badgeClass:"badge-error text-white"}:u.getTime()===l.getTime()?{text:"今日截止",badgeClass:"badge-warning"}:u>=s&&u<=l?{text:"進行中",badgeClass:"badge-success text-white"}:{text:"未知",badgeClass:"badge-neutral"}}const F=(a,e,u)=>{const l=u.target.value;x.updateClassHomeworkSettings(h.value,a,{[e]:l?new Date(l).toISOString():void 0})},R=a=>{j.push({path:`/class/${h.value}/homework/${a}`})};return K(()=>{C.homeworkList.length===0&&C.fetchAllHomework(),x.classes.length===0&&x.loadFromStorage()}),(a,e)=>{const u=Q;return r(),n(g,null,[S(u),W(V).name==="class-id-homework"?(r(),n(g,{key:0},[y.value?(r(),n("div",se,[e[12]||(e[12]=t("div",{class:"flex justify-between items-center"},[t("h3",{class:"text-2xl font-bold"},"班級作業列表")],-1)),e[13]||(e[13]=t("p",{class:"text-base-content/70"}," 此處顯示的作業來自「作業管理」。您可以在此為班級設定專屬的開始與繳交日期。 ",-1)),E.value.length>0?(r(),n("div",ae,[t("div",le,[t("div",oe,[t("div",ne,[e[5]||(e[5]=t("label",{for:"homework-search",class:"text-sm font-semibold whitespace-nowrap"},"搜尋作業",-1)),t("label",re,[S(O,{name:"Search",class:"w-4 h-4 opacity-70"}),A(t("input",{id:"homework-search","onUpdate:modelValue":e[0]||(e[0]=s=>D.value=s),type:"text",placeholder:"輸入作業名稱",class:"grow"},null,512),[[ee,D.value]])])]),t("div",ue,[e[6]||(e[6]=t("label",{for:"homework-status-filter",class:"text-sm font-semibold whitespace-nowrap"}," 篩選狀態 ",-1)),A(t("select",{id:"homework-status-filter","onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s),class:"select select-bordered md:flex-1"},[(r(),n(g,null,N(M,s=>t("option",{key:s.value,value:s.value},m(s.label),9,de)),64))],512),[[L,p.value]])]),t("div",ie,[e[7]||(e[7]=t("label",{for:"homework-sort",class:"text-sm font-semibold whitespace-nowrap"},"排序方式",-1)),A(t("select",{id:"homework-sort","onUpdate:modelValue":e[2]||(e[2]=s=>w.value=s),class:"select select-bordered md:flex-1"},[(r(),n(g,null,N($,s=>t("option",{key:s.value,value:s.value},m(s.label),9,ce)),64))],512),[[L,w.value]])])])]),t("div",me,[t("table",ve,[e[8]||(e[8]=t("thead",null,[t("tr",null,[t("th",null,"作業名稱"),t("th",null,"狀態"),t("th",null,"開始日期"),t("th",null,"繳交截止日"),t("th",{class:"text-right"},"操作")])],-1)),t("tbody",null,[(r(!0),n(g,null,N(G.value,s=>(r(),n("tr",{key:s.id},[t("td",be,m(s.name),1),t("td",null,[t("span",{class:Y(["badge",T(s.id).badgeClass])},m(T(s.id).text),3)]),t("td",null,[t("input",{type:"date",value:_(s.id)?.releaseDate?.split("T")[0],onChange:l=>F(s.id,"releaseDate",l),class:"input input-bordered input-sm w-40 bg-transparent"},null,40,ge)]),t("td",null,[t("input",{type:"date",value:_(s.id)?.dueDate?.split("T")[0],onChange:l=>F(s.id,"dueDate",l),class:"input input-bordered input-sm w-40 bg-transparent"},null,40,pe)]),t("td",fe,[t("button",{onClick:l=>R(s.id),class:"btn btn-sm btn-ghost"}," 查看繳交詳情 ",8,xe)])]))),128))])]),v.value.length===0?(r(),n("div",he,[...e[9]||(e[9]=[t("p",null,"沒有符合條件的作業。",-1)])])):H("",!0)]),v.value.length>0?(r(),n("div",De,[t("span",we," 顯示第 "+m(B.value)+" - "+m(U.value)+" 筆，共 "+m(v.value.length)+" 筆 ",1),t("div",ke,[t("button",{class:"btn btn-sm join-item",disabled:o.value===1,onClick:e[3]||(e[3]=s=>o.value=Math.max(1,o.value-1))}," « ",8,_e),(r(!0),n(g,null,N(z.value,s=>(r(),n("button",{key:s,class:Y(["btn btn-sm join-item",{"btn-active":o.value===s}]),onClick:l=>o.value=s},m(s),11,Ie))),128)),t("button",{class:"btn btn-sm join-item",disabled:o.value===k.value,onClick:e[4]||(e[4]=s=>o.value=Math.min(k.value,o.value+1))}," » ",8,Ne)])])):H("",!0)])):(r(),n("div",Ce,[S(O,{name:"BookX",class:"w-12 h-12 mx-auto mb-4 opacity-50"}),e[10]||(e[10]=t("p",null,"目前沒有指派給這個班級的作業。",-1)),e[11]||(e[11]=t("p",{class:"text-sm mt-2"},"您可以到「全域作業管理」建立新作業。",-1))]))])):(r(),n("div",ye,[...e[14]||(e[14]=[t("p",null,"正在載入班級資料...",-1),t("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))],64)):H("",!0)],64)}}});export{He as default};
