import{f as N,g as q,y as A,C as H,r as m,c as r,l as n,o as d,a as e,F as f,n as k,x as b,t as a,p as h,b as v,L as I,I as O,d as w,_ as Q}from"#entry";const R={key:0,class:"space-y-6"},U={class:"card bg-base-100 shadow-sm"},W={class:"card-body"},G={class:"flex flex-wrap gap-4 items-center"},J={class:"form-control flex-1"},K={class:"flex items-center gap-4 justify-between w-full"},X={class:"flex items-center gap-2"},Y={class:"flex flex-wrap gap-2"},Z=["onClick","title"],ee=["onClick"],te={class:"card-body p-0"},se={class:"flex flex-row items-stretch divide-x divide-base-100"},oe={class:"flex flex-col justify-between p-4 flex-1 min-w-0"},ne={class:"flex items-center gap-2 mb-2"},le=["title"],ae={class:"font-bold text-base md:text-lg lg:text-xl xl:text-2xl leading-tight truncate"},ie={class:"text-sm text-base-content/70 mb-2"},re={class:"flex items-center gap-2 select-none mt-2"},de=["checked","onChange"],ce={class:"flex flex-col justify-center items-center bg-gradient-to-br from-base-200 via-base-100 to-base-300 rounded-r-2xl p-4 min-w-[80px] gap-2"},ue={class:"flex flex-col items-center"},be={class:"flex gap-2 mt-2"},ge=["onClick"],me=["onClick"],xe={class:"absolute top-3 right-3 z-10"},he={class:"dropdown dropdown-end"},ve={tabindex:"0",role:"button",class:"btn btn-ghost btn-xs btn-circle"},pe={tabindex:"0",class:"dropdown-content menu bg-base-100 rounded-box z-[1] w-40 p-2 shadow"},_e=["onClick"],fe=["onClick"],ke=["onClick"],we={class:"modal-box w-11/12 max-w-2xl"},ye={class:"text-lg font-bold mb-4"},Ce={key:0,class:"space-y-3 max-h-96 overflow-y-auto"},Se={class:"flex items-center gap-2"},$e={class:"text-sm"},Pe={class:"text-right"},Te={class:"text-sm text-base-content/70"},Le={key:1,class:"text-center py-8 text-base-content/70"},Me={key:1,class:"text-center p-8"},je=N({__name:"index",setup(ze){const x=q(),P=A(),{currentClass:l}=H(x),T=O("editStudent"),p=m(),y=m(1),i=m([]),g=m(null),_=m({}),L=[3,2,1,-1,-2,-3],M=o=>{const s=i.value.indexOf(o);s>-1?i.value.splice(s,1):i.value.push(o)},j=()=>{i.value=[]},C=(o,s)=>{S(o,s,"快速評分"),_.value[o]=s>0?"animate-score-bounce-green":"animate-score-bounce-red",setTimeout(()=>{_.value[o]=null},500)},z=o=>{i.value.length>0?i.value.forEach(s=>S(s,o,"批量快速評分")):y.value=o},S=(o,s,c)=>{l.value&&x.addScoreToStudent(l.value.id,o,s,c)},V=o=>{l.value&&confirm(`確定要刪除學生「${o.name}」嗎？此操作無法復原。`)&&(x.removeStudentFromClass(l.value.id,o.id),P.showSuccess("學生已刪除"))},B=o=>{g.value=o,p.value?.showModal()},$=()=>{p.value?.close(),g.value=null},D=o=>{if(!l.value)return;const s=l.value.students.find(c=>c.id===o);s&&x.updateStudent(l.value.id,o,{isPresent:!s.isPresent})},E=o=>new Date(o).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),F=()=>{l.value&&(i.value=l.value.students.map(o=>o.id))};return(o,s)=>{const c=I;return n(l)?(d(),r("div",R,[e("div",U,[e("div",W,[e("div",G,[e("div",J,[e("div",K,[e("div",X,[s[1]||(s[1]=e("span",{class:"label-text whitespace-nowrap"},"快速加分",-1)),e("div",Y,[(d(),r(f,null,k(L,t=>e("button",{key:t,onClick:u=>z(t),class:b(["px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 border focus:outline-none focus:ring-2 focus:ring-primary/40",t===n(y)?t>0?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow":"bg-gradient-to-r from-rose-500 to-red-500 text-white shadow":t>0?"bg-green-50 dark:bg-green-900/20 text-green-600 border-green-200 dark:border-green-700 hover:bg-green-100 dark:hover:bg-green-900/40":"bg-rose-50 dark:bg-rose-900/20 text-rose-600 border-rose-200 dark:border-rose-700 hover:bg-rose-100 dark:hover:bg-rose-900/40"]),title:n(i).length?"立即對選取學生套用":"設定批量評分預設分數"},a(t>0?"+":"")+a(t),11,Z)),64))])]),e("div",{class:"flex gap-2 ml-auto"},[e("button",{class:"btn btn-sm btn-outline btn-primary",onClick:F,type:"button"}," 全選 "),e("button",{class:"btn btn-sm btn-outline btn-secondary",onClick:j,type:"button"}," 取消全選 ")])])])])])]),e("div",{class:b(["grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 transition-all",n(i).length?"pb-32":""])},[(d(!0),r(f,null,k(n(l).students,t=>(d(),r("div",{key:t.id,class:b(["card bg-base-100 border-2 border-base-300 shadow-md rounded-xl hover:shadow-xl transition-all duration-200 cursor-pointer",{"ring-2 ring-primary":n(i).includes(t.id)}]),onClick:u=>M(t.id)},[e("div",te,[e("div",se,[e("div",oe,[e("div",ne,[e("span",{class:b(["inline-block w-2 h-2 rounded-full",t.isPresent?"bg-green-500":"bg-gray-400"]),title:t.isPresent?"出席":"缺席"},null,10,le),e("h3",ae,a(t.name),1)]),e("p",ie,"座號 "+a(t.id),1),e("label",re,[e("input",{type:"checkbox",checked:t.isPresent,onClick:s[0]||(s[0]=h(()=>{},["stop"])),onChange:h(u=>D(t.id),["stop"]),class:"toggle toggle-success toggle-sm"},null,40,de),e("span",{class:b(["text-sm font-medium",t.isPresent?"text-green-600":"text-gray-400"])},a(t.isPresent?"出席":"缺席"),3)])]),e("div",ce,[e("div",ue,[s[2]||(s[2]=e("span",{class:"text-xs text-base-content/60 mb-1"},"總分",-1)),e("span",{class:b(["font-extrabold text-xl md:text-2xl lg:text-3xl text-primary px-2 py-2",n(_)[t.id]])},a(t.totalScore),3)]),e("div",be,[e("button",{onClick:h(u=>C(t.id,1),["stop"]),class:"btn btn-md font-bold text-base px-4 py-1 rounded-full bg-gradient-to-r from-green-400 to-emerald-500 text-white border-none shadow hover:scale-105 hover:from-green-500 hover:to-emerald-600",title:"+1分"}," +1 ",8,ge),e("button",{onClick:h(u=>C(t.id,-1),["stop"]),class:"btn btn-md font-bold text-base px-4 py-1 rounded-full bg-gradient-to-r from-rose-400 to-red-500 text-white border-none shadow hover:scale-105 hover:from-rose-500 hover:to-red-600",title:"-1分"}," -1 ",8,me)])])])]),e("div",xe,[e("div",he,[e("div",ve,[v(c,{name:"MoreVertical",class:"w-4 h-4"})]),e("ul",pe,[e("li",null,[e("a",{onClick:u=>n(T)(t.id)},[v(c,{name:"Edit",class:"w-4 h-4"}),s[3]||(s[3]=w(" 編輯 ",-1))],8,_e)]),e("li",null,[e("a",{onClick:u=>B(t)},[v(c,{name:"List",class:"w-4 h-4"}),s[4]||(s[4]=w(" 評分紀錄 ",-1))],8,fe)]),e("li",null,[e("a",{onClick:u=>V(t),class:"text-error"},[v(c,{name:"Trash2",class:"w-4 h-4"}),s[5]||(s[5]=w(" 移除此學生 ",-1))],8,ke)])])])])],10,ee))),128)),e("dialog",{ref_key:"historyModal",ref:p,class:"modal"},[e("div",we,[e("h3",ye,a(n(g)?.name)+" 的評分記錄",1),n(g)&&n(g).scores.length>0?(d(),r("div",Ce,[(d(!0),r(f,null,k(n(g).scores.slice().reverse(),t=>(d(),r("div",{key:t.id,class:"flex justify-between items-center p-3 bg-base-200 rounded-lg"},[e("div",null,[e("div",Se,[e("span",{class:b(["badge",t.value>0?"badge-success":"badge-error"])},a(t.value>0?"+":"")+a(t.value),3),e("span",$e,a(t.reason||"快速評分"),1)])]),e("div",Pe,[e("div",Te,a(E(t.timestamp)),1)])]))),128))])):(d(),r("div",Le,"尚無評分記錄")),e("div",{class:"modal-action"},[e("button",{onClick:$,class:"btn btn-ghost"},"關閉")])]),e("form",{method:"dialog",class:"modal-backdrop"},[e("button",{onClick:$},"close")])],512)],2)])):(d(),r("div",Me,[...s[6]||(s[6]=[e("p",null,"正在載入班級資料...",-1),e("span",{class:"loading loading-lg loading-spinner text-primary"},null,-1)])]))}}}),Be=Q(je,[["__scopeId","data-v-2adc73de"]]);export{Be as default};
